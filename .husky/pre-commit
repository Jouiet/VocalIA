#!/bin/sh

# VocalIA Pre-commit Hook (FAST - ~5 seconds)
# Quick syntax check only. Full tests via CI/CD or manual `npm test`

echo "üîç Quick pre-commit checks..."

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only)

# Check if any JS/CJS files are staged
JS_CHANGED=$(echo "$STAGED_FILES" | grep -E '\.(js|cjs)$' || true)

if [ -n "$JS_CHANGED" ]; then
  echo "üìã Checking JS syntax..."
  # Quick syntax check - just verify files parse (no full test suite)
  for f in $JS_CHANGED; do
    if [ -f "$f" ]; then
      node --check "$f" 2>/dev/null || {
        echo "‚ùå Syntax error in $f"
        exit 1
      }
    fi
  done
fi

# Check JSON validity for critical files
CRITICAL_JSON="package.json telephony/knowledge_base.json"
for f in $CRITICAL_JSON; do
  if echo "$STAGED_FILES" | grep -q "$f"; then
    echo "üìÑ Validating $f..."
    node -e "JSON.parse(require('fs').readFileSync('$f'))" || exit 1
  fi
done

echo "‚úÖ Pre-commit OK (run 'npm test' for full suite)"
