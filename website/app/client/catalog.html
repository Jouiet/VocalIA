<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://api.vocalia.ma https://www.google-analytics.com; base-uri 'self'; form-action 'self'; frame-ancestors 'none'">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <title>Catalogue - VocalIA</title>

  <link rel="icon" type="image/x-icon" href="/public/images/favicon/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/public/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/public/images/favicon/favicon-16x16.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="/src/lib/dark-mode-init.js"></script>
  <link href="/public/css/style.css" rel="stylesheet">
  <script src="https://unpkg.com/lucide@0.469.0/dist/umd/lucide.min.js" integrity="sha384-hJnF5AwidE18GSWTAGHv3ByzzvfNZ1Tcx5y1UUV3WkauuMCEzBJBMSwSt/PUPXnM" crossorigin="anonymous"></script>
  <script src="/src/lib/i18n.js"></script>
  <script src="/src/lib/escape-html.js"></script>
</head>

<body class="bg-zinc-50 dark:bg-[#050505] min-h-screen">
  <!-- Sidebar Component -->
  <div data-app-component="sidebar"></div>

  <!-- Main Content -->
  <main class="lg:ml-[260px] rtl:lg:ml-0 rtl:lg:mr-[260px] min-h-screen overflow-auto">
      <header
        class="sticky top-0 z-10 bg-white/80 dark:bg-white/[0.06] backdrop-blur-sm border-b border-zinc-200 dark:border-white/[0.08] px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <button id="menu-toggle" class="lg:hidden p-2 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-white/[0.06] rounded-lg mr-2">
              <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            <div>
            <h1 class="text-2xl font-bold text-zinc-900 dark:text-white" data-i18n="catalog.title">Catalogue Produits
            </h1>
            <p class="text-zinc-600 dark:text-zinc-400" data-i18n="catalog.subtitle">Gérez vos produits, menus et
              services pour l'IA vocale</p>
            </div>
          </div>
          <div class="flex gap-3">
            <button id="import-btn"
              class="inline-flex items-center gap-2 px-4 py-2 bg-white dark:bg-white/[0.06] border border-zinc-300 dark:border-white/[0.08] text-zinc-700 dark:text-zinc-200 font-medium rounded-lg hover:bg-zinc-50 dark:hover:bg-white/[0.1] transition-colors">
              <i data-lucide="upload" class="w-5 h-5"></i>
              <span data-i18n="catalog.import">Importer</span>
            </button>
            <button id="add-item-btn"
              class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors">
              <i data-lucide="plus" class="w-5 h-5"></i>
              <span data-i18n="catalog.add_item">Ajouter un article</span>
            </button>
          </div>
        </div>
      </header>

      <div class="px-6 py-6">
        <!-- Catalog Stats -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          <div class="bg-white dark:bg-white/[0.06] rounded-xl p-5 border border-zinc-200 dark:border-white/[0.08] hover:shadow-lg transition-all duration-200">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-lg bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center">
                <i data-lucide="package" class="w-6 h-6 text-indigo-600 dark:text-indigo-400"></i>
              </div>
              <div>
                <p class="text-sm text-zinc-500 dark:text-zinc-400" data-i18n="catalog.stats.total">Total articles</p>
                <p id="stat-total" class="text-2xl font-bold text-zinc-900 dark:text-white">0</p>
              </div>
            </div>
          </div>
          <div class="bg-white dark:bg-white/[0.06] rounded-xl p-5 border border-zinc-200 dark:border-white/[0.08] hover:shadow-lg transition-all duration-200">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-lg bg-green-100 dark:bg-green-900/50 flex items-center justify-center">
                <i data-lucide="check-circle" class="w-6 h-6 text-green-600 dark:text-green-400"></i>
              </div>
              <div>
                <p class="text-sm text-zinc-500 dark:text-zinc-400" data-i18n="catalog.stats.available">Disponibles
                </p>
                <p id="stat-available" class="text-2xl font-bold text-zinc-900 dark:text-white">0</p>
              </div>
            </div>
          </div>
          <div class="bg-white dark:bg-white/[0.06] rounded-xl p-5 border border-zinc-200 dark:border-white/[0.08] hover:shadow-lg transition-all duration-200">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-lg bg-amber-100 dark:bg-amber-900/50 flex items-center justify-center">
                <i data-lucide="alert-triangle" class="w-6 h-6 text-amber-600 dark:text-amber-400"></i>
              </div>
              <div>
                <p class="text-sm text-zinc-500 dark:text-zinc-400" data-i18n="catalog.stats.low_stock">Stock faible
                </p>
                <p id="stat-low-stock" class="text-2xl font-bold text-zinc-900 dark:text-white">0</p>
              </div>
            </div>
          </div>
          <div class="bg-white dark:bg-white/[0.06] rounded-xl p-5 border border-zinc-200 dark:border-white/[0.08] hover:shadow-lg transition-all duration-200">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-lg bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center">
                <i data-lucide="refresh-cw" class="w-6 h-6 text-purple-600 dark:text-purple-400"></i>
              </div>
              <div>
                <p class="text-sm text-zinc-500 dark:text-zinc-400" data-i18n="catalog.stats.last_sync">Dernière sync
                </p>
                <p id="stat-last-sync" class="text-lg font-medium text-zinc-900 dark:text-white">-</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Catalog Type Selector -->
        <div class="bg-white dark:bg-white/[0.06] rounded-xl border border-zinc-200 dark:border-white/[0.08] mb-6 hover:shadow-lg transition-all duration-200">
          <div class="border-b border-zinc-200 dark:border-white/[0.08] px-4">
            <nav class="flex gap-1 -mb-px">
              <button
                class="catalog-tab active px-4 py-3 text-sm font-medium border-b-2 border-indigo-600 text-indigo-600 dark:text-indigo-400"
                data-type="products">
                <i data-lucide="shopping-bag" class="w-4 h-4 inline mr-2"></i>
                <span data-i18n="catalog.type.products">Produits</span>
              </button>
              <button
                class="catalog-tab px-4 py-3 text-sm font-medium border-b-2 border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"
                data-type="menu">
                <i data-lucide="utensils" class="w-4 h-4 inline mr-2"></i>
                <span data-i18n="catalog.type.menu">Menu</span>
              </button>
              <button
                class="catalog-tab px-4 py-3 text-sm font-medium border-b-2 border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"
                data-type="services">
                <i data-lucide="wrench" class="w-4 h-4 inline mr-2"></i>
                <span data-i18n="catalog.type.services">Services</span>
              </button>
              <button
                class="catalog-tab px-4 py-3 text-sm font-medium border-b-2 border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"
                data-type="fleet">
                <i data-lucide="car" class="w-4 h-4 inline mr-2"></i>
                <span data-i18n="catalog.type.fleet">Véhicules</span>
              </button>
              <button
                class="catalog-tab px-4 py-3 text-sm font-medium border-b-2 border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"
                data-type="trips">
                <i data-lucide="plane" class="w-4 h-4 inline mr-2"></i>
                <span data-i18n="catalog.type.trips">Voyages</span>
              </button>
            </nav>
          </div>

          <!-- Search & Filters -->
          <div class="p-4 border-b border-zinc-200 dark:border-white/[0.08]">
            <div class="flex flex-col md:flex-row gap-4">
              <div class="flex-1 relative">
                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-zinc-400"></i>
                <input type="text" id="search-input" aria-label="Rechercher un article"
                  class="w-full pl-10 pr-4 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  placeholder="Rechercher un article..." data-i18n-placeholder="catalog.search_placeholder">
              </div>
              <select id="category-filter" aria-label="Filtrer par catégorie"
                class="px-4 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white">
                <option value="" data-i18n="catalog.filter.all_categories">Toutes les catégories</option>
              </select>
              <select id="status-filter" aria-label="Filtrer par statut"
                class="px-4 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white">
                <option value="" data-i18n="catalog.filter.all_status">Tous les statuts</option>
                <option value="available" data-i18n="catalog.filter.available">Disponible</option>
                <option value="low_stock" data-i18n="catalog.filter.low_stock">Stock faible</option>
                <option value="out_of_stock" data-i18n="catalog.filter.out_of_stock">Rupture</option>
              </select>
            </div>
          </div>

          <!-- Catalog Items Table -->
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-zinc-50 dark:bg-white/[0.06]">
                <tr>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider">
                    <span data-i18n="catalog.table.item">Article</span>
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider">
                    <span data-i18n="catalog.table.category">Catégorie</span>
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider">
                    <span data-i18n="catalog.table.price">Prix</span>
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider">
                    <span data-i18n="catalog.table.stock">Stock</span>
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider">
                    <span data-i18n="catalog.table.status">Statut</span>
                  </th>
                  <th
                    class="px-4 py-3 text-right text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider">
                    <span data-i18n="catalog.table.actions">Actions</span>
                  </th>
                </tr>
              </thead>
              <tbody id="catalog-items" class="divide-y divide-zinc-200 dark:divide-white/[0.08]">
                <!-- Items will be loaded dynamically -->
              </tbody>
            </table>
          </div>

          <!-- Empty State -->
          <div id="empty-state" class="hidden p-12 text-center">
            <div
              class="w-16 h-16 mx-auto mb-4 rounded-full bg-zinc-100 dark:bg-white/[0.06] flex items-center justify-center">
              <i data-lucide="package-x" class="w-8 h-8 text-zinc-400"></i>
            </div>
            <h3 class="text-lg font-medium text-zinc-900 dark:text-white mb-2" data-i18n="catalog.empty.title">Aucun
              article</h3>
            <p class="text-zinc-500 dark:text-zinc-400 mb-4" data-i18n="catalog.empty.description">Commencez par
              importer votre catalogue ou ajouter des articles manuellement.</p>
            <button id="empty-import-btn"
              class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors">
              <i data-lucide="upload" class="w-5 h-5"></i>
              <span data-i18n="catalog.import">Importer</span>
            </button>
          </div>

          <!-- Pagination -->
          <div class="px-4 py-3 border-t border-zinc-200 dark:border-white/[0.08] flex items-center justify-between">
            <p class="text-sm text-zinc-500 dark:text-zinc-400">
              <span data-i18n="catalog.showing">Affichage de</span>
              <span id="page-start">1</span>-<span id="page-end">10</span>
              <span data-i18n="catalog.of">sur</span>
              <span id="total-items">0</span>
              <span data-i18n="catalog.items">articles</span>
            </p>
            <div class="flex gap-2">
              <button id="prev-page" aria-label="Page précédente"
                class="px-3 py-1 border border-zinc-300 dark:border-white/[0.08] rounded text-sm disabled:opacity-50"
                disabled>
                <i data-lucide="chevron-left" class="w-4 h-4"></i>
              </button>
              <button id="next-page" aria-label="Page suivante"
                class="px-3 py-1 border border-zinc-300 dark:border-white/[0.08] rounded text-sm disabled:opacity-50">
                <i data-lucide="chevron-right" class="w-4 h-4"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Voice Description Preview -->
        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white">
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-lg bg-white/20 flex items-center justify-center flex-shrink-0">
              <i data-lucide="mic" class="w-6 h-6"></i>
            </div>
            <div class="flex-1">
              <h3 class="text-lg font-semibold mb-2" data-i18n="catalog.voice_preview.title">Aperçu vocal</h3>
              <p class="text-white/80 text-sm mb-4" data-i18n="catalog.voice_preview.description">Voici comment l'IA
                vocale présentera vos articles aux clients.</p>
              <div id="voice-preview" class="bg-white/10 rounded-lg p-4">
                <p class="text-sm italic">"Nous proposons actuellement 0 articles. Que souhaitez-vous consulter?"</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

  <!-- Import Modal -->
  <div id="import-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen px-4">
      <div class="fixed inset-0 bg-black/50" id="import-modal-backdrop"></div>
      <div class="relative bg-white dark:bg-white/[0.06] rounded-xl shadow-xl max-w-lg w-full p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-white" data-i18n="catalog.import_modal.title">
            Importer le catalogue</h3>
          <button id="close-import-modal" aria-label="Fermer" class="p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-white/[0.08]">
            <i data-lucide="x" class="w-5 h-5 text-zinc-400"></i>
          </button>
        </div>

        <div class="space-y-4">
          <div class="border-2 border-dashed border-zinc-300 dark:border-white/[0.08] rounded-lg p-8 text-center">
            <input type="file" id="file-input" aria-label="Fichier catalogue" class="hidden" accept=".json,.csv,.xlsx">
            <i data-lucide="upload-cloud" class="w-12 h-12 mx-auto text-zinc-400 mb-4"></i>
            <p class="text-zinc-600 dark:text-zinc-400 mb-2" data-i18n="catalog.import_modal.drag_drop">Glissez un
              fichier ici ou</p>
            <button id="browse-files" class="text-indigo-600 dark:text-indigo-400 font-medium hover:underline"
              data-i18n="catalog.import_modal.browse">parcourir</button>
            <p class="text-xs text-zinc-400 mt-2" data-i18n="catalog.import_modal.formats">Formats: JSON, CSV, XLSX</p>
          </div>

          <div class="flex items-center gap-4">
            <div class="h-px flex-1 bg-zinc-200 dark:bg-white/[0.06]"></div>
            <span class="text-sm text-zinc-500" data-i18n="catalog.import_modal.or">ou</span>
            <div class="h-px flex-1 bg-zinc-200 dark:bg-white/[0.06]"></div>
          </div>

          <div>
            <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2"
              data-i18n="catalog.import_modal.connect">Connecter une plateforme</label>
            <div class="grid grid-cols-2 gap-3">
              <button
                class="connect-platform flex items-center gap-3 p-3 border border-zinc-300 dark:border-white/[0.08] rounded-lg hover:bg-zinc-50 dark:hover:bg-white/[0.08]"
                data-platform="shopify">
                <img src="/public/images/logos/shopify.svg" alt="Shopify" class="w-8 h-8">
                <span class="font-medium text-zinc-700 dark:text-zinc-300">Shopify</span>
              </button>
              <button
                class="connect-platform flex items-center gap-3 p-3 border border-zinc-300 dark:border-white/[0.08] rounded-lg hover:bg-zinc-50 dark:hover:bg-white/[0.08]"
                data-platform="woocommerce">
                <img src="/public/images/logos/woocommerce.svg" alt="WooCommerce" class="w-8 h-8">
                <span class="font-medium text-zinc-700 dark:text-zinc-300">WooCommerce</span>
              </button>
            </div>
          </div>
        </div>

        <div class="mt-6 flex justify-end gap-3">
          <button id="cancel-import"
            class="px-4 py-2 text-zinc-700 dark:text-zinc-300 font-medium rounded-lg hover:bg-zinc-100 dark:hover:bg-white/[0.08]"
            data-i18n="common.cancel">Annuler</button>
          <button id="confirm-import"
            class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg disabled:opacity-50"
            disabled data-i18n="catalog.import_modal.import">Importer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Item Modal -->
  <div id="add-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen px-4">
      <div class="fixed inset-0 bg-black/50" id="add-modal-backdrop"></div>
      <div
        class="relative bg-white dark:bg-white/[0.06] rounded-xl shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-white" data-i18n="catalog.add_modal.title">Ajouter
            un article</h3>
          <button id="close-add-modal" aria-label="Fermer" class="p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-white/[0.08]">
            <i data-lucide="x" class="w-5 h-5 text-zinc-400"></i>
          </button>
        </div>

        <form id="add-item-form" class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="item-name" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1"
                data-i18n="catalog.form.name">Nom *</label>
              <input type="text" name="name" id="item-name" required
                class="w-full px-3 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white">
            </div>
            <div>
              <label for="item-sku" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1"
                data-i18n="catalog.form.sku">SKU/ID</label>
              <input type="text" name="sku" id="item-sku"
                class="w-full px-3 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white">
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="item-price" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1"
                data-i18n="catalog.form.price">Prix *</label>
              <input type="number" name="price" id="item-price" step="0.01" required
                class="w-full px-3 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white">
            </div>
            <div>
              <label for="item-stock" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1"
                data-i18n="catalog.form.stock">Stock</label>
              <input type="number" name="stock" id="item-stock" min="0"
                class="w-full px-3 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white">
            </div>
          </div>

          <div>
            <label for="item-category" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1"
              data-i18n="catalog.form.category">Catégorie</label>
            <input type="text" name="category" id="item-category"
              class="w-full px-3 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white">
          </div>

          <div>
            <label for="item-description" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1"
              data-i18n="catalog.form.description">Description</label>
            <textarea name="description" id="item-description" rows="3"
              class="w-full px-3 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white"></textarea>
          </div>

          <div>
            <label for="item-voice-description" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1"
              data-i18n="catalog.form.voice_description">Description vocale</label>
            <textarea name="voice_description" id="item-voice-description" rows="2"
              class="w-full px-3 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white"
              placeholder="Comment l'IA doit présenter cet article..."></textarea>
            <p class="text-xs text-zinc-500 mt-1" data-i18n="catalog.form.voice_hint">Conseil: Écrivez comme si vous
              parliez au téléphone.</p>
          </div>

          <div class="flex items-center gap-2">
            <input type="checkbox" name="available" id="item-available" checked
              class="rounded border-zinc-300 text-indigo-600 focus:ring-indigo-500">
            <label for="item-available" class="text-sm text-zinc-700 dark:text-zinc-300"
              data-i18n="catalog.form.available">Disponible à la vente</label>
          </div>
        </form>

        <div class="mt-6 flex justify-end gap-3">
          <button id="cancel-add"
            class="px-4 py-2 text-zinc-700 dark:text-zinc-300 font-medium rounded-lg hover:bg-zinc-100 dark:hover:bg-white/[0.08]"
            data-i18n="common.cancel">Annuler</button>
          <button id="save-item" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg"
            data-i18n="common.save">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Connector Configuration Modal -->
  <div id="connector-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen px-4">
      <div class="fixed inset-0 bg-black/50" id="connector-modal-backdrop"></div>
      <div
        class="relative bg-white dark:bg-white/[0.06] rounded-xl shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-white" data-i18n="catalog.connector.title">Connecter
            une plateforme e-commerce</h3>
          <button id="close-connector-modal" aria-label="Fermer" class="p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-white/[0.08]">
            <i data-lucide="x" class="w-5 h-5 text-zinc-400"></i>
          </button>
        </div>

        <!-- Platform Selection -->
        <div id="connector-platforms" class="space-y-4">
          <p class="text-sm text-zinc-500 dark:text-zinc-400" data-i18n="catalog.connector.description">Connectez
            votre boutique pour synchroniser automatiquement vos produits.</p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <button
              class="platform-btn flex items-center gap-4 p-4 border-2 border-zinc-200 dark:border-white/[0.08] rounded-xl hover:border-indigo-500 transition-colors"
              data-platform="shopify">
              <img src="/public/images/logos/shopify.svg" alt="Shopify" class="w-12 h-12"
                onerror="this.src='/public/images/placeholder.svg'">
              <div class="text-left">
                <span class="font-semibold text-zinc-900 dark:text-white">Shopify</span>
                <p class="text-xs text-zinc-500">10.32% part de marché</p>
              </div>
            </button>
            <button
              class="platform-btn flex items-center gap-4 p-4 border-2 border-zinc-200 dark:border-white/[0.08] rounded-xl hover:border-indigo-500 transition-colors"
              data-platform="woocommerce">
              <img src="/public/images/logos/woocommerce.svg" alt="WooCommerce" class="w-12 h-12"
                onerror="this.src='/public/images/placeholder.svg'">
              <div class="text-left">
                <span class="font-semibold text-zinc-900 dark:text-white">WooCommerce</span>
                <p class="text-xs text-zinc-500">33-39% part de marché</p>
              </div>
            </button>
            <button
              class="platform-btn flex items-center gap-4 p-4 border-2 border-zinc-200 dark:border-white/[0.08] rounded-xl hover:border-indigo-500 transition-colors"
              data-platform="magento">
              <img src="/public/images/logos/magento.svg" alt="Magento" class="w-12 h-12"
                onerror="this.src='/public/images/placeholder.svg'">
              <div class="text-left">
                <span class="font-semibold text-zinc-900 dark:text-white">Magento/Adobe</span>
                <p class="text-xs text-zinc-500">8% part de marché</p>
              </div>
            </button>
            <button
              class="platform-btn flex items-center gap-4 p-4 border-2 border-zinc-200 dark:border-white/[0.08] rounded-xl hover:border-indigo-500 transition-colors"
              data-platform="custom">
              <div class="w-12 h-12 rounded-lg bg-zinc-100 dark:bg-white/[0.06] flex items-center justify-center">
                <i data-lucide="file-json" class="w-6 h-6 text-zinc-500"></i>
              </div>
              <div class="text-left">
                <span class="font-semibold text-zinc-900 dark:text-white">JSON/CSV</span>
                <p class="text-xs text-zinc-500">Import manuel</p>
              </div>
            </button>
          </div>
        </div>

        <!-- Configuration Form (hidden by default) -->
        <div id="connector-config" class="hidden space-y-4">
          <div class="flex items-center gap-3 mb-4">
            <button id="back-to-platforms" class="p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-white/[0.08]">
              <i data-lucide="arrow-left" class="w-5 h-5 text-zinc-400"></i>
            </button>
            <img id="selected-platform-icon" src="" alt="" class="w-10 h-10">
            <span id="selected-platform-name" class="font-semibold text-zinc-900 dark:text-white"></span>
          </div>

          <form id="connector-form" class="space-y-4">
            <!-- Dynamic fields based on platform -->
            <div id="config-fields"></div>

            <div class="pt-4 border-t border-zinc-200 dark:border-white/[0.08]">
              <button type="submit" id="connect-btn"
                class="w-full px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg flex items-center justify-center gap-2">
                <i data-lucide="plug" class="w-5 h-5"></i>
                <span data-i18n="catalog.connector.connect">Connecter et synchroniser</span>
              </button>
            </div>
          </form>

          <p class="text-xs text-zinc-500 text-center">
            <i data-lucide="lock" class="w-3 h-3 inline"></i>
            <span data-i18n="catalog.connector.secure">Connexion sécurisée. Vos identifiants sont chiffrés.</span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <script src="/app/components/app-components.js" defer></script>
  <script type="module">
    import auth from '/src/lib/auth-client.js';
    import { api } from '/src/lib/api-client.js';
    import toast from '/src/lib/toast.js';

    // Initialize i18n (RTL support for AR/ARY)
    if (window.VocaliaI18n) {
      await VocaliaI18n.initI18n();
      VocaliaI18n.translatePage();
    }

    // Initialize Lucide icons
    lucide.createIcons();

    // Auth check
    if (!auth.requireAuth()) {
      throw new Error('Not authenticated');
    }

    // State
    let currentType = 'products';
    let currentPage = 1;
    let itemsPerPage = 10;
    let catalogItems = [];
    let filteredItems = [];

    // DOM Elements
    const catalogTabs = document.querySelectorAll('.catalog-tab');
    const catalogItemsBody = document.getElementById('catalog-items');
    const emptyState = document.getElementById('empty-state');
    const searchInput = document.getElementById('search-input');
    const categoryFilter = document.getElementById('category-filter');
    const statusFilter = document.getElementById('status-filter');
    const importModal = document.getElementById('import-modal');
    const addModal = document.getElementById('add-modal');
    const voicePreview = document.getElementById('voice-preview');

    // Auth user + tenant
    const authUser = auth.getCurrentUser() || {};
    const tenantId = auth.getTenantId();
    if (!tenantId) {
      window.location.href = '/app/client/onboarding.html';
    }

    // User info
    if (authUser) {
      document.getElementById('user-name').textContent = authUser.company_name || authUser.email || '';
      document.getElementById('user-email').textContent = authUser.email || '';
      document.getElementById('user-avatar').textContent = (authUser.company_name || authUser.email || '').substring(0, 2).toUpperCase();
    }

    // Logout
    document.getElementById('logout-btn').addEventListener('click', async () => {
      await auth.logout();
      window.location.href = '/app/auth/login.html';
    });

    // Tab switching
    catalogTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        catalogTabs.forEach(t => {
          t.classList.remove('active', 'border-indigo-600', 'text-indigo-600', 'dark:text-indigo-400');
          t.classList.add('border-transparent', 'text-zinc-500');
        });
        tab.classList.add('active', 'border-indigo-600', 'text-indigo-600', 'dark:text-indigo-400');
        tab.classList.remove('border-transparent', 'text-zinc-500');
        currentType = tab.dataset.type;
        loadCatalog();
      });
    });

    // Search & Filter
    searchInput.addEventListener('input', filterItems);
    categoryFilter.addEventListener('change', filterItems);
    statusFilter.addEventListener('change', filterItems);

    // Modal handlers
    document.getElementById('import-btn').addEventListener('click', () => importModal.classList.remove('hidden'));
    document.getElementById('empty-import-btn').addEventListener('click', () => importModal.classList.remove('hidden'));
    document.getElementById('close-import-modal').addEventListener('click', () => importModal.classList.add('hidden'));
    document.getElementById('import-modal-backdrop').addEventListener('click', () => importModal.classList.add('hidden'));
    document.getElementById('cancel-import').addEventListener('click', () => importModal.classList.add('hidden'));

    document.getElementById('add-item-btn').addEventListener('click', () => {
      resetAddModal();
      addModal.classList.remove('hidden');
    });
    document.getElementById('close-add-modal').addEventListener('click', () => {
      addModal.classList.add('hidden');
      resetAddModal();
    });
    document.getElementById('add-modal-backdrop').addEventListener('click', () => {
      addModal.classList.add('hidden');
      resetAddModal();
    });
    document.getElementById('cancel-add').addEventListener('click', () => {
      addModal.classList.add('hidden');
      resetAddModal();
    });

    // File upload
    document.getElementById('browse-files').addEventListener('click', () => {
      document.getElementById('file-input').click();
    });

    let importFile = null;
    document.getElementById('file-input').addEventListener('change', (e) => {
      importFile = e.target.files[0];
      if (importFile) {
        document.getElementById('confirm-import').disabled = false;
        // Show file name in UI
        const dropZone = document.querySelector('.file-drop-zone p');
        if (dropZone) dropZone.textContent = importFile.name;
      }
    });

    // Import catalog file
    document.getElementById('confirm-import').addEventListener('click', async () => {
      if (!importFile) return;

      const reader = new FileReader();

      reader.onload = async (e) => {
        try {
          let importData = [];
          const content = e.target.result;

          // Parse based on file type
          if (importFile.name.endsWith('.json')) {
            const parsed = JSON.parse(content);
            importData = Array.isArray(parsed) ? parsed : (parsed.products || parsed.items || parsed.menu?.items || []);
          } else if (importFile.name.endsWith('.csv')) {
            // Simple CSV parser
            const lines = content.split('\\n').filter(l => l.trim());
            if (lines.length > 1) {
              const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
              for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const item = {};
                headers.forEach((h, idx) => {
                  item[h] = values[idx]?.trim() || '';
                });
                if (item.name || item.title) {
                  importData.push({
                    id: item.id || item.sku || `import-${Date.now()}-${i}`,
                    name: item.name || item.title,
                    price: parseFloat(item.price) || 0,
                    category: item.category || '',
                    stock: parseInt(item.stock) || 0,
                    description: item.description || '',
                    voiceDescription: item.voice_description || item.voicedescription || '',
                    available: item.available !== 'false',
                    currency: item.currency || 'EUR'
                  });
                }
              }
            }
          }

          if (importData.length > 0) {
            // Send to API
            try {
              const result = await api.post(`/tenants/${tenantId}/catalog/import`, {
                type: currentType.toUpperCase(),
                data: importData
              });
              toast.success(VocaliaI18n.t('dashboard.catalog_page.items_imported').replace('{{count}}', result.imported || importData.length));
            } catch (apiErr) {
              // Fallback to local
              catalogItems = [...catalogItems, ...importData];
              toast.success(VocaliaI18n.t('dashboard.catalog_page.items_imported_local').replace('{{count}}', importData.length));
            }

            // Reload catalog
            await loadCatalog();
          } else {
            toast.error(VocaliaI18n.t('dashboard.catalog_page.no_items_file'));
          }
        } catch (error) {
          console.error('Import error:', error);
          toast.error(VocaliaI18n.t('dashboard.catalog_page.import_error'));
        }

        importModal.classList.add('hidden');
        importFile = null;
        document.getElementById('file-input').value = '';
        document.getElementById('confirm-import').disabled = true;
      };

      reader.readAsText(importFile);
    });

    // Save item via API (POST for new, PUT for edit)
    document.getElementById('save-item').addEventListener('click', async () => {
      const form = document.getElementById('add-item-form');
      const formData = new FormData(form);
      const isEditing = !!editingItemId;

      const item = {
        id: isEditing ? editingItemId : (formData.get('sku') || `item-${Date.now()}`),
        name: formData.get('name'),
        price: parseFloat(formData.get('price')),
        stock: parseInt(formData.get('stock')) || 0,
        category: formData.get('category'),
        description: formData.get('description'),
        voiceDescription: formData.get('voice_description'),
        available: formData.get('available') === 'on',
        currency: 'EUR',
        catalog_type: currentType.toUpperCase()
      };

      try {
        const path = isEditing
          ? `/tenants/${tenantId}/catalog/${editingItemId}`
          : `/tenants/${tenantId}/catalog`;

        const data = isEditing
          ? await api.put(path, item)
          : await api.post(path, item);

        if (isEditing) {
          const idx = catalogItems.findIndex(i => i.id === editingItemId);
          if (idx !== -1) catalogItems[idx] = data.item || item;
          toast.success(VocaliaI18n.t('dashboard.catalog_page.item_modified'));
        } else {
          catalogItems.push(data.item || item);
          toast.success(VocaliaI18n.t('dashboard.catalog_page.item_added'));
        }
      } catch (error) {
        console.error('Error saving item:', error);
        // Fallback to local
        if (isEditing) {
          const idx = catalogItems.findIndex(i => i.id === editingItemId);
          if (idx !== -1) catalogItems[idx] = item;
        } else {
          catalogItems.push(item);
        }
      }

      addModal.classList.add('hidden');
      resetAddModal();
      filteredItems = [...catalogItems];
      renderItems();
      updateStats();
      updateVoicePreview();
    });

    // Load catalog data from API
    async function loadCatalog() {
      try {
        const data = await api.get(`/tenants/${tenantId}/catalog`, { type: currentType.toUpperCase() });
        catalogItems = data.items || [];
        if (data.categories && data.categories.length > 0) {
          updateCategoriesFromData(data.categories);
        } else {
          updateCategories();
        }
        filteredItems = [...catalogItems];
        renderItems();
        updateStats();
        updateVoicePreview();
      } catch (error) {
        console.error('Error loading catalog:', error);
        catalogItems = [];
        filteredItems = [];
        updateCategories();
        renderItems();
        updateStats();
      }
    }

    function updateCategoriesFromData(categories) {
      categoryFilter.innerHTML = `<option value="">${VocaliaI18n.t('dashboard.common.all_categories')}</option>`;
      categories.forEach(cat => {
        categoryFilter.innerHTML += `<option value="${escapeHtml(cat)}">${escapeHtml(cat)}</option>`;
      });
    }

    // No mock data - catalog must be populated via API or import

    function filterItems() {
      const search = searchInput.value.toLowerCase();
      const category = categoryFilter.value;
      const status = statusFilter.value;

      filteredItems = catalogItems.filter(item => {
        const matchesSearch = !search ||
          item.name?.toLowerCase().includes(search) ||
          item.id?.toLowerCase().includes(search);

        const matchesCategory = !category || item.category === category;

        let matchesStatus = true;
        if (status === 'available') matchesStatus = item.in_stock !== false && item.available !== false;
        else if (status === 'out_of_stock') matchesStatus = item.in_stock === false || item.available === false;
        else if (status === 'low_stock') matchesStatus = item.stock > 0 && item.stock <= 5;

        return matchesSearch && matchesCategory && matchesStatus;
      });

      currentPage = 1;
      renderItems();
    }

    function updateCategories() {
      const categories = [...new Set(catalogItems.map(item => item.category).filter(Boolean))];
      categoryFilter.innerHTML = `<option value="">${VocaliaI18n.t('dashboard.common.all_categories')}</option>`;
      categories.forEach(cat => {
        categoryFilter.innerHTML += `<option value="${escapeHtml(cat)}">${escapeHtml(cat)}</option>`;
      });
    }

    function renderItems() {
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageItems = filteredItems.slice(start, end);

      if (pageItems.length === 0) {
        catalogItemsBody.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }

      emptyState.classList.add('hidden');

      catalogItemsBody.innerHTML = pageItems.map(item => {
        const isAvailable = item.in_stock !== false && item.available !== false;
        const isLowStock = item.stock !== undefined && item.stock > 0 && item.stock <= 5;

        let statusBadge;
        if (!isAvailable || item.stock === 0) {
          statusBadge = `<span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400">${VocaliaI18n.t('dashboard.catalog_page.out_of_stock')}</span>`;
        } else if (isLowStock) {
          statusBadge = `<span class="px-2 py-1 text-xs font-medium rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400">${VocaliaI18n.t('dashboard.catalog_page.low_stock')}</span>`;
        } else {
          statusBadge = `<span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400">${VocaliaI18n.t('dashboard.catalog_page.available')}</span>`;
        }

        return `
          <tr class="hover:bg-zinc-50 dark:hover:bg-white/[0.08]">
            <td class="px-4 py-3">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-zinc-100 dark:bg-white/[0.06] flex items-center justify-center flex-shrink-0">
                  <i data-lucide="package" class="w-5 h-5 text-zinc-400"></i>
                </div>
                <div>
                  <p class="font-medium text-zinc-900 dark:text-white">${escapeHtml(item.name)}</p>
                  <p class="text-xs text-zinc-500">${escapeHtml(item.id || '-')}</p>
                </div>
              </div>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-zinc-600 dark:text-zinc-400">${escapeHtml(item.category || '-')}</span>
            </td>
            <td class="px-4 py-3">
              <span class="font-medium text-zinc-900 dark:text-white">${item.price} ${item.currency || 'EUR'}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-zinc-600 dark:text-zinc-400">${item.stock !== undefined ? item.stock : '-'}</span>
            </td>
            <td class="px-4 py-3">
              ${statusBadge}
            </td>
            <td class="px-4 py-3 text-right">
              <button class="p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-white/[0.08] text-zinc-400 hover:text-zinc-600" onclick="editItem('${escapeHtml(item.id)}')">
                <i data-lucide="pencil" class="w-4 h-4"></i>
              </button>
              <button class="p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/30 text-zinc-400 hover:text-red-600" onclick="deleteItem('${escapeHtml(item.id)}')">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </td>
          </tr>
        `;
      }).join('');

      // Update pagination
      document.getElementById('page-start').textContent = start + 1;
      document.getElementById('page-end').textContent = Math.min(end, filteredItems.length);
      document.getElementById('total-items').textContent = filteredItems.length;
      document.getElementById('prev-page').disabled = currentPage === 1;
      document.getElementById('next-page').disabled = end >= filteredItems.length;

      // Re-init icons
      lucide.createIcons();
    }

    function updateStats() {
      const total = catalogItems.length;
      const available = catalogItems.filter(i => i.in_stock !== false && i.available !== false).length;
      const lowStock = catalogItems.filter(i => i.stock !== undefined && i.stock > 0 && i.stock <= 5).length;

      document.getElementById('stat-total').textContent = total;
      document.getElementById('stat-available').textContent = available;
      document.getElementById('stat-low-stock').textContent = lowStock;
      document.getElementById('stat-last-sync').textContent = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
    }

    function updateVoicePreview() {
      const count = catalogItems.length;
      const available = catalogItems.filter(i => i.in_stock !== false && i.available !== false).length;

      let preview = '';
      if (count === 0) {
        preview = '"Le catalogue n\'est pas encore configuré. Souhaitez-vous ajouter des articles?"';
      } else {
        const samples = catalogItems.slice(0, 3).map(i => escapeHtml(i.name)).join(', ');
        preview = `"Nous proposons ${available} articles disponibles, notamment ${samples}. Que souhaitez-vous consulter?"`;
      }

      voicePreview.innerHTML = `<p class="text-sm italic">${escapeHtml(preview)}</p>`;
    }

    let editingItemId = null;

    function editItem(id) {
      const item = catalogItems.find(i => i.id === id);
      if (item) {
        editingItemId = id;
        // Populate form and show modal
        const form = document.getElementById('add-item-form');
        form.elements.name.value = item.name;
        form.elements.sku.value = item.id;
        form.elements.price.value = item.price;
        form.elements.stock.value = item.stock || '';
        form.elements.category.value = item.category || '';
        form.elements.description.value = item.description || '';
        form.elements.voice_description.value = item.voice_description || item.voiceDescription || '';
        form.elements.available.checked = item.in_stock !== false && item.available !== false;
        document.querySelector('#add-modal h3').textContent = VocaliaI18n.t('dashboard.catalog_page.edit_item');
        addModal.classList.remove('hidden');
      }
    }

    function resetAddModal() {
      editingItemId = null;
      document.getElementById('add-item-form').reset();
      document.querySelector('#add-modal h3').textContent = VocaliaI18n.t('dashboard.catalog_page.add_item');
    }

    async function deleteItem(id) {
      if (!confirm(VocaliaI18n.t('dashboard.catalog_page.delete_item_confirm'))) return;

      try {
        await api.delete(`/tenants/${tenantId}/catalog/${id}`, { params: { type: currentType.toUpperCase() } });
        toast.success(VocaliaI18n.t('dashboard.catalog_page.item_deleted'));
      } catch (error) {
        console.error('Error deleting item:', error);
      }

      // Update local state
      catalogItems = catalogItems.filter(i => i.id !== id);
      filteredItems = filteredItems.filter(i => i.id !== id);
      renderItems();
      updateStats();
      updateVoicePreview();
    }


    // Expose functions for onclick handlers in dynamic HTML
    window.editItem = editItem;
    window.deleteItem = deleteItem;
    window.previewVoice = typeof previewVoice === 'function' ? previewVoice : () => {};

    // Pagination
    document.getElementById('prev-page').addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderItems();
      }
    });

    document.getElementById('next-page').addEventListener('click', () => {
      const maxPage = Math.ceil(filteredItems.length / itemsPerPage);
      if (currentPage < maxPage) {
        currentPage++;
        renderItems();
      }
    });

    // =========================================================================
    // CONNECTOR CONFIGURATION (Session 250.71)
    // E-commerce platform integration: Shopify, WooCommerce, Square, Lightspeed, Magento
    // =========================================================================

    const connectorModal = document.getElementById('connector-modal');
    const connectorPlatforms = document.getElementById('connector-platforms');
    const connectorConfig = document.getElementById('connector-config');
    let selectedPlatform = null;

    // Platform configuration templates
    const platformConfigs = {
      shopify: {
        name: 'Shopify',
        icon: '/public/images/logos/shopify.svg',
        fields: [
          { name: 'shop', label: 'Nom de boutique', placeholder: 'ma-boutique (sans .myshopify.com)', required: true },
          { name: 'accessToken', label: 'Access Token', placeholder: 'shpat_xxxxxxxxxxxx', required: true, type: 'password' }
        ],
        help: 'Shopify Admin → Settings → Apps → Develop apps → Create app'
      },
      woocommerce: {
        name: 'WooCommerce',
        icon: '/public/images/logos/woocommerce.svg',
        fields: [
          { name: 'storeUrl', label: 'URL de la boutique', placeholder: 'https://monsite.com', required: true },
          { name: 'consumerKey', label: 'Consumer Key', placeholder: 'ck_xxxxxxxxxxxx', required: true },
          { name: 'consumerSecret', label: 'Consumer Secret', placeholder: 'cs_xxxxxxxxxxxx', required: true, type: 'password' }
        ],
        help: 'WooCommerce → Settings → Advanced → REST API → Add key'
      },
      square: {
        name: 'Square POS',
        icon: '/public/images/logos/square.svg',
        fields: [
          { name: 'accessToken', label: 'Access Token', placeholder: 'sq0atp-xxxxxxxxxxxx', required: true, type: 'password' },
          { name: 'locationId', label: 'Location ID (optionnel)', placeholder: 'LXXXXXXXXXXXXXXX', required: false }
        ],
        help: 'Square Developer Dashboard → Applications → Credentials'
      },
      lightspeed: {
        name: 'Lightspeed',
        icon: '/public/images/logos/lightspeed.svg',
        fields: [
          { name: 'accessToken', label: 'Access Token', placeholder: 'Bearer token', required: true, type: 'password' },
          { name: 'series', label: 'Type', placeholder: 'K (Restaurant) ou X (Retail)', required: false, defaultValue: 'K' },
          { name: 'businessId', label: 'Business ID', placeholder: 'ID de votre établissement', required: false }
        ],
        help: 'Lightspeed Developer Portal → API Credentials'
      },
      magento: {
        name: 'Magento/Adobe Commerce',
        icon: '/public/images/logos/magento.svg',
        fields: [
          { name: 'baseUrl', label: 'URL du site', placeholder: 'https://magento.example.com', required: true },
          { name: 'accessToken', label: 'Access Token', placeholder: 'Bearer token', required: true, type: 'password' }
        ],
        help: 'Admin → System → Integrations → Add New Integration'
      },
      custom: {
        name: 'JSON/CSV',
        icon: null,
        fields: [],
        help: 'Importez vos produits via fichier JSON ou CSV'
      }
    };

    // Open connector modal from import modal platform buttons
    document.querySelectorAll('.connect-platform').forEach(btn => {
      btn.addEventListener('click', () => {
        importModal.classList.add('hidden');
        selectedPlatform = btn.dataset.platform;
        showConnectorConfig(selectedPlatform);
        connectorModal.classList.remove('hidden');
      });
    });

    // Platform selection in connector modal
    document.querySelectorAll('.platform-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        selectedPlatform = btn.dataset.platform;
        if (selectedPlatform === 'custom') {
          connectorModal.classList.add('hidden');
          importModal.classList.remove('hidden');
        } else {
          showConnectorConfig(selectedPlatform);
        }
      });
    });

    function showConnectorConfig(platform) {
      const config = platformConfigs[platform];
      if (!config) return;

      // Update header
      document.getElementById('selected-platform-name').textContent = config.name;
      const iconEl = document.getElementById('selected-platform-icon');
      if (config.icon) {
        iconEl.src = config.icon;
        iconEl.classList.remove('hidden');
      } else {
        iconEl.classList.add('hidden');
      }

      // Build form fields
      const fieldsHtml = config.fields.map(field => `
        <div>
          <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1">${field.label}${field.required ? ' *' : ''}</label>
          <input type="${field.type || 'text'}" name="${field.name}" ${field.required ? 'required' : ''}
            value="${field.defaultValue || ''}"
            placeholder="${field.placeholder}"
            class="w-full px-3 py-2 border border-zinc-300 dark:border-white/[0.08] rounded-lg bg-white dark:bg-white/[0.06] text-zinc-900 dark:text-white">
        </div>
      `).join('');

      const helpHtml = config.help ? `
        <div class="p-3 bg-zinc-50 dark:bg-white/[0.06] rounded-lg">
          <p class="text-xs text-zinc-500 dark:text-zinc-400">
            <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
            <strong>Où trouver les identifiants:</strong> ${config.help}
          </p>
        </div>
      ` : '';

      document.getElementById('config-fields').innerHTML = fieldsHtml + helpHtml;

      // Show config, hide platforms
      connectorPlatforms.classList.add('hidden');
      connectorConfig.classList.remove('hidden');
      lucide.createIcons();
    }

    // Back to platforms
    document.getElementById('back-to-platforms').addEventListener('click', () => {
      connectorConfig.classList.add('hidden');
      connectorPlatforms.classList.remove('hidden');
      selectedPlatform = null;
    });

    // Close connector modal
    document.getElementById('close-connector-modal').addEventListener('click', () => {
      connectorModal.classList.add('hidden');
      connectorConfig.classList.add('hidden');
      connectorPlatforms.classList.remove('hidden');
    });
    document.getElementById('connector-modal-backdrop').addEventListener('click', () => {
      connectorModal.classList.add('hidden');
      connectorConfig.classList.add('hidden');
      connectorPlatforms.classList.remove('hidden');
    });

    // Submit connector form
    document.getElementById('connector-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const config = { source: selectedPlatform };
      for (const [key, value] of formData.entries()) {
        if (value) config[key] = value;
      }

      try {
        document.getElementById('connect-btn').disabled = true;
        document.getElementById('connect-btn').innerHTML = `<i data-lucide="loader" class="w-5 h-5 animate-spin"></i> ${VocaliaI18n.t('common.connecting')}`;
        lucide.createIcons();

        const result = await api.put(`/tenants/${tenantId}/catalog/connector`, config);

        if (result.connected) {
          toast.success(VocaliaI18n.t('dashboard.catalog_page.connected_syncing').replace('{{name}}', platformConfigs[selectedPlatform].name));
          connectorModal.classList.add('hidden');
          connectorConfig.classList.add('hidden');
          connectorPlatforms.classList.remove('hidden');

          // Trigger sync
          await syncCatalog();
          await loadCatalog();
        } else {
          toast.error(VocaliaI18n.t('dashboard.catalog_page.connect_failed'));
        }
      } catch (error) {
        console.error('Connector error:', error);
        toast.error(error.message || VocaliaI18n.t('common.connection_error'));
      } finally {
        document.getElementById('connect-btn').disabled = false;
        document.getElementById('connect-btn').innerHTML = `<i data-lucide="plug" class="w-5 h-5"></i> ${VocaliaI18n.t('catalog.connect_sync')}`;
        lucide.createIcons();
      }
    });

    // Sync catalog
    async function syncCatalog() {
      try {
        await api.post(`/tenants/${tenantId}/catalog/sync`, { type: currentType.toUpperCase(), force: true });
        toast.success(VocaliaI18n.t('dashboard.catalog_page.sync_success'));
      } catch (error) {
        console.error('Sync error:', error);
      }
    }

    // Initialize
    loadCatalog();
  </script>
</body>

</html>