/* VocalIA Widget v2.7.0 - 2026-02-08 */
!function(){"use strict";function n(n){return n?String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}const e={fr:{title:"Tentez votre chance !",subtitle:"Tournez la roue pour gagner une surprise",spinButton:"TOURNER",spinning:"En cours...",emailPlaceholder:"Votre email pour recevoir le code",emailLabel:"Entrez votre email pour jouer",submitEmail:"Jouer maintenant",congratulations:"Felicitations !",youWon:"Vous avez gagne",discountCode:"Votre code promo",copyCode:"Copier le code",copied:"Copie !",useNow:"Utiliser maintenant",tryAgain:"Peut-etre la prochaine fois !",noLuck:"Pas de chance cette fois",alreadyPlayed:"Vous avez deja joue aujourd'hui",comeBackTomorrow:"Revenez demain pour une nouvelle chance !",voiceIntro:"Bienvenue ! Tournez la roue pour gagner des reductions exclusives.",voiceSpinning:"La roue tourne...",voiceWin:"Felicitations ! Vous avez gagne {{prize}} !",voiceLose:"Pas de chance cette fois. Revenez demain !",prizes:{discount5:"5% de reduction",discount10:"10% de reduction",discount15:"15% de reduction",discount20:"20% de reduction",discount30:"30% de reduction",freeShipping:"Livraison gratuite",tryAgain:"Reessayez"}},en:{title:"Try Your Luck!",subtitle:"Spin the wheel to win a surprise",spinButton:"SPIN",spinning:"Spinning...",emailPlaceholder:"Your email to receive the code",emailLabel:"Enter your email to play",submitEmail:"Play now",congratulations:"Congratulations!",youWon:"You won",discountCode:"Your promo code",copyCode:"Copy code",copied:"Copied!",useNow:"Use now",tryAgain:"Maybe next time!",noLuck:"No luck this time",alreadyPlayed:"You already played today",comeBackTomorrow:"Come back tomorrow for another chance!",voiceIntro:"Welcome! Spin the wheel to win exclusive discounts.",voiceSpinning:"The wheel is spinning...",voiceWin:"Congratulations! You won {{prize}}!",voiceLose:"No luck this time. Come back tomorrow!",prizes:{discount5:"5% off",discount10:"10% off",discount15:"15% off",discount20:"20% off",discount30:"30% off",freeShipping:"Free shipping",tryAgain:"Try again"}},es:{title:"Prueba tu suerte!",subtitle:"Gira la rueda para ganar una sorpresa",spinButton:"GIRAR",spinning:"Girando...",emailPlaceholder:"Tu email para recibir el codigo",emailLabel:"Ingresa tu email para jugar",submitEmail:"Jugar ahora",congratulations:"Felicidades!",youWon:"Ganaste",discountCode:"Tu codigo promocional",copyCode:"Copiar codigo",copied:"Copiado!",useNow:"Usar ahora",tryAgain:"Quizas la proxima!",noLuck:"Sin suerte esta vez",alreadyPlayed:"Ya jugaste hoy",comeBackTomorrow:"Vuelve manana para otra oportunidad!",voiceIntro:"Bienvenido! Gira la rueda para ganar descuentos exclusivos.",voiceSpinning:"La rueda esta girando...",voiceWin:"Felicidades! Ganaste {{prize}}!",voiceLose:"Sin suerte esta vez. Vuelve manana!",prizes:{discount5:"5% de descuento",discount10:"10% de descuento",discount15:"15% de descuento",discount20:"20% de descuento",discount30:"30% de descuento",freeShipping:"Envio gratis",tryAgain:"Intenta de nuevo"}},ar:{title:"جرب حظك!",subtitle:"ادر العجلة لتربح مفاجأة",spinButton:"ادر",spinning:"جاري الدوران...",emailPlaceholder:"بريدك لاستلام الكود",emailLabel:"ادخل بريدك للعب",submitEmail:"العب الآن",congratulations:"مبروك!",youWon:"ربحت",discountCode:"كود الخصم",copyCode:"نسخ الكود",copied:"تم النسخ!",useNow:"استخدم الآن",tryAgain:"ربما المرة القادمة!",noLuck:"لا حظ هذه المرة",alreadyPlayed:"لقد لعبت اليوم",comeBackTomorrow:"عد غداً لفرصة جديدة!",voiceIntro:"مرحبا! ادر العجلة لتربح خصومات حصرية.",voiceSpinning:"العجلة تدور...",voiceWin:"مبروك! ربحت {{prize}}!",voiceLose:"لا حظ هذه المرة. عد غداً!",prizes:{discount5:"خصم 5%",discount10:"خصم 10%",discount15:"خصم 15%",discount20:"خصم 20%",discount30:"خصم 30%",freeShipping:"شحن مجاني",tryAgain:"حاول مرة أخرى"}},ary:{title:"جرب الزهر ديالك!",subtitle:"دور الروضة باش تربح كادو",spinButton:"دور",spinning:"كتدور...",emailPlaceholder:"الإيميل ديالك باش تاخد الكود",emailLabel:"دخل الإيميل باش تلعب",submitEmail:"لعب دابا",congratulations:"مبروك عليك!",youWon:"ربحتي",discountCode:"الكود ديال التخفيض",copyCode:"كوبي الكود",copied:"تكوبيا!",useNow:"استعملو دابا",tryAgain:"يمكن المرة الجاية!",noLuck:"ما كانش الزهر هاد المرة",alreadyPlayed:"لعبتي هاد النهار",comeBackTomorrow:"رجع غدا باش تلعب!",voiceIntro:"مرحبا! دور الروضة باش تربح تخفيضات خاصة.",voiceSpinning:"الروضة كتدور...",voiceWin:"مبروك! ربحتي {{prize}}!",voiceLose:"ما كانش الزهر. رجع غدا!",prizes:{discount5:"تخفيض 5%",discount10:"تخفيض 10%",discount15:"تخفيض 15%",discount20:"تخفيض 20%",discount30:"تخفيض 30%",freeShipping:"التوصيل بلاش",tryAgain:"عاود"}}},t=[{id:"discount5",probability:30,color:"#5E6AD2",code:"SPIN5"},{id:"discount10",probability:25,color:"#10B981",code:"SPIN10"},{id:"discount15",probability:15,color:"#F59E0B",code:"SPIN15"},{id:"discount20",probability:10,color:"#8B5CF6",code:"SPIN20"},{id:"discount30",probability:5,color:"#EF4444",code:"SPIN30"},{id:"freeShipping",probability:5,color:"#EC4899",code:"FREESHIP"},{id:"tryAgain",probability:10,color:"#6B7280",code:null}];class i{constructor(n={}){this.config={tenantId:n.tenantId||this.detectTenantId(),lang:n.lang||this.detectLanguage(),prizes:n.prizes||t,voiceEnabled:!1!==n.voiceEnabled,requireEmail:!1!==n.requireEmail,cooldownHours:n.cooldownHours||24,spinDuration:n.spinDuration||5e3,onSpin:n.onSpin||null,onWin:n.onWin||null,onLose:n.onLose||null,onEmailCapture:n.onEmailCapture||null},this.state={isVisible:!1,isSpinning:!1,hasPlayed:!1,selectedPrize:null,email:null,currentRotation:0},this.elements={},this.translations=e[this.config.lang]||e.fr,this.isRTL=["ar","ary"].includes(this.config.lang),this.init()}detectTenantId(){return document.querySelector("[data-vocalia-tenant]")?.dataset.vocaliaTenant||"default"}detectLanguage(){const n=document.querySelector("[data-vocalia-lang]");if(n)return n.dataset.vocaliaLang;const e=new URLSearchParams(window.location.search);if(e.get("lang"))return e.get("lang");const t=navigator.language?.split("-")[0];return["fr","en","es","ar","ary"].includes(t)?t:"fr"}init(){if(!document.querySelector("#va-spin-wheel-styles")){const n=document.createElement("style");n.id="va-spin-wheel-styles",n.textContent='\n    .va-spin-overlay {\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.85);\n      backdrop-filter: blur(8px);\n      z-index: 10002;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      opacity: 0;\n      visibility: hidden;\n      transition: opacity 0.3s ease, visibility 0.3s ease;\n    }\n\n    .va-spin-overlay.active {\n      opacity: 1;\n      visibility: visible;\n    }\n\n    .va-spin-modal {\n      background: linear-gradient(135deg, #0f172a 0%, #0F1225 100%);\n      border: 2px solid rgba(94, 106, 210, 0.3);\n      border-radius: 24px;\n      max-width: 440px;\n      width: 95%;\n      padding: 32px;\n      text-align: center;\n      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5), 0 0 60px rgba(94, 106, 210, 0.2);\n      animation: vaSpinModalIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);\n    }\n\n    .va-spin-modal[dir="rtl"] {\n      text-align: right;\n    }\n\n    @keyframes vaSpinModalIn {\n      from { transform: scale(0.8) rotate(-10deg); opacity: 0; }\n      to { transform: scale(1) rotate(0deg); opacity: 1; }\n    }\n\n    .va-spin-close {\n      position: absolute;\n      top: 16px;\n      right: 16px;\n      width: 32px;\n      height: 32px;\n      border-radius: 50%;\n      background: rgba(255, 255, 255, 0.1);\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background 0.2s ease;\n      z-index: 10;\n    }\n\n    .va-spin-close:hover {\n      background: rgba(255, 255, 255, 0.2);\n    }\n\n    .va-spin-close svg {\n      width: 16px;\n      height: 16px;\n      fill: white;\n    }\n\n    [dir="rtl"] .va-spin-close {\n      right: auto;\n      left: 16px;\n    }\n\n    .va-spin-title {\n      color: #FFFFFF;\n      font-size: 28px;\n      font-weight: 700;\n      margin: 0 0 8px;\n      background: linear-gradient(135deg, #5E6AD2 0%, #10B981 100%);\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n      background-clip: text;\n    }\n\n    .va-spin-subtitle {\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 16px;\n      margin: 0 0 24px;\n    }\n\n    .va-spin-wheel-container {\n      position: relative;\n      width: 280px;\n      height: 280px;\n      margin: 0 auto 24px;\n    }\n\n    .va-spin-wheel {\n      width: 100%;\n      height: 100%;\n      border-radius: 50%;\n      position: relative;\n      transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);\n      box-shadow: 0 0 0 8px rgba(94, 106, 210, 0.3), 0 0 0 12px rgba(94, 106, 210, 0.15);\n    }\n\n    .va-spin-wheel.spinning {\n      animation: none;\n    }\n\n    .va-spin-segment {\n      position: absolute;\n      width: 50%;\n      height: 50%;\n      left: 50%;\n      top: 0;\n      transform-origin: 0% 100%;\n      overflow: hidden;\n    }\n\n    .va-spin-segment-inner {\n      position: absolute;\n      width: 200%;\n      height: 200%;\n      left: -100%;\n      transform-origin: 50% 100%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding-top: 20px;\n      box-sizing: border-box;\n    }\n\n    .va-spin-segment-text {\n      transform: rotate(90deg);\n      color: white;\n      font-size: 11px;\n      font-weight: 600;\n      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n      max-width: 70px;\n      text-align: center;\n      line-height: 1.2;\n    }\n\n    .va-spin-pointer {\n      position: absolute;\n      top: -15px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 0;\n      height: 0;\n      border-left: 15px solid transparent;\n      border-right: 15px solid transparent;\n      border-top: 30px solid #F59E0B;\n      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));\n      z-index: 10;\n    }\n\n    .va-spin-center {\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      width: 60px;\n      height: 60px;\n      border-radius: 50%;\n      background: linear-gradient(135deg, #0f172a 0%, #0F1225 100%);\n      border: 4px solid #5E6AD2;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 5;\n      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);\n    }\n\n    .va-spin-center svg {\n      width: 24px;\n      height: 24px;\n      fill: #5E6AD2;\n    }\n\n    .va-spin-email-form {\n      margin-bottom: 20px;\n    }\n\n    .va-spin-email-label {\n      color: rgba(255, 255, 255, 0.8);\n      font-size: 14px;\n      margin-bottom: 12px;\n      display: block;\n    }\n\n    .va-spin-email-input {\n      width: 100%;\n      padding: 14px 16px;\n      background: rgba(255, 255, 255, 0.05);\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 12px;\n      color: #FFFFFF;\n      font-size: 16px;\n      margin-bottom: 12px;\n      outline: none;\n      box-sizing: border-box;\n      transition: border-color 0.2s ease;\n    }\n\n    .va-spin-email-input:focus {\n      border-color: #5E6AD2;\n    }\n\n    .va-spin-email-input::placeholder {\n      color: rgba(255, 255, 255, 0.4);\n    }\n\n    .va-spin-btn {\n      width: 100%;\n      padding: 16px 24px;\n      border-radius: 12px;\n      font-size: 18px;\n      font-weight: 700;\n      cursor: pointer;\n      transition: all 0.3s ease;\n      border: none;\n      text-transform: uppercase;\n      letter-spacing: 1px;\n    }\n\n    .va-spin-btn.primary {\n      background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);\n      color: white;\n      box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);\n    }\n\n    .va-spin-btn.primary:hover:not(:disabled) {\n      transform: translateY(-2px);\n      box-shadow: 0 8px 30px rgba(245, 158, 11, 0.5);\n    }\n\n    .va-spin-btn.primary:disabled {\n      opacity: 0.6;\n      cursor: not-allowed;\n      transform: none;\n    }\n\n    .va-spin-btn.secondary {\n      background: rgba(94, 106, 210, 0.1);\n      color: #5E6AD2;\n      border: 1px solid rgba(94, 106, 210, 0.3);\n    }\n\n    .va-spin-btn.secondary:hover {\n      background: rgba(94, 106, 210, 0.2);\n    }\n\n    /* Result state */\n    .va-spin-result {\n      display: none;\n    }\n\n    .va-spin-result.active {\n      display: block;\n      animation: vaFadeIn 0.5s ease;\n    }\n\n    @keyframes vaFadeIn {\n      from { opacity: 0; transform: translateY(20px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n\n    .va-spin-result-icon {\n      width: 80px;\n      height: 80px;\n      margin: 0 auto 16px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .va-spin-result-icon.win {\n      background: linear-gradient(135deg, #10B981 0%, #059669 100%);\n      animation: vaPulse 1s infinite;\n    }\n\n    .va-spin-result-icon.lose {\n      background: rgba(107, 114, 128, 0.3);\n    }\n\n    @keyframes vaPulse {\n      0%, 100% { transform: scale(1); }\n      50% { transform: scale(1.1); }\n    }\n\n    .va-spin-result-icon svg {\n      width: 40px;\n      height: 40px;\n      fill: white;\n    }\n\n    .va-spin-result-title {\n      color: #FFFFFF;\n      font-size: 24px;\n      font-weight: 700;\n      margin-bottom: 8px;\n    }\n\n    .va-spin-result-prize {\n      color: #10B981;\n      font-size: 20px;\n      font-weight: 600;\n      margin-bottom: 16px;\n    }\n\n    .va-spin-code-container {\n      background: rgba(94, 106, 210, 0.1);\n      border: 1px dashed #5E6AD2;\n      border-radius: 12px;\n      padding: 16px;\n      margin-bottom: 16px;\n    }\n\n    .va-spin-code-label {\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 12px;\n      margin-bottom: 8px;\n    }\n\n    .va-spin-code {\n      color: #5E6AD2;\n      font-size: 28px;\n      font-weight: 700;\n      font-family: \'Courier New\', monospace;\n      letter-spacing: 3px;\n    }\n\n    .va-spin-copy-btn {\n      margin-top: 12px;\n      padding: 8px 16px;\n      background: transparent;\n      border: 1px solid rgba(94, 106, 210, 0.5);\n      border-radius: 8px;\n      color: #5E6AD2;\n      font-size: 14px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    }\n\n    .va-spin-copy-btn:hover {\n      background: rgba(94, 106, 210, 0.1);\n    }\n\n    .va-spin-copy-btn.copied {\n      background: rgba(16, 185, 129, 0.2);\n      border-color: #10B981;\n      color: #10B981;\n    }\n\n    /* Confetti */\n    .va-confetti {\n      position: fixed;\n      pointer-events: none;\n      z-index: 10003;\n    }\n\n    /* Mobile responsive */\n    @media (max-width: 480px) {\n      .va-spin-modal {\n        padding: 24px 20px;\n        border-radius: 20px 20px 0 0;\n        position: fixed;\n        bottom: 0;\n        max-height: 90vh;\n        overflow-y: auto;\n      }\n\n      .va-spin-title {\n        font-size: 24px;\n      }\n\n      .va-spin-wheel-container {\n        width: 240px;\n        height: 240px;\n      }\n\n      .va-spin-btn {\n        font-size: 16px;\n        padding: 14px 20px;\n      }\n    }\n  ',document.head.appendChild(n)}this.checkCooldown()}checkCooldown(){const n=localStorage.getItem("va_spin_wheel_last_played");n&&Date.now()-parseInt(n,10)<60*this.config.cooldownHours*60*1e3&&(this.state.hasPlayed=!0)}createModal(){const n=document.createElement("div");n.className="va-spin-overlay",n.id="va-spin-overlay",n.innerHTML=`\n        <div class="va-spin-modal" dir="${this.isRTL?"rtl":"ltr"}" role="dialog" aria-modal="true">\n          <button class="va-spin-close" aria-label="Close">\n            <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>\n          </button>\n\n          <div class="va-spin-game">\n            <h2 class="va-spin-title">${this.translations.title}</h2>\n            <p class="va-spin-subtitle">${this.translations.subtitle}</p>\n\n            <div class="va-spin-wheel-container">\n              <div class="va-spin-pointer"></div>\n              <div class="va-spin-wheel" id="va-spin-wheel">\n                ${this.generateWheelSegments()}\n              </div>\n              <div class="va-spin-center">\n                <svg viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>\n              </div>\n            </div>\n\n            ${this.config.requireEmail?`\n              <div class="va-spin-email-form">\n                <label class="va-spin-email-label">${this.translations.emailLabel}</label>\n                <input type="email" class="va-spin-email-input" placeholder="${this.translations.emailPlaceholder}" id="va-spin-email">\n                <button class="va-spin-btn primary" id="va-spin-submit">${this.translations.submitEmail}</button>\n              </div>\n            `:`\n              <button class="va-spin-btn primary" id="va-spin-btn">${this.translations.spinButton}</button>\n            `}\n          </div>\n\n          <div class="va-spin-result" id="va-spin-result">\n            <div class="va-spin-result-icon win" id="va-spin-result-icon">\n              <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>\n            </div>\n            <h3 class="va-spin-result-title" id="va-spin-result-title">${this.translations.congratulations}</h3>\n            <p class="va-spin-result-prize" id="va-spin-result-prize"></p>\n\n            <div class="va-spin-code-container" id="va-spin-code-container">\n              <div class="va-spin-code-label">${this.translations.discountCode}</div>\n              <div class="va-spin-code" id="va-spin-code"></div>\n              <button class="va-spin-copy-btn" id="va-spin-copy">${this.translations.copyCode}</button>\n            </div>\n\n            <button class="va-spin-btn primary" id="va-spin-use">${this.translations.useNow}</button>\n          </div>\n\n          <div class="va-spin-already-played" id="va-spin-already-played" style="display: none;">\n            <h3 class="va-spin-result-title">${this.translations.alreadyPlayed}</h3>\n            <p class="va-spin-subtitle">${this.translations.comeBackTomorrow}</p>\n          </div>\n        </div>\n      `,document.body.appendChild(n),this.elements.overlay=n,this.elements.wheel=n.querySelector("#va-spin-wheel"),this.elements.spinBtn=n.querySelector("#va-spin-btn")||n.querySelector("#va-spin-submit"),this.elements.emailInput=n.querySelector("#va-spin-email"),this.elements.closeBtn=n.querySelector(".va-spin-close"),this.elements.result=n.querySelector("#va-spin-result"),this.elements.resultIcon=n.querySelector("#va-spin-result-icon"),this.elements.resultTitle=n.querySelector("#va-spin-result-title"),this.elements.resultPrize=n.querySelector("#va-spin-result-prize"),this.elements.codeContainer=n.querySelector("#va-spin-code-container"),this.elements.code=n.querySelector("#va-spin-code"),this.elements.copyBtn=n.querySelector("#va-spin-copy"),this.elements.useBtn=n.querySelector("#va-spin-use"),this.elements.alreadyPlayed=n.querySelector("#va-spin-already-played"),this.elements.game=n.querySelector(".va-spin-game"),this.elements.closeBtn.addEventListener("click",()=>this.hide()),this.elements.overlay.addEventListener("click",n=>{n.target===this.elements.overlay&&this.hide()}),this.elements.spinBtn&&this.elements.spinBtn.addEventListener("click",()=>this.handleSpinClick()),this.elements.copyBtn&&this.elements.copyBtn.addEventListener("click",()=>this.copyCode()),this.elements.useBtn&&this.elements.useBtn.addEventListener("click",()=>this.useCode())}generateWheelSegments(){const e=this.config.prizes,t=360/e.length;let i="";return e.forEach((e,s)=>{const a=90-t,o=this.translations.prizes[e.id]||e.id;i+=`\n          <div class="va-spin-segment" style="transform: rotate(${s*t}deg) skewY(${a}deg);">\n            <div class="va-spin-segment-inner" style="background: ${n(e.color)}; transform: skewY(${-a}deg);">\n              <span class="va-spin-segment-text">${n(o)}</span>\n            </div>\n          </div>\n        `}),i}show(){this.elements.overlay||this.createModal(),this.state.hasPlayed?(this.elements.game.style.display="none",this.elements.alreadyPlayed.style.display="block"):(this.elements.game.style.display="block",this.elements.alreadyPlayed.style.display="none"),this.state.isVisible=!0,this.elements.overlay.classList.add("active"),this.config.voiceEnabled&&!this.state.hasPlayed&&setTimeout(()=>this.speak(this.translations.voiceIntro),500),this.trackEvent("spin_wheel_shown",{has_played:this.state.hasPlayed})}hide(){this.state.isVisible=!1,this.elements.overlay?.classList.remove("active")}handleSpinClick(){if(!this.state.isSpinning){if(this.config.requireEmail&&this.elements.emailInput){const n=this.elements.emailInput.value.trim();if(!n||!this.validateEmail(n))return void(this.elements.emailInput.style.borderColor="#EF4444");this.state.email=n,this.elements.emailInput.style.borderColor="",this.config.onEmailCapture&&this.config.onEmailCapture({email:n}),this.trackEvent("spin_wheel_email_captured",{email:n})}this.spin()}}validateEmail(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)}spin(){if(this.state.isSpinning||this.state.hasPlayed)return;this.state.isSpinning=!0,this.elements.spinBtn.disabled=!0,this.elements.spinBtn.textContent=this.translations.spinning,this.config.voiceEnabled&&this.speak(this.translations.voiceSpinning);const n=this.selectPrize();this.state.selectedPrize=n;const e=this.config.prizes,t=e.findIndex(e=>e.id===n.id),i=360/e.length,s=360-(t*i+i/2)+1800;this.state.currentRotation=s,this.elements.wheel.style.transform=`rotate(${s}deg)`,this.config.onSpin&&this.config.onSpin({prize:n}),this.trackEvent("spin_wheel_spun",{prize_id:n.id,prize_code:n.code,email:this.state.email}),setTimeout(()=>{this.showResult(n)},this.config.spinDuration+500)}selectPrize(){const n=this.config.prizes,e=n.reduce((n,e)=>n+e.probability,0);let t=Math.random()*e;for(const e of n)if(t-=e.probability,t<=0)return e;return n[n.length-1]}async showResult(n){const e=null!==n.code;if(this.elements.game.style.display="none",this.elements.result.classList.add("active"),e){let e=n.code;const t={discount5:5,discount10:10,discount15:15,discount20:20,discount30:30,freeShipping:0}[n.id]||10;try{const i=window.VOCALIA_CONFIG&&window.VOCALIA_CONFIG.api_url||"";if(i){const s=await fetch(`${i}/api/promo/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenant_id:window.VOCALIA_CONFIG&&window.VOCALIA_CONFIG.tenant_id||"unknown",prize_id:n.id,discount_percent:t,email:this.state.email||null})});if(s.ok){const n=await s.json();n.success&&n.code&&(e=n.code)}}}catch{}if(this.elements.resultIcon.className="va-spin-result-icon win",this.elements.resultIcon.innerHTML='<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',this.elements.resultTitle.textContent=this.translations.congratulations,this.elements.resultPrize.textContent=`${this.translations.youWon} ${this.translations.prizes[n.id]}`,this.elements.code.textContent=e,this.state.activeCode=e,this.elements.codeContainer.style.display="block",this.elements.useBtn.style.display="block",this.showConfetti(),this.config.voiceEnabled){const e=this.translations.voiceWin.replace("{{prize}}",this.translations.prizes[n.id]);this.speak(e)}this.config.onWin&&this.config.onWin({prize:n,code:e,email:this.state.email}),this.trackEvent("spin_wheel_won",{prize_id:n.id,prize_code:e,email:this.state.email})}else this.elements.resultIcon.className="va-spin-result-icon lose",this.elements.resultIcon.innerHTML='<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>',this.elements.resultTitle.textContent=this.translations.tryAgain,this.elements.resultPrize.textContent=this.translations.noLuck,this.elements.codeContainer.style.display="none",this.elements.useBtn.style.display="none",this.config.voiceEnabled&&this.speak(this.translations.voiceLose),this.config.onLose&&this.config.onLose({email:this.state.email}),this.trackEvent("spin_wheel_lost",{email:this.state.email});this.state.hasPlayed=!0,localStorage.setItem("va_spin_wheel_last_played",Date.now().toString())}showConfetti(){const n=["#5E6AD2","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"];for(let e=0;e<50;e++){const e=document.createElement("div");e.className="va-confetti",e.style.cssText=`\n          position: fixed;\n          width: ${10*Math.random()+5}px;\n          height: ${10*Math.random()+5}px;\n          background: ${n[Math.floor(Math.random()*n.length)]};\n          left: ${100*Math.random()}vw;\n          top: -20px;\n          border-radius: ${Math.random()>.5?"50%":"0"};\n          animation: confettiFall ${3*Math.random()+2}s linear forwards;\n          z-index: 10003;\n        `,document.body.appendChild(e),setTimeout(()=>e.remove(),5e3)}if(!document.querySelector("#va-confetti-style")){const n=document.createElement("style");n.id="va-confetti-style",n.textContent="\n          @keyframes confettiFall {\n            0% { transform: translateY(0) rotate(0deg); opacity: 1; }\n            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }\n          }\n        ",document.head.appendChild(n)}}copyCode(){const n=this.state.selectedPrize?.code;n&&navigator.clipboard.writeText(n).then(()=>{this.elements.copyBtn.textContent=this.translations.copied,this.elements.copyBtn.classList.add("copied"),setTimeout(()=>{this.elements.copyBtn.textContent=this.translations.copyCode,this.elements.copyBtn.classList.remove("copied")},2e3),this.trackEvent("spin_wheel_code_copied",{code:n})})}useCode(){const n=this.state.activeCode||this.state.selectedPrize?.code;if(!n)return;navigator.clipboard&&navigator.clipboard.writeText(n),this.trackEvent("spin_wheel_code_used",{code:n});const e=new URL("/checkout",window.location.origin);e.searchParams.set("discount",n),window.location.href=e.toString()}speak(n){if(!window.speechSynthesis)return;const e=new SpeechSynthesisUtterance(n);e.lang={fr:"fr-FR",en:"en-US",es:"es-ES",ar:"ar-SA",ary:"ar-MA"}[this.config.lang]||"fr-FR",e.rate=.9,e.pitch=1,window.speechSynthesis.speak(e)}trackEvent(n,e={}){i.hasAnalyticsConsent()&&(window.gtag&&window.gtag("event",n,{event_category:"gamification",tenant_id:this.config.tenantId,...e}),window.plausible&&window.plausible(n,{props:e}),window.VocalIA?.trackEvent&&window.VocalIA.trackEvent(n,e))}static hasAnalyticsConsent(){if(window.VOCALIA_CONFIG&&!1===window.VOCALIA_CONFIG.analytics_consent)return!1;if(window.VOCALIA_CONFIG&&!0===window.VOCALIA_CONFIG.analytics_consent)return!0;try{if("denied"===localStorage.getItem("va_consent"))return!1}catch{}return!(typeof window.CookieConsent<"u"&&!window.CookieConsent.allowedCategory?.("analytics")||(window,0))}reset(){this.state.hasPlayed=!1,this.state.isSpinning=!1,this.state.selectedPrize=null,localStorage.removeItem("va_spin_wheel_last_played"),this.elements.wheel&&(this.elements.wheel.style.transform="rotate(0deg)")}destroy(){this.hide(),this.elements.overlay?.remove()}}let s=null;function a(n={}){return s&&s.destroy(),s=new i(n),s}function o(n={}){return s||(s=new i(n)),s.show(),s}window.VocaliaSpinWheel={init:a,show:o,getInstance:()=>s,SpinWheel:i},typeof window.VocalIA<"u"&&(window.VocalIA.SpinWheel=window.VocaliaSpinWheel,window.VocalIA.showSpinWheel=function(n={}){return o(n)},window.VocalIA.isSpinWheelAvailable=function(){const n=localStorage.getItem("va_spin_wheel_last_played");return!n||Date.now()-parseInt(n,10)>=864e5}),document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelector("[data-vocalia-spin-wheel]");n&&(a({tenantId:n.dataset.vocaliaTenant,lang:n.dataset.vocaliaLang,voiceEnabled:"false"!==n.dataset.voice,requireEmail:"false"!==n.dataset.requireEmail}),"auto"===(n.dataset.trigger||"manual")&&setTimeout(()=>o(),parseInt(n.dataset.delay)||5e3))})}();