/* VocalIA Widget v2.7.0 - 2026-02-16 */
!function(e){"use strict";function n(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}const t={skincare:{title:{fr:"Trouvez votre routine parfaite",en:"Find Your Perfect Routine",es:"Encuentra tu rutina perfecta",ar:"اعثر على روتينك المثالي",ary:"لقى روتينك لي يناسبك"},questions:[{id:"skin_type",question:{fr:"Quel est votre type de peau ?",en:"What is your skin type?",es:"¿Cuál es tu tipo de piel?",ar:"ما هو نوع بشرتك؟",ary:"شنو نوع جلدك?"},options:[{value:"dry",label:{fr:"Sèche",en:"Dry",es:"Seca",ar:"جافة",ary:"ناشف"}},{value:"oily",label:{fr:"Grasse",en:"Oily",es:"Grasa",ar:"دهنية",ary:"دهني"}},{value:"combination",label:{fr:"Mixte",en:"Combination",es:"Mixta",ar:"مختلطة",ary:"مخلوط"}},{value:"sensitive",label:{fr:"Sensible",en:"Sensitive",es:"Sensible",ar:"حساسة",ary:"حساس"}}],tags:{dry:["hydrating","moisturizing"],oily:["mattifying","oil-control"],combination:["balancing"],sensitive:["gentle","calming"]}},{id:"concern",question:{fr:"Quelle est votre préoccupation principale ?",en:"What is your main concern?",es:"¿Cuál es tu principal preocupación?",ar:"ما هو قلقك الرئيسي؟",ary:"شنو لي كيهمك بزاف?"},options:[{value:"acne",label:{fr:"Acné",en:"Acne",es:"Acné",ar:"حب الشباب",ary:"الحبوب"}},{value:"aging",label:{fr:"Anti-âge",en:"Anti-aging",es:"Anti-edad",ar:"مكافحة الشيخوخة",ary:"ضد الشيخوخة"}},{value:"hydration",label:{fr:"Hydratation",en:"Hydration",es:"Hidratación",ar:"ترطيب",ary:"الترطيب"}},{value:"brightening",label:{fr:"Éclat",en:"Brightening",es:"Luminosidad",ar:"إشراق",ary:"البريق"}}],tags:{acne:["salicylic","anti-acne"],aging:["retinol","anti-wrinkle"],hydration:["hyaluronic","moisturizing"],brightening:["vitamin-c","brightening"]}},{id:"budget",question:{fr:"Quel est votre budget ?",en:"What is your budget?",es:"¿Cuál es tu presupuesto?",ar:"ما هي ميزانيتك؟",ary:"شحال معاك تصرف?"},options:[{value:"budget",label:{fr:"Économique (< 50€)",en:"Budget (< $50)",es:"Económico (< 50€)",ar:"اقتصادي (< 50$)",ary:"رخيص (< 500 DH)"}},{value:"mid",label:{fr:"Moyen (50-100€)",en:"Mid-range ($50-100)",es:"Medio (50-100€)",ar:"متوسط (50-100$)",ary:"معتدل (500-1000 DH)"}},{value:"premium",label:{fr:"Premium (100€+)",en:"Premium ($100+)",es:"Premium (100€+)",ar:"ممتاز (100$+)",ary:"غالي (+1000 DH)"}}],priceRanges:{budget:{max:50},mid:{min:50,max:100},premium:{min:100}}}]},electronics:{title:{fr:"Trouvez l'appareil idéal",en:"Find Your Ideal Device",es:"Encuentra tu dispositivo ideal",ar:"اعثر على جهازك المثالي",ary:"لقى الجهاز لي يناسبك"},questions:[{id:"usage",question:{fr:"Quelle sera l'utilisation principale ?",en:"What will be the main use?",es:"¿Cuál será el uso principal?",ar:"ما هو الاستخدام الرئيسي؟",ary:"شنو غادي دير بيه؟"},options:[{value:"work",label:{fr:"Travail",en:"Work",es:"Trabajo",ar:"عمل",ary:"خدمة"}},{value:"gaming",label:{fr:"Gaming",en:"Gaming",es:"Gaming",ar:"ألعاب",ary:"العاب"}},{value:"casual",label:{fr:"Usage quotidien",en:"Daily use",es:"Uso diario",ar:"استخدام يومي",ary:"كل يوم"}},{value:"creative",label:{fr:"Création",en:"Creative work",es:"Creación",ar:"إبداعي",ary:"إبداع"}}],tags:{work:["professional","productivity"],gaming:["gaming","high-performance"],casual:["everyday","budget-friendly"],creative:["creative","high-specs"]}},{id:"priority",question:{fr:"Quelle est votre priorité ?",en:"What is your priority?",es:"¿Cuál es tu prioridad?",ar:"ما هي أولويتك؟",ary:"شنو لي مهم عندك بزاف؟"},options:[{value:"performance",label:{fr:"Performance",en:"Performance",es:"Rendimiento",ar:"أداء",ary:"القوة"}},{value:"battery",label:{fr:"Autonomie",en:"Battery life",es:"Batería",ar:"عمر البطارية",ary:"البطارية"}},{value:"portability",label:{fr:"Portabilité",en:"Portability",es:"Portabilidad",ar:"قابلية النقل",ary:"خفيف"}},{value:"price",label:{fr:"Prix",en:"Price",es:"Precio",ar:"السعر",ary:"الثمن"}}]}]},generic:{title:{fr:"Trouvez votre produit idéal",en:"Find Your Ideal Product",es:"Encuentra tu producto ideal",ar:"اعثر على منتجك المثالي",ary:"لقى المنتوج لي يناسبك"},questions:[{id:"need",question:{fr:"Qu'est-ce que vous recherchez ?",en:"What are you looking for?",es:"¿Qué estás buscando?",ar:"ما الذي تبحث عنه؟",ary:"شنو كتقلب عليه؟"},voiceKeywords:{fr:["cherche","besoin","voudrais"],en:["looking","need","want"],es:["busco","necesito","quiero"],ar:["أبحث","أريد"],ary:["كنقلب","بغيت"]}},{id:"budget",question:{fr:"Quel est votre budget ?",en:"What is your budget?",es:"¿Cuál es tu presupuesto?",ar:"ما هي ميزانيتك؟",ary:"شحال معاك؟"},options:[{value:"low",label:{fr:"< 50€",en:"< $50",es:"< 50€",ar:"< 50$",ary:"< 500 DH"}},{value:"mid",label:{fr:"50-150€",en:"$50-150",es:"50-150€",ar:"50-150$",ary:"500-1500 DH"}},{value:"high",label:{fr:"> 150€",en:"> $150",es:"> 150€",ar:"> 150$",ary:"> 1500 DH"}}]}]}};class i{constructor(e={}){this.options={tenantId:e.tenantId||this._detectTenantId(),template:"generic",customQuestions:null,lang:"fr",voiceEnabled:!0,onComplete:null,onLeadCapture:null,apiBaseUrl:typeof window<"u"&&window.VOCALIA_CONFIG&&window.VOCALIA_CONFIG.api_url||(typeof window<"u"&&("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)?"http://localhost:3013":"https://api.vocalia.ma"),...e},this.container=null,this.isVisible=!1,this.currentStep=0,this.answers={},this.questions=[],this.isListening=!1,this.recognition=null,this._initQuestions(),this._initVoiceRecognition()}_detectTenantId(){if(typeof window<"u"&&window.VOCALIA_CONFIG&&window.VOCALIA_CONFIG.tenant_id)return window.VOCALIA_CONFIG.tenant_id;const e=typeof document<"u"&&document.querySelector("[data-vocalia-tenant]");return e?e.dataset.vocaliaTenant:null}_injectStyles(e){if(e.querySelector("#va-quiz-styles"))return;const n=document.createElement("style");n.id="va-quiz-styles",n.textContent='\n    .va-quiz-overlay {\n      position: fixed;\n      inset: 0;\n      background: rgba(0, 0, 0, 0.7);\n      backdrop-filter: blur(8px);\n      z-index: 10003;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      opacity: 0;\n      visibility: hidden;\n      transition: all 0.3s ease;\n    }\n\n    .va-quiz-overlay.va-quiz-visible {\n      opacity: 1;\n      visibility: visible;\n    }\n\n    .va-quiz-container {\n      width: 90%;\n      max-width: 500px;\n      max-height: 90vh;\n      background: linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(30, 41, 59, 0.95));\n      border-radius: 20px;\n      border: 1px solid rgba(139, 92, 246, 0.3);\n      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 30px rgba(139, 92, 246, 0.15);\n      overflow: hidden;\n      transform: scale(0.9) translateY(20px);\n      transition: transform 0.3s ease;\n    }\n\n    .va-quiz-visible .va-quiz-container {\n      transform: scale(1) translateY(0);\n    }\n\n    .va-quiz-header {\n      padding: 20px;\n      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.15));\n      border-bottom: 1px solid rgba(139, 92, 246, 0.2);\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .va-quiz-title {\n      color: #e2e8f0;\n      font-size: 18px;\n      font-weight: 600;\n      display: flex;\n      align-items: center;\n      gap: 10px;\n    }\n\n    .va-quiz-title svg {\n      width: 24px;\n      height: 24px;\n      color: #8b5cf6;\n    }\n\n    .va-quiz-close {\n      background: rgba(255, 255, 255, 0.1);\n      border: none;\n      color: #94a3b8;\n      cursor: pointer;\n      padding: 8px;\n      border-radius: 8px;\n      transition: all 0.2s;\n    }\n\n    .va-quiz-close:hover {\n      background: rgba(255, 255, 255, 0.15);\n      color: #e2e8f0;\n    }\n\n    .va-quiz-progress {\n      padding: 0 20px;\n      margin-top: 16px;\n    }\n\n    .va-quiz-progress-bar {\n      height: 4px;\n      background: rgba(255, 255, 255, 0.1);\n      border-radius: 2px;\n      overflow: hidden;\n    }\n\n    .va-quiz-progress-fill {\n      height: 100%;\n      background: linear-gradient(90deg, #8b5cf6, #3b82f6);\n      border-radius: 2px;\n      transition: width 0.3s ease;\n    }\n\n    .va-quiz-progress-text {\n      color: #64748b;\n      font-size: 12px;\n      margin-top: 8px;\n      text-align: right;\n    }\n\n    .va-quiz-content {\n      padding: 24px 20px;\n      max-height: 50vh;\n      overflow-y: auto;\n    }\n\n    .va-quiz-question {\n      color: #e2e8f0;\n      font-size: 20px;\n      font-weight: 500;\n      line-height: 1.4;\n      margin-bottom: 24px;\n      text-align: center;\n    }\n\n    .va-quiz-options {\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    }\n\n    .va-quiz-option {\n      background: rgba(255, 255, 255, 0.05);\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      border-radius: 12px;\n      padding: 16px 20px;\n      color: #e2e8f0;\n      font-size: 15px;\n      text-align: left;\n      cursor: pointer;\n      transition: all 0.2s;\n      display: flex;\n      align-items: center;\n      gap: 12px;\n    }\n\n    .va-quiz-option:hover {\n      background: rgba(139, 92, 246, 0.15);\n      border-color: rgba(139, 92, 246, 0.4);\n      transform: translateX(4px);\n    }\n\n    .va-quiz-option.va-quiz-selected {\n      background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(59, 130, 246, 0.2));\n      border-color: #8b5cf6;\n    }\n\n    .va-quiz-option-icon {\n      width: 24px;\n      height: 24px;\n      border-radius: 50%;\n      background: rgba(255, 255, 255, 0.1);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n    }\n\n    .va-quiz-option.va-quiz-selected .va-quiz-option-icon {\n      background: #8b5cf6;\n    }\n\n    .va-quiz-option-icon svg {\n      width: 14px;\n      height: 14px;\n      color: #94a3b8;\n    }\n\n    .va-quiz-option.va-quiz-selected .va-quiz-option-icon svg {\n      color: white;\n    }\n\n    .va-quiz-voice-section {\n      margin-top: 20px;\n      padding: 16px;\n      background: rgba(139, 92, 246, 0.1);\n      border-radius: 12px;\n      text-align: center;\n    }\n\n    .va-quiz-voice-hint {\n      color: #a78bfa;\n      font-size: 13px;\n      margin-bottom: 12px;\n    }\n\n    .va-quiz-voice-btn {\n      background: linear-gradient(135deg, #8b5cf6, #6366f1);\n      border: none;\n      color: white;\n      padding: 14px 24px;\n      border-radius: 50px;\n      font-size: 15px;\n      font-weight: 500;\n      cursor: pointer;\n      transition: all 0.2s;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .va-quiz-voice-btn:hover {\n      transform: scale(1.05);\n      box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);\n    }\n\n    .va-quiz-voice-btn.va-quiz-listening {\n      animation: va-quiz-pulse 1.5s infinite;\n    }\n\n    @keyframes va-quiz-pulse {\n      0%, 100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4); }\n      50% { box-shadow: 0 0 0 15px rgba(139, 92, 246, 0); }\n    }\n\n    .va-quiz-voice-btn svg {\n      width: 20px;\n      height: 20px;\n    }\n\n    .va-quiz-footer {\n      padding: 16px 20px;\n      border-top: 1px solid rgba(255, 255, 255, 0.1);\n      display: flex;\n      justify-content: space-between;\n      gap: 12px;\n    }\n\n    .va-quiz-btn {\n      flex: 1;\n      padding: 14px 20px;\n      border-radius: 10px;\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n      transition: all 0.2s;\n      border: none;\n    }\n\n    .va-quiz-btn-back {\n      background: rgba(255, 255, 255, 0.1);\n      color: #94a3b8;\n    }\n\n    .va-quiz-btn-back:hover {\n      background: rgba(255, 255, 255, 0.15);\n      color: #e2e8f0;\n    }\n\n    .va-quiz-btn-next {\n      background: linear-gradient(135deg, #8b5cf6, #6366f1);\n      color: white;\n    }\n\n    .va-quiz-btn-next:hover:not(:disabled) {\n      transform: translateY(-1px);\n      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n    }\n\n    .va-quiz-btn-next:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    /* Results screen */\n    .va-quiz-results {\n      text-align: center;\n      padding: 20px;\n    }\n\n    .va-quiz-results-icon {\n      width: 64px;\n      height: 64px;\n      background: linear-gradient(135deg, #10b981, #059669);\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      margin: 0 auto 20px;\n    }\n\n    .va-quiz-results-icon svg {\n      width: 32px;\n      height: 32px;\n      color: white;\n    }\n\n    .va-quiz-results-title {\n      color: #e2e8f0;\n      font-size: 22px;\n      font-weight: 600;\n      margin-bottom: 12px;\n    }\n\n    .va-quiz-results-subtitle {\n      color: #94a3b8;\n      font-size: 14px;\n      margin-bottom: 24px;\n    }\n\n    .va-quiz-lead-form {\n      background: rgba(255, 255, 255, 0.05);\n      border-radius: 12px;\n      padding: 20px;\n      margin-bottom: 20px;\n    }\n\n    .va-quiz-lead-form input {\n      width: 100%;\n      background: rgba(255, 255, 255, 0.1);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 8px;\n      padding: 12px 16px;\n      color: #e2e8f0;\n      font-size: 14px;\n      margin-bottom: 12px;\n    }\n\n    .va-quiz-lead-form input:focus {\n      outline: none;\n      border-color: #8b5cf6;\n    }\n\n    .va-quiz-lead-form input::placeholder {\n      color: #64748b;\n    }\n\n    /* RTL Support */\n    [dir="rtl"] .va-quiz-option:hover {\n      transform: translateX(-4px);\n    }\n\n    [dir="rtl"] .va-quiz-progress-text {\n      text-align: left;\n    }\n\n    /* Mobile responsive */\n    @media (max-width: 480px) {\n      .va-quiz-container {\n        width: 95%;\n        max-height: 95vh;\n      }\n\n      .va-quiz-question {\n        font-size: 18px;\n      }\n\n      .va-quiz-option {\n        padding: 14px 16px;\n        font-size: 14px;\n      }\n    }\n  ',e.appendChild(n)}_initQuestions(){if(this.options.customQuestions)this.questions=this.options.customQuestions;else{const e=t[this.options.template]||t.generic;this.questions=e.questions,this.title=e.title}}_initVoiceRecognition(){if(!this.options.voiceEnabled)return;const e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.recognition=new e,this.recognition.continuous=!1,this.recognition.interimResults=!1,this.recognition.lang=this._getSpeechLang(),this.recognition.onresult=e=>{const n=e.results[0][0].transcript.toLowerCase();this._processVoiceAnswer(n)},this.recognition.onend=()=>{this.isListening=!1,this._updateVoiceButton()},this.recognition.onerror=e=>{console.error("[VoiceQuiz] Speech error:",e.error),this.isListening=!1,this._updateVoiceButton()}):console.warn("[VoiceQuiz] Speech Recognition not supported")}_getSpeechLang(){return{fr:"fr-FR",en:"en-US",es:"es-ES",ar:"ar-SA",ary:"ar-MA"}[this.options.lang]||"fr-FR"}_t(e){return"string"==typeof e?e:e[this.options.lang]||e.fr||e.en||Object.values(e)[0]}_getLabels(){const e={fr:{back:"Retour",next:"Suivant",finish:"Voir mes recommandations",voiceHint:"Ou répondez par la voix",listening:"Je vous écoute...",speak:"Parler",stepOf:"Question {current} sur {total}",resultsTitle:"Vos recommandations sont prêtes !",resultsSubtitle:"Entrez vos coordonnées pour recevoir votre sélection personnalisée",namePlaceholder:"Votre nom",emailPlaceholder:"Votre email",phonePlaceholder:"Votre téléphone (optionnel)",getResults:"Recevoir mes recommandations",skip:"Voir sans email"},en:{back:"Back",next:"Next",finish:"See my recommendations",voiceHint:"Or answer by voice",listening:"I'm listening...",speak:"Speak",stepOf:"Question {current} of {total}",resultsTitle:"Your recommendations are ready!",resultsSubtitle:"Enter your details to receive your personalized selection",namePlaceholder:"Your name",emailPlaceholder:"Your email",phonePlaceholder:"Your phone (optional)",getResults:"Get my recommendations",skip:"View without email"},es:{back:"Atrás",next:"Siguiente",finish:"Ver mis recomendaciones",voiceHint:"O responde por voz",listening:"Te escucho...",speak:"Hablar",stepOf:"Pregunta {current} de {total}",resultsTitle:"¡Tus recomendaciones están listas!",resultsSubtitle:"Ingresa tus datos para recibir tu selección personalizada",namePlaceholder:"Tu nombre",emailPlaceholder:"Tu email",phonePlaceholder:"Tu teléfono (opcional)",getResults:"Recibir mis recomendaciones",skip:"Ver sin email"},ar:{back:"رجوع",next:"التالي",finish:"عرض توصياتي",voiceHint:"أو أجب بالصوت",listening:"أستمع...",speak:"تكلم",stepOf:"السؤال {current} من {total}",resultsTitle:"توصياتك جاهزة!",resultsSubtitle:"أدخل بياناتك لتلقي اختيارك المخصص",namePlaceholder:"اسمك",emailPlaceholder:"بريدك الإلكتروني",phonePlaceholder:"هاتفك (اختياري)",getResults:"استلم توصياتي",skip:"عرض بدون بريد"},ary:{back:"رجع",next:"كمل",finish:"شوف شنو يناسبني",voiceHint:"ولا جاوب بالصوت",listening:"كنسمعك...",speak:"هضر",stepOf:"سؤال {current} من {total}",resultsTitle:"التوصيات ديالك جاهزين!",resultsSubtitle:"دخل معلوماتك باش توصلك لائحة خاصة بيك",namePlaceholder:"سميتك",emailPlaceholder:"الإيميل ديالك",phonePlaceholder:"التيليفون (اختياري)",getResults:"توصلني التوصيات",skip:"شوف بلا إيميل"}};return e[this.options.lang]||e.fr}_createQuizDOM(){const e=this._getLabels(),t="ar"===this.options.lang||"ary"===this.options.lang,i=document.createElement("div");return i.className="va-quiz-overlay",i.id="va-quiz-overlay",t&&i.setAttribute("dir","rtl"),i.innerHTML=`\n        <div class="va-quiz-container">\n          <div class="va-quiz-header">\n            <div class="va-quiz-title">\n              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n              </svg>\n              <span>${n(this._t(this.title||{fr:"Quiz Produit",en:"Product Quiz"}))}</span>\n            </div>\n            <button class="va-quiz-close" aria-label="${this._t({fr:"Fermer",en:"Close",es:"Cerrar",ar:"إغلاق",ary:"سد"})}">\n              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <line x1="18" y1="6" x2="6" y2="18"></line>\n                <line x1="6" y1="6" x2="18" y2="18"></line>\n              </svg>\n            </button>\n          </div>\n          <div class="va-quiz-progress">\n            <div class="va-quiz-progress-bar">\n              <div class="va-quiz-progress-fill" style="width: 0%"></div>\n            </div>\n            <div class="va-quiz-progress-text"></div>\n          </div>\n          <div class="va-quiz-content"></div>\n          <div class="va-quiz-footer">\n            <button class="va-quiz-btn va-quiz-btn-back" style="display: none">${e.back}</button>\n            <button class="va-quiz-btn va-quiz-btn-next" disabled>${e.next}</button>\n          </div>\n        </div>\n      `,i.querySelector(".va-quiz-close").addEventListener("click",()=>this.hide()),i.querySelector(".va-quiz-btn-back").addEventListener("click",()=>this._prevStep()),i.querySelector(".va-quiz-btn-next").addEventListener("click",()=>this._nextStep()),i.addEventListener("click",e=>{e.target===i&&this.hide()}),i}_renderQuestion(){const e=this._getLabels(),t=this.questions[this.currentStep],i=this.container.querySelector(".va-quiz-content"),s=this.container.querySelector(".va-quiz-progress-fill"),o=this.container.querySelector(".va-quiz-progress-text"),r=this.container.querySelector(".va-quiz-btn-back"),a=this.container.querySelector(".va-quiz-btn-next");s.style.width=(this.currentStep+1)/this.questions.length*100+"%",o.textContent=e.stepOf.replace("{current}",this.currentStep+1).replace("{total}",this.questions.length),r.style.display=this.currentStep>0?"block":"none",a.textContent=this.currentStep===this.questions.length-1?e.finish:e.next,a.disabled=!this.answers[t.id],i.innerHTML=`\n        <div class="va-quiz-question">${n(this._t(t.question))}</div>\n        <div class="va-quiz-options">\n          ${(t.options||[]).map(e=>{return`\n            <button class="va-quiz-option ${this.answers[t.id]===e.value?"va-quiz-selected":""}" data-value="${i=e.value,i?String(i).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}">\n              <span class="va-quiz-option-icon">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">\n                  <polyline points="20 6 9 17 4 12"></polyline>\n                </svg>\n              </span>\n              <span>${n(this._t(e.label))}</span>\n            </button>\n          `;var i}).join("")}\n        </div>\n        ${this.recognition?`\n          <div class="va-quiz-voice-section">\n            <div class="va-quiz-voice-hint">${e.voiceHint}</div>\n            <button class="va-quiz-voice-btn" id="va-quiz-voice-btn">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>\n                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>\n                <line x1="12" y1="19" x2="12" y2="23"></line>\n                <line x1="8" y1="23" x2="16" y2="23"></line>\n              </svg>\n              <span>${e.speak}</span>\n            </button>\n          </div>\n        `:""}\n      `,i.querySelectorAll(".va-quiz-option").forEach(e=>{e.addEventListener("click",()=>{this._selectOption(t.id,e.dataset.value)})});const l=i.querySelector("#va-quiz-voice-btn");l&&l.addEventListener("click",()=>this._toggleVoice())}_selectOption(e,n){this.answers[e]=n,this._renderQuestion(),this._trackAnswer(e,n)}_toggleVoice(){this.recognition&&(this.isListening?this.recognition.stop():(this.isListening=!0,this._updateVoiceButton(),this.recognition.start()))}_updateVoiceButton(){const e=this._getLabels(),n=this.container?.querySelector("#va-quiz-voice-btn");n&&(this.isListening?(n.classList.add("va-quiz-listening"),n.querySelector("span").textContent=e.listening):(n.classList.remove("va-quiz-listening"),n.querySelector("span").textContent=e.speak))}_processVoiceAnswer(e){const n=this.questions[this.currentStep];if(n.options){for(const t of n.options){const i=this._t(t.label).toLowerCase();if(e.includes(i)||i.includes(e))return this._selectOption(n.id,t.value),void setTimeout(()=>this._nextStep(),800)}if(n.voiceKeywords){const t=n.voiceKeywords[this.options.lang]||[];for(const i of t)if(e.includes(i))return this.answers[n.id]=e,this._renderQuestion(),void setTimeout(()=>this._nextStep(),800)}}}_prevStep(){this.currentStep>0&&(this.currentStep--,this._renderQuestion())}_nextStep(){this.currentStep<this.questions.length-1?(this.currentStep++,this._renderQuestion()):this._showResults()}_showResults(){const e=this._getLabels(),n=this.container.querySelector(".va-quiz-content"),t=this.container.querySelector(".va-quiz-footer");this.container.querySelector(".va-quiz-progress-fill").style.width="100%",this.container.querySelector(".va-quiz-progress-text").textContent="",n.innerHTML=`\n        <div class="va-quiz-results">\n          <div class="va-quiz-results-icon">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <polyline points="20 6 9 17 4 12"></polyline>\n            </svg>\n          </div>\n          <h3 class="va-quiz-results-title">${e.resultsTitle}</h3>\n          <p class="va-quiz-results-subtitle">${e.resultsSubtitle}</p>\n          <div class="va-quiz-lead-form">\n            <input type="text" id="va-quiz-name" placeholder="${e.namePlaceholder}" required>\n            <input type="email" id="va-quiz-email" placeholder="${e.emailPlaceholder}" required>\n            <input type="tel" id="va-quiz-phone" placeholder="${e.phonePlaceholder}">\n          </div>\n        </div>\n      `,t.innerHTML=`\n        <button class="va-quiz-btn va-quiz-btn-back">${e.skip}</button>\n        <button class="va-quiz-btn va-quiz-btn-next">${e.getResults}</button>\n      `,t.querySelector(".va-quiz-btn-back").addEventListener("click",()=>{this._completeQuiz(!1)}),t.querySelector(".va-quiz-btn-next").addEventListener("click",()=>{const e=this.container.querySelector("#va-quiz-name").value.trim(),n=this.container.querySelector("#va-quiz-email").value.trim(),t=this.container.querySelector("#va-quiz-phone").value.trim();e&&n&&(this._captureLead({name:e,email:n,phone:t}),this._completeQuiz(!0))})}async _captureLead(e){if(this.options.onLeadCapture&&this.options.onLeadCapture({...e,answers:this.answers}),this._track("quiz_lead_captured",{...e,answers_count:Object.keys(this.answers).length}),this.options.tenantId)try{await fetch(`${this.options.apiBaseUrl}/api/leads`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenant_id:this.options.tenantId,source:"voice_quiz",...e,quiz_answers:this.answers})})}catch(e){console.error("[VoiceQuiz] Lead capture error:",e)}}async _completeQuiz(e){const n=[];for(const e of this.questions){const t=this.answers[e.id];t&&e.tags?.[t]&&n.push(...e.tags[t])}this._track("quiz_completed",{with_lead:e,answers:this.answers,tags:n}),this.options.onComplete&&this.options.onComplete({answers:this.answers,tags:n,withLead:e}),window.VocalIA?.getAIRecommendations?(this.hide(),await window.VocalIA.getAIRecommendations(null,[],"personalized")):this.hide()}_track(e,n={}){if(!window.VOCALIA_CONFIG||!1!==window.VOCALIA_CONFIG.analytics_consent){try{if("denied"===localStorage.getItem("va_consent"))return}catch{}"function"==typeof gtag&&gtag("event",e,{event_category:"voice_quiz",...n})}}_trackAnswer(e,n){this._track("quiz_answer",{question_id:e,answer:n,step:this.currentStep+1})}show(){return this.isVisible||(this._track("quiz_started",{template:this.options.template}),this.host=document.createElement("div"),this.host.id="va-quiz-host",this.host.style.cssText="position:fixed;inset:0;z-index:10003;pointer-events:none;",document.body.appendChild(this.host),this._shadowRoot=this.host.attachShadow({mode:"open"}),this._injectStyles(this._shadowRoot),this.container=this._createQuizDOM(),this.container.style.pointerEvents="auto",this._shadowRoot.appendChild(this.container),this._renderQuestion(),requestAnimationFrame(()=>{this.container.classList.add("va-quiz-visible")}),this.isVisible=!0),this}hide(){return this.isVisible?(this.isListening&&this.recognition&&this.recognition.stop(),this.currentStep<this.questions.length&&this._track("quiz_abandoned",{step:this.currentStep+1,total:this.questions.length}),this.container?.classList.remove("va-quiz-visible"),setTimeout(()=>{this.host?.remove(),this.host=null,this._shadowRoot=null,this.container=null},300),this.isVisible=!1,this):this}reset(){return this.currentStep=0,this.answers={},this.isVisible&&this._renderQuestion(),this}setLanguage(e){return this.options.lang=e,this.recognition&&(this.recognition.lang=this._getSpeechLang()),this}}e.VocalIAQuiz=i,e.QUIZ_TEMPLATES=t,e.VocalIA&&(e.VocalIA.Quiz=i,e.VocalIA.QuizTemplates=t)}(typeof window<"u"?window:this);