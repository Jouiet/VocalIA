/* VocalIA Widget - Minified 2026-02-07 */
!function(){"use strict";const e={SUPPORTED_LANGS:["fr","en","es","ar","ary"],DEFAULT_LANG:"fr",VOICE_API_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3004/respond":"https://api.vocalia.ma/respond",CONFIG_API_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3004/config":"https://api.vocalia.ma/config",SOCIAL_PROOF_API_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3004/social-proof":"https://api.vocalia.ma/social-proof",ECOMMERCE_MODE:!1,CATALOG_MODE:!0,EXIT_INTENT_ENABLED:!0,SOCIAL_PROOF_ENABLED:!0,AI_MODE:!0,CATALOG_API_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3013/api/tenants":"https://api.vocalia.ma/api/tenants",MAX_CATALOG_ITEMS:4,SOCIAL_PROOF_DELAY:1e4,SOCIAL_PROOF_INTERVAL:25e3,SOCIAL_PROOF_DURATION:5e3,SOCIAL_PROOF_MAX_SHOWN:4,primaryColor:"#5E6AD2",primaryDark:"#4f46e5",accentColor:"#818cf8",darkBg:"#0f172a",API_TIMEOUT:15e3,EXIT_INTENT_DELAY:5e3,EXIT_INTENT_COOLDOWN:864e5,LANG_PATH:"/voice-assistant/lang/voice-{lang}.json",LOGO_PATH:"/public/images/logo.webp",AUTO_DETECT_LANGUAGES:{fr:"fr","fr-FR":"fr","fr-CA":"fr","fr-BE":"fr",en:"en","en-US":"en","en-GB":"en",es:"es","es-ES":"es",ar:"ar","ar-MA":"ary","ar-SA":"ar",ary:"ary"}},n={isOpen:!1,isListening:!1,currentLang:e.DEFAULT_LANG,langData:null,conversationHistory:[],tenantId:null,sessionId:`b2b_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,recognition:null,synthesis:window.speechSynthesis,conversationContext:{industry:null,need:null,stage:"discovery",lastTopic:null,attribution:{utm_source:null,utm_medium:null,utm_campaign:null,referrer:document.referrer||null},bookingFlow:{active:!1,step:null,data:{name:null,email:null,datetime:null,service:null}}},exitIntent:{shown:!1,dismissed:!1,pageLoadTime:Date.now(),lastScrollY:0,triggered:!1},socialProof:{messages:[],notificationsShown:0,intervalId:null,lastShownTime:0},bookingConfig:{url:null,phone:null,enabled:!1},availableSlotsCache:{slots:[],timestamp:0}},t="SpeechRecognition"in window||"webkitSpeechRecognition"in window,a="speechSynthesis"in window;async function i(t){const a=e.LANG_PATH.replace("{lang}",t);try{const e=await fetch(a);if(!e.ok)throw new Error(`Failed to load language: ${t}`);n.currentLang=t,n.langData=await e.json()}catch(e){if(console.error("[VocalIA B2B] Language load error:",e),"fr"!==t)return i("fr");n.langData={meta:{rtl:!1,speechSynthesis:"fr-FR",speechRecognition:"fr-FR"},ui:{headerTitle:"VocalIA Assistant",headerSubtitleVoice:"Expert IA B2B",placeholder:"Posez votre question...",ariaOpenAssistant:"Ouvrir l'assistant vocal VocalIA",notifTitle:"Besoin d'aide ?",errorMessage:"DÃ©solÃ©, une erreur s'est produite."}}}}function o(e,n={}){"function"==typeof gtag&&gtag("event",e,{...n,agent_type:"b2b_specialized"})}navigator.userAgent.toLowerCase().includes("firefox"),/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let r=null;function s(e){return r?r.getElementById(e):document.getElementById(e)}function c(){n.isOpen=!n.isOpen;const e=s("va-panel");e&&e.classList.toggle("open",n.isOpen),n.isOpen?(o("widget_opened"),setTimeout(()=>{const e=s("va-input");e&&e.focus()},100),0===n.conversationHistory.length&&l(n.langData.ui.welcomeMessage||"Bonjour ! Comment puis-je vous aider aujourd'hui ?","assistant")):o("widget_closed")}function l(e,t="assistant"){const i=s("va-messages");if(!i)return;const o=document.createElement("div");o.className=`va-message ${t}`,o.innerHTML=`<div class="va-message-content">${d(e)}</div>`,i.appendChild(o),i.scrollTop=i.scrollHeight,n.conversationHistory.push({role:t,content:e}),"assistant"===t&&a&&function(e){if(!a)return;n.synthesis.cancel();const t=new SpeechSynthesisUtterance(e);t.lang=n.langData?.meta?.speechSynthesis||"fr-FR",t.onstart=()=>{const e=s("va-visualizer");e&&e.classList.add("active")},t.onend=()=>{const e=s("va-visualizer");e&&e.classList.remove("active")},n.synthesis.speak(t)}(e)}function d(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}function p(){if(n.recognition)if(n.isListening)n.recognition.stop();else{n.recognition.start(),n.isListening=!0;const e=s("va-mic"),t=s("va-visualizer");e&&e.classList.add("listening"),t&&t.classList.add("active"),o("voice_input_started")}}async function g(t,a="text"){if(!t?.trim())return;l(t,"user");const i=s("va-input");i&&(i.value=""),o("message_sent",{input_method:a,length:t.length});const r=function(){const e=s("va-messages");if(!e)return null;const n=`typing-${Date.now()}`,t=document.createElement("div");return t.id=n,t.className="va-message assistant",t.innerHTML='<div class="va-message-content" style="display:flex;gap:4px;padding:14px 18px;">\n            <span style="width:8px;height:8px;background:var(--va-accent);border-radius:50%;animation:vaTyping 1s infinite;"></span>\n            <span style="width:8px;height:8px;background:var(--va-accent);border-radius:50%;animation:vaTyping 1s infinite 0.2s;"></span>\n            <span style="width:8px;height:8px;background:var(--va-accent);border-radius:50%;animation:vaTyping 1s infinite 0.4s;"></span>\n        </div>\n        <style>@keyframes vaTyping { 0%, 60%, 100% { transform: translateY(0); opacity: 0.5; } 30% { transform: translateY(-4px); opacity: 1; } }</style>',e.appendChild(t),e.scrollTop=e.scrollHeight,n}();try{const a=new AbortController,i=setTimeout(()=>a.abort(),e.API_TIMEOUT),c=await fetch(e.VOICE_API_URL,{method:"POST",headers:{"Content-Type":"application/json"},signal:a.signal,body:JSON.stringify({message:t,language:n.currentLang,sessionId:n.sessionId,tenant_id:n.tenantId,widget_type:"B2B",history:n.conversationHistory.slice(-6)})});clearTimeout(i),v(r);const p=await c.json();p.response?(l(p.response,"assistant"),p.a2ui&&function(t){if(!t||!t.html)return;const a=s("va-messages");if(!a)return;const i=document.createElement("div");if(i.className="va-message assistant va-a2ui-wrapper",t.css){const e=document.createElement("style");e.textContent=t.css,i.appendChild(e)}const r=document.createElement("div");r.className="va-message-content",r.innerHTML=t.html,i.appendChild(r),a.appendChild(i),a.scrollTop=a.scrollHeight,i.querySelectorAll("[data-a2ui-action]").forEach(a=>{a.addEventListener("click",()=>{!async function(t,a){if(o("a2ui_action",{action:t,type:a.type}),"select_slot"===t){const e=a.element.closest("[data-a2ui-component]");if(e){e.querySelectorAll(".va-a2ui-slot").forEach(e=>e.classList.remove("selected")),a.element.classList.add("selected");const n=e.querySelector('[data-a2ui-action="confirm_booking"]');n&&(n.disabled=!1)}return}if("close"===t)return void a.wrapper.remove();const i={},r=a.element.closest("[data-a2ui-component]");if("confirm_booking"===t&&r){const e=r.querySelector(".va-a2ui-slot.selected");i.slot=e?.dataset.slot}else if("submit_lead"===t&&r){const e=r.querySelector("form");e&&new FormData(e).forEach((e,n)=>{i[n]=e})}try{const a=await fetch(e.VOICE_API_URL.replace("/respond","/a2ui/action"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:t,data:i,sessionId:n.sessionId,tenant_id:n.tenantId,widget_type:"B2B"})}),o=await a.json();o.message&&l(o.message,"assistant")}catch(e){console.warn("[VocalIA B2B] A2UI action failed:",e.message)}}(a.dataset.a2uiAction,{type:t.type,value:a.dataset.slot||a.dataset.productId||null,element:a,wrapper:i})})}),o("a2ui_rendered",{type:t.type})}(p.a2ui),p.catalog&&p.catalog.items&&p.catalog.items.length>0&&function(n,t){if(!e.CATALOG_MODE||!n||0===n.length)return;const a=s("va-messages");if(!a)return;const i=document.createElement("div");i.className="va-message assistant";const r=t?d(t):"";let c='<div class="va-message-content" style="max-width:100%;padding:10px 12px;">';r&&(c+=`<div class="va-catalog-header"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path d="M7 12h2v5H7zm4-3h2v8h-2zm4-3h2v11h-2z"/></svg>${r}</div>`),c+='<div class="va-service-cards">';const l=Math.min(n.length,e.MAX_CATALOG_ITEMS);for(let e=0;e<l;e++){const t=n[e],a=d(t.name||t.title||""),i=d(t.description||t.subtitle||""),o=d(t.price||t.pricing||""),r=t.image||t.images?.[0]||t.thumbnail||"";c+=`<div class="va-service-card" data-item-id="${d(t.id||"")}" data-index="${e}">`,c+=r?`<img class="va-service-card-img" src="${d(r)}" alt="${a}" loading="lazy" onerror="this.outerHTML='<div class=\\'va-service-card-img-placeholder\\'>ðŸ“‹</div>'"/>`:`<div class="va-service-card-img-placeholder">${t.icon||"ðŸ“‹"}</div>`,c+='<div class="va-service-card-body">',c+=`<div class="va-service-card-title">${a}</div>`,i&&(c+=`<div class="va-service-card-desc">${i}</div>`),o&&(c+=`<div class="va-service-card-price">${o}</div>`),c+=`<button class="va-service-card-cta">${d(t.cta||"En savoir plus")}</button>`,c+="</div></div>"}c+="</div></div>",i.innerHTML=c,a.appendChild(i),a.scrollTop=a.scrollHeight,i.querySelectorAll(".va-service-card").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.itemId,a=parseInt(e.dataset.index),i=n[a];i&&(o("service_card_click",{item_id:t,item_name:i.name||i.title}),g(i.name||i.title,"text"))})}),o("service_cards_displayed",{count:l,title:t||"catalog"})}(p.catalog.items,p.catalog.title),n.bookingConfig.enabled&&function(e){const t=e.toLowerCase(),a={fr:["rendez-vous","rdv","rÃ©server","booking","prendre rdv","disponibilitÃ©","crÃ©neau","rÃ©servation"],en:["appointment","book","booking","schedule","reserve","availability","slot"],es:["cita","reservar","reserva","programar","disponibilidad","horario"],ar:["Ù…ÙˆØ¹Ø¯","Ø­Ø¬Ø²","Ø§Ø­Ø¬Ø²","Ù…ØªØ§Ø­","ÙˆÙ‚Øª"],ary:["Ù…ÙˆØ¹Ø¯","Ø­Ø¬Ø²","Ù†Ø­Ø¬Ø²","ÙˆÙ‚Øª","ÙƒØ±ÙŠÙ†ÙŠ","Ø±Ø¯ÙÙˆ"]};return(a[n.currentLang]||a.fr).some(e=>t.includes(e))}(t)&&function(){if(!n.bookingConfig.enabled)return;const e=s("va-messages");if(!e)return;const t=document.createElement("div");t.className="va-message assistant";const a=document.createElement("div");a.className="va-message-content",a.style.cssText="padding:12px 16px;";const i={fr:{online:"RÃ©server en ligne",call:"Appeler pour rÃ©server"},en:{online:"Book online",call:"Call to book"},es:{online:"Reservar en lÃ­nea",call:"Llamar para reservar"},ar:{online:"Ø§Ø­Ø¬Ø² Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª",call:"Ø§ØªØµÙ„ Ù„Ù„Ø­Ø¬Ø²"},ary:{online:"Ø§Ø­Ø¬Ø² Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†",call:"Ø¹ÙŠØ· Ø¨Ø§Ø´ ØªØ­Ø¬Ø²"}},r=i[n.currentLang]||i.fr,c="display:inline-block;padding:8px 16px;border-radius:8px;text-decoration:none;font-size:13px;font-weight:600;margin:4px 4px 4px 0;transition:opacity 0.2s;";if(n.bookingConfig.url){const e=document.createElement("a");e.href=n.bookingConfig.url,e.target="_blank",e.rel="noopener noreferrer",e.style.cssText=c+"background:#5E6AD2;color:white;",e.textContent=r.online,a.appendChild(e)}if(n.bookingConfig.phone){const e=document.createElement("a");e.href=`tel:${n.bookingConfig.phone}`,e.style.cssText=c+"background:rgba(94,106,210,0.15);color:#818cf8;border:1px solid rgba(94,106,210,0.3);",e.textContent=r.call,a.appendChild(e)}t.appendChild(a),e.appendChild(t),e.scrollTop=e.scrollHeight,o("booking_cta_shown")}()):l(n.langData?.ui?.errorMessage||"DÃ©solÃ©, une erreur s'est produite.","assistant")}catch(e){v(r),"AbortError"===e.name?l("La requÃªte a pris trop de temps. Veuillez rÃ©essayer.","assistant"):l("DÃ©solÃ©, je rencontre un problÃ¨me de connexion.","assistant"),console.error("[VocalIA] API error:",e)}}function v(e){if(!e)return;const n=s(e);n&&n.remove()}function u(){n.exitIntent.triggered=!0,localStorage.setItem("vocalia_exit_intent",Date.now().toString()),n.isOpen||(c(),setTimeout(()=>{l(n.langData.ui.exitIntentMessage||"Attendez ! Avez-vous des questions avant de partir ?","assistant")},500)),o("exit_intent_triggered")}function m(){if(n.isOpen)return;if(0===n.socialProof.messages.length)return;const t="ar"===n.currentLang||"ary"===n.currentLang,a=n.socialProof.messages[n.socialProof.notificationsShown%n.socialProof.messages.length],i=document.createElement("div");i.className="va-b2b-social-proof";const c=`va-b2b-sp-${Date.now()}`;i.id=c;const l=document.createElement("style");l.textContent=`\n            .va-b2b-social-proof {\n                position: fixed; bottom: 100px; ${t?"left":"right"}: 25px;\n                max-width: 280px; background: linear-gradient(145deg, #1e2642, #191e35);\n                border: 1px solid rgba(94, 106, 210, 0.25); border-radius: 12px;\n                padding: 12px 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);\n                z-index: 99997; font-family: Inter, -apple-system, sans-serif;\n                animation: vaB2bSlideIn 0.4s ease, vaB2bFadeOut 0.3s ease ${e.SOCIAL_PROOF_DURATION-300}ms forwards;\n                ${t?"direction: rtl;":""}\n            }\n            @keyframes vaB2bSlideIn {\n                from { opacity: 0; transform: translateX(${t?"-":""}30px); }\n                to { opacity: 1; transform: translateX(0); }\n            }\n            @keyframes vaB2bFadeOut { from { opacity: 1; } to { opacity: 0; } }\n        `,i.appendChild(l);const d=document.createElement("div");d.style.cssText="display:flex;align-items:center;gap:10px;";const p=document.createElement("div");p.style.cssText="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#5E6AD2,#818cf8);display:flex;align-items:center;justify-content:center;flex-shrink:0;";const g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("width","18"),g.setAttribute("height","18"),g.setAttribute("fill","white");const v=a.icon&&/^<(?:path|circle|rect|line|polyline|polygon|ellipse|g)\s/.test(a.icon.trim())?a.icon:'<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>';g.innerHTML=v,p.appendChild(g);const u=document.createElement("div"),m=document.createElement("div");m.style.cssText="font-size:13px;color:rgba(255,255,255,0.9);line-height:1.4;",m.textContent=a.text;const h=document.createElement("div");h.style.cssText="font-size:11px;color:rgba(94,106,210,0.7);margin-top:4px;",h.textContent=a.time||"",u.appendChild(m),u.appendChild(h),d.appendChild(p),d.appendChild(u);const f=document.createElement("button");f.style.cssText="position:absolute;top:6px;"+(t?"left":"right")+":6px;background:none;border:none;cursor:pointer;color:rgba(255,255,255,0.4);padding:2px;",f.setAttribute("aria-label","Close"),f.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>',f.addEventListener("click",()=>i.remove()),i.appendChild(f),i.appendChild(d),(r||document.body).appendChild(i),setTimeout(()=>{const e=s(c);e&&e.remove()},e.SOCIAL_PROOF_DURATION),n.socialProof.notificationsShown++,n.socialProof.lastShownTime=Date.now(),o("social_proof_shown",{index:n.socialProof.notificationsShown})}async function h(){try{window.VOCALIA_CONFIG_INJECTED&&Object.assign(e,window.VOCALIA_CONFIG_INJECTED),window.VOCALIA_CONFIG&&Object.assign(e,window.VOCALIA_CONFIG);const a=function(){const n=new URLSearchParams(window.location.search).get("lang");if(n&&e.SUPPORTED_LANGS.includes(n))return n;const t=document.documentElement.lang?.toLowerCase()?.split("-")[0];if(t&&e.SUPPORTED_LANGS.includes(t))return t;const a=navigator.language||navigator.userLanguage,i=e.AUTO_DETECT_LANGUAGES[a]||e.AUTO_DETECT_LANGUAGES[a?.split("-")[0]];return i&&e.SUPPORTED_LANGS.includes(i)?i:e.DEFAULT_LANG}();await i(a);const l=document.querySelector("script[data-vocalia-tenant]");if(l?n.tenantId=l.dataset.vocaliaTenant:e.tenantId&&(n.tenantId=e.tenantId),function(){const e=new URLSearchParams(window.location.search),t=n.conversationContext.attribution;t.utm_source=e.get("utm_source")||t.utm_source,t.utm_medium=e.get("utm_medium")||t.utm_medium,t.utm_campaign=e.get("utm_campaign")||t.utm_campaign}(),function(){if(document.getElementById("vocalia-widget"))return;const a=n.langData,i=a.meta.rtl,l=i?"left":"right",d=document.createElement("div");d.id="vocalia-widget",d.style.cssText=`position:fixed;bottom:30px;${l}:25px;z-index:99999;${i?"direction:rtl;":""}`,document.body.appendChild(d),r=d.attachShadow({mode:"open"}),r.innerHTML=function(n,a,i){return`\n      <style>\n        #vocalia-widget {\n          --va-primary: ${e.primaryColor};\n          --va-primary-dark: ${e.primaryDark};\n          --va-accent: ${e.accentColor};\n          --va-dark: ${e.darkBg};\n        }\n        .va-trigger {\n          width: 60px; height: 60px; border-radius: 50%;\n          background: linear-gradient(135deg, var(--va-primary) 0%, var(--va-primary-dark) 100%);\n          border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;\n          box-shadow: 0 4px 20px rgba(94, 106, 210, 0.4);\n          transition: all 0.3s ease; position: relative;\n          animation: vaTriggerPulse 2.5s ease-in-out infinite;\n        }\n        .va-trigger:hover { transform: scale(1.1); box-shadow: 0 6px 30px rgba(94, 106, 210, 0.6); animation: none; }\n        @keyframes vaTriggerPulse {\n          0%, 100% { box-shadow: 0 4px 20px rgba(94, 106, 210, 0.4); transform: scale(1); }\n          50% { box-shadow: 0 4px 30px rgba(94, 106, 210, 0.7); transform: scale(1.02); }\n        }\n        .va-trigger img { width: 36px; height: 36px; object-fit: contain; border-radius: 50%; }\n\n        .va-panel {\n          display: none; position: absolute; bottom: 70px; ${i}: 0;\n          width: 380px; max-height: 520px; background: var(--va-dark);\n          border: 1px solid rgba(94, 106, 210, 0.3); border-radius: 16px;\n          overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5);\n          flex-direction: column;\n        }\n        .va-panel.open { display: flex; animation: vaSlideUp 0.3s ease; }\n        @keyframes vaSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }\n\n        .va-header {\n          padding: 16px 20px; background: linear-gradient(135deg, var(--va-primary), var(--va-primary-dark));\n          display: flex; align-items: center; gap: 12px;\n        }\n        .va-header-logo { width: 40px; height: 40px; border-radius: 50%; background: white; padding: 4px; }\n        .va-header-logo img { width: 100%; height: 100%; object-fit: contain; }\n        .va-header-text h3 { margin: 0; font-size: 16px; color: white; font-weight: 600; }\n        .va-header-text p { margin: 2px 0 0; font-size: 12px; color: rgba(255,255,255,0.8); }\n        .va-close { margin-${a?"right":"left"}: auto; background: rgba(255,255,255,0.1); border: none; color: white; cursor: pointer; width: 28px; height: 28px; border-radius: 50%; font-size: 16px; transition: background 0.2s; }\n        .va-close:hover { background: rgba(255,255,255,0.2); }\n\n        .va-messages { flex: 1; overflow-y: auto; padding: 16px; min-height: 220px; max-height: 350px; }\n        .va-message { margin-bottom: 12px; display: flex; gap: 8px; }\n        .va-message-content { max-width: 85%; padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; }\n        .va-message.assistant .va-message-content { background: rgba(94, 106, 210, 0.15); color: #e5e5e5; border-bottom-left-radius: 4px; }\n        .va-message.user { justify-content: flex-end; }\n        .va-message.user .va-message-content { background: var(--va-primary); color: white; border-bottom-right-radius: 4px; }\n\n        .va-input-area { padding: 12px 16px; border-top: 1px solid rgba(94, 106, 210, 0.2); display: flex; gap: 8px; background: rgba(0,0,0,0.2); }\n        .va-input { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(94, 106, 210, 0.3); border-radius: 24px; padding: 12px 18px; color: white; outline: none; font-size: 14px; }\n        .va-input:focus { border-color: var(--va-primary); box-shadow: 0 0 0 2px rgba(94, 106, 210, 0.2); }\n        .va-input::placeholder { color: rgba(255,255,255,0.5); }\n\n        .va-btn { width: 44px; height: 44px; border-radius: 50%; background: var(--va-primary); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }\n        .va-btn:hover { background: var(--va-primary-dark); transform: scale(1.05); }\n        .va-btn.listening { background: #DC2626; animation: vaPulse 1.5s infinite; }\n        .va-btn-send { background: transparent; border: 1px solid rgba(94, 106, 210, 0.5); }\n        .va-btn-send:hover { background: rgba(94, 106, 210, 0.2); border-color: var(--va-primary); }\n\n        @keyframes vaPulse { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } }\n\n        .va-visualizer { height: 40px; display: none; padding: 0 16px; align-items: center; justify-content: center; background: rgba(94, 106, 210, 0.1); }\n        .va-visualizer.active { display: flex; }\n        .va-visualizer-bar { width: 4px; background: var(--va-accent); margin: 0 3px; border-radius: 2px; animation: vaSound 0.5s infinite alternate; }\n        .va-visualizer-bar:nth-child(1) { animation-delay: 0s; }\n        .va-visualizer-bar:nth-child(2) { animation-delay: 0.1s; }\n        .va-visualizer-bar:nth-child(3) { animation-delay: 0.2s; }\n        .va-visualizer-bar:nth-child(4) { animation-delay: 0.3s; }\n        .va-visualizer-bar:nth-child(5) { animation-delay: 0.15s; }\n        .va-visualizer-bar:nth-child(6) { animation-delay: 0.25s; }\n        .va-visualizer-bar:nth-child(7) { animation-delay: 0.05s; }\n        .va-visualizer-bar:nth-child(8) { animation-delay: 0.35s; }\n        @keyframes vaSound { 0% { height: 4px; opacity: 0.5; } 100% { height: 24px; opacity: 1; } }\n\n        .va-notif-bubble { position: absolute; bottom: 70px; ${i}: 0; white-space: nowrap; z-index: 9999; animation: vaFadeIn 0.5s ease; }\n        .va-notif-bubble-content { padding: 12px 16px; background: white; color: #0F172A; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); font-size: 14px; font-weight: 500; border-left: 4px solid var(--va-primary); }\n        @keyframes vaFadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }\n\n        /* Service/Product Cards for Catalog Mode */\n        .va-service-cards { display: flex; overflow-x: auto; gap: 10px; padding: 8px 0; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }\n        .va-service-cards::-webkit-scrollbar { height: 3px; }\n        .va-service-cards::-webkit-scrollbar-thumb { background: var(--va-primary); border-radius: 3px; }\n        .va-service-card { min-width: 200px; max-width: 220px; background: rgba(94, 106, 210, 0.08); border: 1px solid rgba(94, 106, 210, 0.2); border-radius: 12px; overflow: hidden; cursor: pointer; transition: all 0.2s; scroll-snap-align: start; flex-shrink: 0; }\n        .va-service-card:hover { border-color: var(--va-primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(94, 106, 210, 0.2); }\n        .va-service-card-img { width: 100%; height: 110px; object-fit: cover; background: rgba(94, 106, 210, 0.05); }\n        .va-service-card-img-placeholder { width: 100%; height: 110px; display: flex; align-items: center; justify-content: center; font-size: 28px; background: rgba(94, 106, 210, 0.05); }\n        .va-service-card-body { padding: 10px 12px; }\n        .va-service-card-title { font-size: 13px; font-weight: 600; color: #e5e5e5; margin: 0 0 4px; line-height: 1.3; }\n        .va-service-card-desc { font-size: 11px; color: rgba(255,255,255,0.6); margin: 0 0 8px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }\n        .va-service-card-price { font-size: 13px; font-weight: 700; color: var(--va-accent); }\n        .va-service-card-cta { display: block; width: 100%; margin-top: 8px; padding: 6px; background: var(--va-primary); color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; text-align: center; transition: background 0.2s; }\n        .va-service-card-cta:hover { background: var(--va-primary-dark); }\n        .va-catalog-header { display: flex; align-items: center; gap: 6px; margin-bottom: 6px; color: #e5e5e5; font-size: 13px; font-weight: 600; }\n        .va-catalog-header svg { width: 14px; height: 14px; fill: var(--va-primary); }\n\n        @media (max-width: 480px) {\n          .va-panel { width: calc(100vw - 40px); ${i}: -5px; }\n        }\n      </style>\n\n      <button class="va-trigger" id="va-trigger" aria-label="${n.ui.ariaOpenAssistant}">\n        <img src="${e.LOGO_PATH}" alt="VocalIA" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22white%22><path d=%22M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z%22/><path d=%22M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z%22/></svg>'"/>\n      </button>\n\n      <div class="va-panel" id="va-panel" role="dialog" aria-label="${n.ui.headerTitle||"VocalIA Assistant"}" aria-modal="true">\n        <div class="va-header">\n          <div class="va-header-logo">\n            <img src="${e.LOGO_PATH}" alt="VocalIA" onerror="this.style.display='none'"/>\n          </div>\n          <div class="va-header-text">\n            <h3>${n.ui.headerTitle||"VocalIA Assistant"}</h3>\n            <p>${n.ui.headerSubtitleVoice||"Expert IA"}</p>\n          </div>\n          <button class="va-close" id="va-close" aria-label="${n.ui.ariaClose||"Fermer"}">âœ•</button>\n        </div>\n\n        <div class="va-visualizer" id="va-visualizer" aria-hidden="true">\n          ${Array.from({length:8},()=>'<div class="va-visualizer-bar"></div>').join("")}\n        </div>\n\n        <div class="va-messages" id="va-messages" aria-live="polite" aria-relevant="additions"></div>\n\n        <div class="va-input-area">\n          <input type="text" class="va-input" id="va-input" placeholder="${n.ui.placeholder||"Posez votre question..."}" autocomplete="off">\n          ${t?'\n          <button class="va-btn" id="va-mic" aria-label="Activer le microphone">\n            <svg viewBox="0 0 24 24" width="20" height="20" fill="white"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>\n          </button>':""}\n          <button class="va-btn va-btn-send" id="va-send" aria-label="Envoyer">\n            <svg viewBox="0 0 24 24" width="18" height="18" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>\n          </button>\n        </div>\n      </div>\n    `}(a,i,l),function(){const e=s("va-trigger"),a=s("va-close"),i=s("va-send"),r=s("va-input"),l=s("va-mic");e&&e.addEventListener("click",c),a&&a.addEventListener("click",c),i&&i.addEventListener("click",()=>{const e=r?.value?.trim();e&&g(e,"text")}),r&&r.addEventListener("keypress",e=>{if("Enter"===e.key){const n=e.target.value?.trim();n&&g(n,"text")}}),t&&l&&(function(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;e&&(n.recognition=new e,n.recognition.lang=n.langData?.meta?.speechRecognition||"fr-FR",n.recognition.continuous=!1,n.recognition.interimResults=!1,n.recognition.onresult=e=>{const n=e.results[0][0].transcript,t=s("va-input");t&&(t.value=n),g(n,"voice")},n.recognition.onend=()=>{n.isListening=!1;const e=s("va-mic"),t=s("va-visualizer");e&&e.classList.remove("listening"),t&&t.classList.remove("active")},n.recognition.onerror=e=>{console.warn("[VocalIA] Speech recognition error:",e.error),n.isListening=!1;const t=s("va-mic");t&&t.classList.remove("listening")})}(),l.addEventListener("click",p)),document.addEventListener("keydown",e=>{if(n.isOpen){if("Escape"===e.key){c();const e=s("va-trigger");return void(e&&e.focus())}if("Tab"===e.key){const n=s("va-panel");if(!n)return;const t=n.querySelectorAll('button, input, [tabindex]:not([tabindex="-1"])');if(0===t.length)return;const a=t[0],i=t[t.length-1];e.shiftKey&&document.activeElement===a?(e.preventDefault(),i.focus()):e.shiftKey||document.activeElement!==i||(e.preventDefault(),a.focus())}}}),o("widget_initialized",{language:n.currentLang})}(),setTimeout(()=>{n.isOpen||function(){const e=n.langData,t=s("va-trigger");if(!t)return;const a=document.createElement("div");a.className="va-notif-bubble";const i=document.createElement("div");i.className="va-notif-bubble-content",i.textContent="ðŸ‘‹ "+(e.ui.notifTitle||"Besoin d'aide ?"),a.appendChild(i),t.parentNode.appendChild(a),setTimeout(()=>a.remove(),6e3)}()},3e3)}(),function(){if(!e.EXIT_INTENT_ENABLED)return;const t=localStorage.getItem("vocalia_exit_intent");if(t&&Date.now()-parseInt(t)<e.EXIT_INTENT_COOLDOWN)return;document.addEventListener("mouseout",t=>{t.clientY<=10&&!n.exitIntent.triggered&&!n.isOpen&&Date.now()-n.exitIntent.pageLoadTime>e.EXIT_INTENT_DELAY&&u()});let a=window.scrollY;window.addEventListener("scroll",()=>{const t=window.scrollY,i=t<a,o=(a-t)/window.innerHeight;i&&o>.3&&!n.exitIntent.triggered&&!n.isOpen&&Date.now()-n.exitIntent.pageLoadTime>e.EXIT_INTENT_DELAY&&u(),a=t},{passive:!0})}(),n.tenantId)try{const t=await fetch(`${e.CONFIG_API_URL}?tenantId=${encodeURIComponent(n.tenantId)}`,{signal:AbortSignal.timeout(5e3)}),a=await t.json();a.success&&(a.features&&(e.SOCIAL_PROOF_ENABLED=!1!==a.features.social_proof_enabled,e.EXIT_INTENT_ENABLED=!1!==a.features.exit_intent_enabled),a.booking&&(n.bookingConfig.url=a.booking.url||null,n.bookingConfig.phone=a.booking.phone||null,n.bookingConfig.enabled=a.features?.booking_enabled&&!(!a.booking.url&&!a.booking.phone)))}catch(e){console.warn("[VocalIA B2B] Config fetch failed, using defaults:",e.message)}!async function(){if(e.SOCIAL_PROOF_ENABLED){try{const t=`${e.SOCIAL_PROOF_API_URL}?lang=${n.currentLang}`,a=await fetch(t,{signal:AbortSignal.timeout(5e3)}),i=await a.json();if(!(i.success&&Array.isArray(i.messages)&&i.messages.length>0))return;n.socialProof.messages=i.messages}catch(e){return void console.warn("[VocalIA B2B] Social proof fetch failed, skipping:",e.message)}setTimeout(()=>{m(),n.socialProof.intervalId=setInterval(()=>{n.socialProof.notificationsShown<e.SOCIAL_PROOF_MAX_SHOWN?m():clearInterval(n.socialProof.intervalId)},e.SOCIAL_PROOF_INTERVAL)},e.SOCIAL_PROOF_DELAY),console.log("[VocalIA B2B] Social proof initialized with",n.socialProof.messages.length,"messages")}}(),console.log(`[VocalIA B2B] Widget v2.2.0 initialized | Lang: ${n.currentLang} | Booking: ${n.bookingConfig.enabled}`)}catch(e){console.error("[VocalIA B2B] Init error:",e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()}();