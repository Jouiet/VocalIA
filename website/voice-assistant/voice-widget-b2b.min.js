/* VocalIA Widget v2.7.0 - 2026-02-26 */
!function(){"use strict";const e={SUPPORTED_LANGS:["fr","en","es","ar","ary"],DEFAULT_LANG:"fr",VOICE_API_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3004/respond":"https://api.vocalia.ma/respond",CONFIG_API_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3004/config":"https://api.vocalia.ma/config",SOCIAL_PROOF_API_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3004/social-proof":"https://api.vocalia.ma/social-proof",ECOMMERCE_MODE:!1,CATALOG_MODE:!0,EXIT_INTENT_ENABLED:!0,SOCIAL_PROOF_ENABLED:!0,AI_MODE:!0,CATALOG_API_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3013/api/tenants":"https://api.vocalia.ma/api/tenants",MAX_CATALOG_ITEMS:4,SOCIAL_PROOF_DELAY:1e4,SOCIAL_PROOF_INTERVAL:25e3,SOCIAL_PROOF_DURATION:5e3,SOCIAL_PROOF_MAX_SHOWN:4,primaryColor:"#5E6AD2",primaryDark:"#4f46e5",accentColor:"#818cf8",darkBg:"#0f172a",API_TIMEOUT:15e3,EXIT_INTENT_DELAY:5e3,EXIT_INTENT_COOLDOWN:864e5,LANG_PATH:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"/voice-assistant/lang/voice-{lang}.json":"https://vocalia.ma/voice-assistant/lang/voice-{lang}.json",LOGO_PATH:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"/public/images/logo.webp":"https://vocalia.ma/public/images/logo.webp",AUTO_DETECT_LANGUAGES:{fr:"fr","fr-FR":"fr","fr-CA":"fr","fr-BE":"fr",en:"en","en-US":"en","en-GB":"en",es:"es","es-ES":"es",ar:"ar","ar-MA":"ary","ar-SA":"ar",ary:"ary"}},t="va_b2b_conversation",a=function(){try{const e=sessionStorage.getItem(t);if(!e)return null;const a=JSON.parse(e);return Date.now()-a.ts>18e5?(sessionStorage.removeItem(t),null):a}catch{return null}}(),n={isOpen:!1,isListening:!1,currentLang:a?.lang||e.DEFAULT_LANG,langData:null,conversationHistory:a?.history||[],tenantId:null,sessionId:a?.sessionId||`b2b_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,recognition:null,synthesis:window.speechSynthesis,conversationContext:{industry:null,need:null,stage:"discovery",lastTopic:null,attribution:{utm_source:null,utm_medium:null,utm_campaign:null,referrer:document.referrer||null},bookingFlow:{active:!1,step:null,data:{name:null,email:null,datetime:null,service:null}}},exitIntent:{shown:!1,dismissed:!1,pageLoadTime:Date.now(),lastScrollY:0,triggered:!1},socialProof:{messages:[],notificationsShown:0,intervalId:null,lastShownTime:0},bookingConfig:{url:null,phone:null,enabled:!1},availableSlotsCache:{slots:[],timestamp:0},planFeatures:null,leadData:null,bookingCtaShown:!1},o="SpeechRecognition"in window||"webkitSpeechRecognition"in window,i="speechSynthesis"in window;async function s(t){const a=e.LANG_PATH.replace("{lang}",t);try{const e=await fetch(a);if(!e.ok)throw new Error(`Failed to load language: ${t}`);n.currentLang=t,n.langData=await e.json()}catch(e){if(console.error("[VocalIA B2B] Language load error:",e),"fr"!==t)return s("fr");n.langData={meta:{rtl:!1,speechSynthesis:"fr-FR",speechRecognition:"fr-FR"},ui:{headerTitle:"VocalIA Assistant",headerSubtitleVoice:"Expert IA B2B",placeholder:"Posez votre question...",ariaOpenAssistant:"Ouvrir l'assistant vocal VocalIA",notifTitle:"Besoin d'aide ?",errorMessage:"D√©sol√©, une erreur s'est produite."}}}}function r(){const e=window.location.pathname,t=document.title||"",a=document.querySelector('meta[property="og:title"]')?.content||"",n=document.querySelector('meta[name="description"]')?.content||"",o=document.querySelector("h1")?.textContent?.trim()||"";let i="general";return/\/(pricing|tarifs|prix)/i.test(e)?i="pricing":/\/(booking|rendez-vous|demo|reservation)/i.test(e)?i="booking":/\/(contact|nous-contacter)/i.test(e)?i="contact":/\/(features|fonctionnalites|produits)/i.test(e)?i="features":/\/(use-cases|cas-usage)/i.test(e)?i="use_cases":/\/(about|a-propos)/i.test(e)?i="about":/\/(blog|article)/i.test(e)?i="blog":("/"===e||"/index.html"===e)&&(i="homepage"),{path:e,pageType:i,title:a||o||t,description:n.slice(0,200)}}function c(e,t={}){"function"==typeof gtag&&gtag("event",e,{...t,agent_type:"b2b_specialized"})}navigator.userAgent.toLowerCase().includes("firefox"),/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let l=null;function d(e){return l?l.getElementById(e):document.getElementById(e)}function g(){n.isOpen=!n.isOpen;const e=d("va-panel");if(e&&e.classList.toggle("open",n.isOpen),n.isOpen){c("widget_opened"),setTimeout(()=>{const e=d("va-input");e&&e.focus()},100);const e=d("va-messages");if(n.conversationHistory.length>0&&e&&0===e.children.length){for(const t of n.conversationHistory){const a=document.createElement("div");a.className=`va-message ${t.role}`;const n="assistant"===t.role?m(v(t.content)):v(t.content);a.innerHTML=`<div class="va-message-content">${n}</div>`,e.appendChild(a)}const t=e.querySelector(".va-message.assistant:last-of-type");t&&u(t),e.scrollTop=e.scrollHeight}else if(0===n.conversationHistory.length){const e=n.langData,t=r();p(e.proactiveGreeting?.[t.pageType]||e.ui.welcomeMessage||"Bonjour ! Comment puis-je vous aider aujourd'hui ?","assistant")}}else c("widget_closed")}function p(e,a="assistant",{typewriter:o=!1}={}){const s=d("va-messages");if(!s)return;const r=document.createElement("div");if(r.className=`va-message ${a}`,"assistant"===a&&o){const t=document.createElement("div");t.className="va-message-content",r.appendChild(t),s.appendChild(r),s.scrollTop=s.scrollHeight;const a=e.split(/(\s+)/);let n="",o=0;const c=setInterval(()=>{if(o>=a.length)return clearInterval(c),t.innerHTML=m(v(e)),s.scrollTop=s.scrollHeight,i&&h(e),void u(r);n+=a[o],t.innerHTML=m(v(n)),s.scrollTop=s.scrollHeight,o++},30)}else{const t="assistant"===a?m(v(e)):v(e);r.innerHTML=`<div class="va-message-content">${t}</div>`,s.appendChild(r),s.scrollTop=s.scrollHeight,"assistant"===a&&i&&h(e),"assistant"===a&&u(r)}n.conversationHistory.push({role:a,content:e}),function(){try{sessionStorage.setItem(t,JSON.stringify({sessionId:n.sessionId,history:n.conversationHistory.slice(-50),lang:n.currentLang,ts:Date.now()}))}catch{}}()}function m(e){return e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/`(.+?)`/g,'<code style="background:rgba(94,106,210,0.2);padding:1px 4px;border-radius:3px;font-size:0.9em;">$1</code>').replace(/\n- /g,"\n‚Ä¢ ").replace(/\n/g,"<br>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,(e,t,a)=>/^(\/|https:\/\/)/.test(a)?`<a href="${a}" target="_blank" rel="noopener noreferrer" style="color:#818cf8;text-decoration:underline;">${t}</a>`:t)}function u(t){if(n.conversationHistory.length<=1)return;const a=document.createElement("div");a.className="va-feedback-bar",a.innerHTML='<button class="va-feedback-btn" data-rating="up" aria-label="Utile">üëç</button><button class="va-feedback-btn" data-rating="down" aria-label="Pas utile">üëé</button>',t.appendChild(a);const o=n.conversationHistory.length-1;a.querySelectorAll(".va-feedback-btn").forEach(t=>{t.addEventListener("click",()=>{(async function(t,a){try{await fetch(e.VOICE_API_URL.replace("/respond","/feedback"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:n.sessionId,messageIndex:t,rating:a,tenantId:n.tenantId})}),c("feedback_submitted",{rating:a,messageIndex:t})}catch(e){console.warn("[VocalIA B2B] Feedback submit failed:",e.message)}})(o,t.dataset.rating),a.innerHTML='<span style="font-size:11px;color:rgba(255,255,255,0.4);">Merci !</span>'})})}function v(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function b(t,a){if(!e.CATALOG_MODE||!t||0===t.length)return;const n=d("va-messages");if(!n)return;const o=document.createElement("div");o.className="va-message assistant";const i=a?v(a):"";let s='<div class="va-message-content" style="max-width:100%;padding:10px 12px;">';i&&(s+=`<div class="va-catalog-header"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path d="M7 12h2v5H7zm4-3h2v8h-2zm4-3h2v11h-2z"/></svg>${i}</div>`),s+='<div class="va-service-cards">';const r=Math.min(t.length,e.MAX_CATALOG_ITEMS);for(let e=0;e<r;e++){const a=t[e],n=v(a.name||a.title||""),o=v(a.description||a.subtitle||""),i=v(a.price||a.pricing||""),r=a.image||a.images?.[0]||a.thumbnail||"";s+=`<div class="va-service-card" data-item-id="${v(a.id||"")}" data-index="${e}">`,s+=r?`<img class="va-service-card-img" src="${v(r)}" alt="${n}" loading="lazy" onerror="this.outerHTML='<div class=\\'va-service-card-img-placeholder\\'>üìã</div>'"/>`:`<div class="va-service-card-img-placeholder">${v(a.icon||"üìã")}</div>`,s+='<div class="va-service-card-body">',s+=`<div class="va-service-card-title">${n}</div>`,o&&(s+=`<div class="va-service-card-desc">${o}</div>`),i&&(s+=`<div class="va-service-card-price">${i}</div>`),s+=`<button class="va-service-card-cta">${v(a.cta||"En savoir plus")}</button>`,s+="</div></div>"}s+="</div></div>",o.innerHTML=s,n.appendChild(o),n.scrollTop=n.scrollHeight,o.querySelectorAll(".va-service-card").forEach(e=>{e.addEventListener("click",()=>{const a=e.dataset.itemId,n=parseInt(e.dataset.index),o=t[n];o&&(c("service_card_click",{item_id:a,item_name:o.name||o.title}),x(o.name||o.title,"text"))})}),c("service_cards_displayed",{count:r,title:a||"catalog"})}function h(e){if(!i)return;n.synthesis.cancel();const t=new SpeechSynthesisUtterance(e);t.lang=n.langData?.meta?.speechSynthesis||"fr-FR",t.onstart=()=>{const e=d("va-visualizer");e&&e.classList.add("active")},t.onend=()=>{const e=d("va-visualizer");e&&e.classList.remove("active")},n.synthesis.speak(t)}function f(){if("native"===n.sttMode&&n.recognition)if(n.isListening)n.recognition.stop();else{n.recognition.start(),n.isListening=!0;const e=d("va-mic"),t=d("va-visualizer");e&&e.classList.add("listening"),t&&t.classList.add("active"),c("voice_input_started",{mode:"native"})}else if("fallback"===n.sttMode)if(n.isListening){n.recordingTimeout&&clearTimeout(n.recordingTimeout),"recording"===n.mediaRecorder?.state&&n.mediaRecorder.stop(),n.isListening=!1;const e=d("va-mic"),t=d("va-visualizer");e&&e.classList.remove("listening"),t&&t.classList.remove("active")}else{!async function(){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});n.mediaRecorder=new MediaRecorder(t,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/ogg"}),n.audioChunks=[],n.mediaRecorder.ondataavailable=e=>{e.data.size>0&&n.audioChunks.push(e.data)},n.mediaRecorder.onstop=async()=>{t.getTracks().forEach(e=>e.stop());const a=new Blob(n.audioChunks,{type:n.mediaRecorder.mimeType});if(a.size<1e3)return void console.warn("[VocalIA] Audio too short");const o=e.VOICE_API_URL.replace("/respond","/stt");try{const e=await(await fetch(o,{method:"POST",headers:{"X-Language":n.currentLang},body:a,signal:AbortSignal.timeout(15e3)})).json();if(e.success&&e.text){const t=d("va-input");t&&(t.value=e.text),x(e.text,"voice")}else console.warn("[VocalIA] STT failed:",e.error)}catch(e){console.error("[VocalIA] STT request failed:",e.message)}},n.mediaRecorder.start(),n.isListening=!0,n.recordingTimeout=setTimeout(()=>{if("recording"===n.mediaRecorder?.state){n.mediaRecorder.stop(),n.isListening=!1;const e=d("va-mic"),t=d("va-visualizer");e&&e.classList.remove("listening"),t&&t.classList.remove("active")}},1e4)}catch(e){console.error("[VocalIA] Microphone access denied:",e.message),n.isListening=!1;const t=d("va-mic");t&&t.classList.remove("listening")}}();const t=d("va-mic"),a=d("va-visualizer");t&&t.classList.add("listening"),a&&a.classList.add("active"),c("voice_input_started",{mode:"fallback"})}}async function x(t,a="text"){if(!t?.trim())return;p(t,"user");const o=d("va-input");o&&(o.value=""),c("message_sent",{input_method:a,length:t.length});const i=n.conversationContext.bookingFlow;if(i.active){const a=y(),o=await async function(e){const t=n.langData;if(!t?.booking)return null;const a=e.toLowerCase(),o=n.conversationContext.bookingFlow;if(t.booking.cancelKeywords&&t.booking.cancelKeywords.some(e=>a.includes(e)))return c("booking_cancelled",{step:o.step}),o.active=!1,o.step=null,o.data={name:null,email:null,datetime:null,service:t.booking.service},t.booking.messages.cancelled;if("name"===o.step){const a=e.trim();return a.length<2?t.booking.messages.askName:(o.data.name=a,o.step="email",t.booking.messages.askEmail.replace("{name}",a))}if("email"===o.step){const a=e.trim().toLowerCase();if(!function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}(a))return t.booking.messages.invalidEmail;o.data.email=a,o.step="datetime";const n=await A();if(0===n.length)return t.booking.messages.noSlots;let i=t.booking.messages.slotsIntro;return n.slice(0,3).forEach((e,a)=>{i+=t.booking.messages.slotFormat.replace("{index}",a+1).replace("{date}",e.date).replace("{time}",e.time)+"\n"}),i+=t.booking.messages.slotsOutro,i}if("datetime"===o.step){const e=n.availableSlotsCache.slots.length>0?n.availableSlotsCache.slots.slice(0,3):T();let i=null;if(t.booking.slotKeywords)for(const[n,o]of Object.entries(t.booking.slotKeywords))if(o.some(e=>a.includes(e))){i=e[parseInt(n)-1];break}return i?(o.data.datetime=i.iso,o.step="confirm",c("booking_slot_selected",{slot_date:i.date,slot_time:i.time}),t.booking.messages.confirmIntro+t.booking.messages.confirmName.replace("{name}",o.data.name)+"\n"+t.booking.messages.confirmEmail.replace("{email}",o.data.email)+"\n"+t.booking.messages.confirmDate.replace("{date}",i.date).replace("{time}",i.time)+t.booking.messages.confirmOutro):t.booking.messages.slotNotUnderstood}return"confirm"===o.step?t.booking.confirmKeywords&&t.booking.confirmKeywords.some(e=>a.includes(e))?(o.step="submitting",null):t.booking.messages.confirmPrompt:null}(t);if(w(a),"submitting"===i.step){const t=y(),a=await async function(){const t=n.langData,a=n.conversationContext.bookingFlow,o=function(){try{return{iana:Intl.DateTimeFormat().resolvedOptions().timeZone,offset:(new Date).getTimezoneOffset()}}catch{return{iana:null,offset:(new Date).getTimezoneOffset()}}}(),i=await async function(t){try{const a=new AbortController,o=setTimeout(()=>a.abort(),e.API_TIMEOUT),i=await fetch(e.VOICE_API_URL,{method:"POST",headers:{"Content-Type":"application/json"},signal:a.signal,body:JSON.stringify({message:`[BOOKING] ${JSON.stringify(t)}`,language:n.currentLang,sessionId:n.sessionId,tenant_id:n.tenantId,widget_type:"B2B",booking_data:t,history:n.conversationHistory.slice(-6)})});clearTimeout(o);const s=await i.json();return{success:!!s.response,message:s.response||"Booking submitted"}}catch(e){return console.error("[VocalIA B2B] Booking submit error:",e),{success:!1,message:e.message}}}({name:a.data.name,email:a.data.email,datetime:a.data.datetime,service:a.data.service||t.booking?.service||"Consultation",notes:`Booking via B2B voice widget (${n.currentLang.toUpperCase()})`,timezone:o.iana||`UTC${o.offset>0?"-":"+"}${Math.abs(o.offset/60)}`});return a.active=!1,a.step=null,i.success?(c("booking_completed",{service:a.data.service,datetime:a.data.datetime}),t.booking?.messages?.success?.replace("{email}",a.data.email)||`Booking confirmed! Confirmation sent to ${a.data.email}.`):(c("booking_failed",{error:i.message}),t.booking?.messages?.failure?.replace("{message}",i.message)||"Sorry, the booking failed. Please try again.")}();w(t),a&&p(a,"assistant")}else o&&p(o,"assistant");return}n.bookingConfig.enabled&&(!n.planFeatures||!1!==n.planFeatures.booking)&&function(e){const t=n.langData;if(t?.booking?.keywords)return t.booking.keywords.some(t=>e.toLowerCase().includes(t));const a={fr:["rendez-vous","rdv","r√©server","booking","prendre rdv","disponibilit√©","cr√©neau","r√©servation"],en:["appointment","book","booking","schedule","reserve","availability","slot"],es:["cita","reservar","reserva","programar","disponibilidad","horario"],ar:["ŸÖŸàÿπÿØ","ÿ≠ÿ¨ÿ≤","ÿßÿ≠ÿ¨ÿ≤","ŸÖÿ™ÿßÿ≠","ŸàŸÇÿ™"],ary:["ŸÖŸàÿπÿØ","ÿ≠ÿ¨ÿ≤","ŸÜÿ≠ÿ¨ÿ≤","ŸàŸÇÿ™","ŸÉÿ±ŸäŸÜŸä","ÿ±ÿØŸÅŸà"]};return(a[n.currentLang]||a.fr).some(t=>e.toLowerCase().includes(t))}(t)&&L();const s=y();try{const a=new AbortController,o=setTimeout(()=>a.abort(),e.API_TIMEOUT),i={message:t,language:n.currentLang,sessionId:n.sessionId,tenant_id:n.tenantId,api_key:e.api_key||void 0,widget_type:"B2B",history:n.conversationHistory.slice(-6)};n.conversationHistory.length<=2&&(i.page_context=r());const l=await fetch(e.VOICE_API_URL,{method:"POST",headers:{"Content-Type":"application/json"},signal:a.signal,body:JSON.stringify(i)});clearTimeout(o),w(s);const g=await l.json();g.response?(g.features&&(n.planFeatures=g.features),p(g.response,"assistant",{typewriter:!0}),function(e){const t=e.toLowerCase(),a={fr:["ne peux pas","pas en mesure","contactez","contacter","d√©passe mes comp√©tences","agent humain"],en:["cannot help","beyond my","contact us","human agent","speak to someone"],es:["no puedo","contacte con","agente humano"],ar:["ŸÑÿß ÿ£ÿ≥ÿ™ÿ∑Ÿäÿπ","ÿ™ŸàÿßÿµŸÑ ŸÖÿπ","ŸÖŸàÿ∏ŸÅ"],ary:["ŸÖÿßŸÇÿØÿ±ÿ™ÿ¥","ÿ™ŸàÿßÿµŸÑ ŸÖÿπ","ÿπŸäÿ∑"]};return(a[n.currentLang]||a.fr).some(e=>t.includes(e))}(g.response)&&setTimeout(()=>function(){const e=d("va-messages");if(!e)return;const t={fr:{email:"Envoyer un email",call:"Appeler",book:"Prendre RDV"},en:{email:"Send email",call:"Call us",book:"Book appointment"},es:{email:"Enviar email",call:"Llamar",book:"Reservar cita"},ar:{email:"ÿ•ÿ±ÿ≥ÿßŸÑ ÿ®ÿ±ŸäÿØ",call:"ÿßÿ™ÿµŸÑ",book:"ÿ≠ÿ¨ÿ≤ ŸÖŸàÿπÿØ"},ary:{email:"ÿµŸäŸÅÿ∑ ÿ•ŸäŸÖŸäŸÑ",call:"ÿπŸäÿ∑",book:"ÿ≠ÿ¨ÿ≤ ŸÖŸàÿπÿØ"}},a=t[n.currentLang]||t.fr,o=document.createElement("div");o.className="va-message assistant";const i=document.createElement("div");i.className="va-message-content",i.style.cssText="padding:12px 16px;";const s="display:inline-block;padding:8px 14px;border-radius:8px;font-size:13px;font-weight:600;margin:4px;cursor:pointer;text-decoration:none;",r=document.createElement("a");if(r.href="mailto:contact@vocalia.ma",r.style.cssText=s+"background:rgba(94,106,210,0.15);color:#818cf8;border:1px solid rgba(94,106,210,0.3);",r.textContent=a.email,i.appendChild(r),n.bookingConfig.phone){const e=document.createElement("a");e.href=`tel:${n.bookingConfig.phone}`,e.style.cssText=s+"background:rgba(94,106,210,0.08);color:#a5b4fc;border:1px solid rgba(94,106,210,0.2);",e.textContent=a.call,i.appendChild(e)}if(n.bookingConfig.enabled){const e=document.createElement("button");e.type="button",e.style.cssText=s+"background:#5E6AD2;color:white;border:none;",e.textContent=a.book,e.addEventListener("click",()=>I()),i.appendChild(e)}o.appendChild(i),e.appendChild(o),e.scrollTop=e.scrollHeight,c("handoff_shown")}(),800),g.a2ui&&function(t){if(!t||!t.html)return;const a=d("va-messages");if(!a)return;const o=document.createElement("div");if(o.className="va-message assistant va-a2ui-wrapper",t.css){const e=document.createElement("style");e.textContent=t.css,o.appendChild(e)}const i=document.createElement("div");i.className="va-message-content",i.innerHTML=function(e){const t=/^(div|span|button|p|h[1-6]|ul|ol|li|img|svg|path|line|circle|label|input|select|option|strong|em|br|a)$/i,a=/^(class|id|style|data-[a-z-]+|aria-[a-z]+|role|type|placeholder|value|src|alt|href|viewBox|d|fill|stroke|stroke-width|stroke-linecap|stroke-linejoin|xmlns|width|height|x1|y1|x2|y2|cx|cy|r|loading|dir|disabled)$/i,n=document.createElement("div");n.innerHTML=e;const o=e=>{const n=Array.from(e.childNodes);for(const e of n)if(3!==e.nodeType){if(1!==e.nodeType){e.remove();continue}if(!t.test(e.tagName)){e.remove();continue}for(const t of Array.from(e.attributes))a.test(t.name)||e.removeAttribute(t.name);for(const t of Array.from(e.attributes))t.name.startsWith("on")&&e.removeAttribute(t.name);e.hasAttribute("href")&&/^\s*javascript:/i.test(e.getAttribute("href"))&&e.removeAttribute("href"),e.hasAttribute("src")&&/^\s*javascript:/i.test(e.getAttribute("src"))&&e.removeAttribute("src"),o(e)}};return o(n),n.innerHTML}(t.html),o.appendChild(i),a.appendChild(o),a.scrollTop=a.scrollHeight,o.querySelectorAll("[data-a2ui-action]").forEach(a=>{a.addEventListener("click",()=>{!async function(t,a){if(c("a2ui_action",{action:t,type:a.type}),"select_slot"===t){const e=a.element.closest("[data-a2ui-component]");if(e){e.querySelectorAll(".va-a2ui-slot").forEach(e=>e.classList.remove("selected")),a.element.classList.add("selected");const t=e.querySelector('[data-a2ui-action="confirm_booking"]');t&&(t.disabled=!1)}return}if("close"===t)return void a.wrapper.remove();const o={},i=a.element.closest("[data-a2ui-component]");if("confirm_booking"===t&&i){const e=i.querySelector(".va-a2ui-slot.selected");o.slot=e?.dataset.slot}else if("submit_lead"===t&&i){const e=i.querySelector("form");e&&new FormData(e).forEach((e,t)=>{o[t]=e})}try{const a=await(await fetch(e.VOICE_API_URL.replace("/respond","/a2ui/action"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:t,data:o,sessionId:n.sessionId,tenant_id:n.tenantId,widget_type:"B2B"})})).json();a.message&&p(a.message,"assistant")}catch(e){console.warn("[VocalIA B2B] A2UI action failed:",e.message)}}(a.dataset.a2uiAction,{type:t.type,value:a.dataset.slot||a.dataset.productId||null,element:a,wrapper:o})})}),c("a2ui_rendered",{type:t.type})}(g.a2ui),g.action&&"show_carousel"===g.action.type&&g.action.products&&g.action.products.length>0?b(g.action.products,g.action.title):g.catalog&&g.catalog.items&&g.catalog.items.length>0&&b(g.catalog.items,g.catalog.title),g.lead&&(n.leadData=g.lead,"hot"===g.lead.status&&n.bookingConfig.enabled&&!n.bookingCtaShown&&(n.bookingCtaShown=!0,setTimeout(()=>L(),1e3)),g.lead.extractedData?.email&&(n.conversationContext.bookingFlow.data.email=g.lead.extractedData.email),g.lead.extractedData?.name&&(n.conversationContext.bookingFlow.data.name=g.lead.extractedData.name))):p(n.langData?.ui?.errorMessage||"D√©sol√©, une erreur s'est produite.","assistant")}catch(e){w(s);const t=n.langData?.ui||{};p("AbortError"===e.name?t.timeoutMessage||"The request took too long. Please try again.":t.connectionError||t.errorMessage||"Sorry, I'm experiencing a connection issue.","assistant"),console.error("[VocalIA] API error:",e)}}function y(){const e=d("va-messages");if(!e)return null;const t=`typing-${Date.now()}`,a=document.createElement("div");return a.id=t,a.className="va-message assistant",a.innerHTML='<div class="va-message-content" style="display:flex;gap:4px;padding:14px 18px;">\n            <span style="width:8px;height:8px;background:var(--va-accent);border-radius:50%;animation:vaTyping 1s infinite;"></span>\n            <span style="width:8px;height:8px;background:var(--va-accent);border-radius:50%;animation:vaTyping 1s infinite 0.2s;"></span>\n            <span style="width:8px;height:8px;background:var(--va-accent);border-radius:50%;animation:vaTyping 1s infinite 0.4s;"></span>\n        </div>\n        <style>@keyframes vaTyping { 0%, 60%, 100% { transform: translateY(0); opacity: 0.5; } 30% { transform: translateY(-4px); opacity: 1; } }</style>',e.appendChild(a),e.scrollTop=e.scrollHeight,t}function w(e){if(!e)return;const t=d(e);t&&t.remove()}function k(){n.exitIntent.triggered=!0;try{localStorage.setItem("vocalia_exit_intent",Date.now().toString())}catch{}const e=n.langData,t=r(),a=(e.exitIntent?.contextual||{})[t.pageType]||e.exitIntent?.subtitle||"Avez-vous des questions ?",o=e.exitIntent?.title||"Attendez !",i=e.exitIntent?.ctaChat||"Discuter maintenant",s=e.exitIntent?.ctaDemo||"R√©server une d√©mo",l=d("va-exit-overlay");l&&l.remove();const p=e.meta?.rtl,m=document.createElement("div");m.id="va-exit-overlay",m.style.cssText=`position:absolute;bottom:70px;${p?"left":"right"}:0;width:300px;z-index:10000;animation:vaSlideUp 0.3s ease;`,m.innerHTML=`\n            <div style="background:linear-gradient(145deg,#1e2642,#191e35);border:1px solid rgba(94,106,210,0.35);border-radius:14px;padding:16px 18px;box-shadow:0 10px 40px rgba(0,0,0,0.4);">\n                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">\n                    <span style="font-size:16px;font-weight:700;color:#e5e5e5;">${v(o)}</span>\n                    <button id="va-exit-dismiss" style="background:none;border:none;color:rgba(255,255,255,0.4);cursor:pointer;font-size:16px;padding:0 2px;">‚úï</button>\n                </div>\n                <p style="font-size:13px;color:rgba(255,255,255,0.7);margin:0 0 14px;line-height:1.5;">${v(a)}</p>\n                <div style="display:flex;gap:8px;flex-wrap:wrap;">\n                    <button id="va-exit-chat" style="flex:1;padding:10px 14px;border-radius:8px;background:#5E6AD2;color:white;border:none;font-size:13px;font-weight:600;cursor:pointer;transition:opacity 0.2s;">${v(i)}</button>\n                    <button id="va-exit-demo" style="flex:1;padding:10px 14px;border-radius:8px;background:rgba(94,106,210,0.15);color:#818cf8;border:1px solid rgba(94,106,210,0.3);font-size:13px;font-weight:600;cursor:pointer;transition:opacity 0.2s;">${v(s)}</button>\n                </div>\n            </div>\n        `;const u=d("va-trigger");u&&u.parentNode&&u.parentNode.appendChild(m);const b=m.querySelector("#va-exit-dismiss"),h=m.querySelector("#va-exit-chat"),f=m.querySelector("#va-exit-demo");b&&b.addEventListener("click",()=>m.remove()),h&&h.addEventListener("click",()=>{m.remove(),n.isOpen||g()}),f&&f.addEventListener("click",()=>{m.remove(),n.isOpen||g(),n.bookingConfig.enabled&&(!n.planFeatures||!1!==n.planFeatures.booking)&&setTimeout(()=>I(),500)}),setTimeout(()=>{m.parentNode&&m.remove()},15e3),c("exit_intent_triggered",{pageType:t.pageType})}function _(){if(n.isOpen||0===n.socialProof.messages.length)return;const t="ar"===n.currentLang||"ary"===n.currentLang,a=n.socialProof.messages[n.socialProof.notificationsShown%n.socialProof.messages.length],o=document.createElement("div");o.className="va-b2b-social-proof";const i=`va-b2b-sp-${Date.now()}`;o.id=i;const s=document.createElement("style");s.textContent=`\n            .va-b2b-social-proof {\n                position: fixed; bottom: 100px; ${t?"left":"right"}: 25px;\n                max-width: 280px; background: linear-gradient(145deg, #1e2642, #191e35);\n                border: 1px solid rgba(94, 106, 210, 0.25); border-radius: 12px;\n                padding: 12px 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);\n                z-index: 99997; font-family: Inter, -apple-system, sans-serif;\n                animation: vaB2bSlideIn 0.4s ease, vaB2bFadeOut 0.3s ease ${e.SOCIAL_PROOF_DURATION-300}ms forwards;\n                ${t?"direction: rtl;":""}\n            }\n            @keyframes vaB2bSlideIn {\n                from { opacity: 0; transform: translateX(${t?"-":""}30px); }\n                to { opacity: 1; transform: translateX(0); }\n            }\n            @keyframes vaB2bFadeOut { from { opacity: 1; } to { opacity: 0; } }\n        `,o.appendChild(s);const r=document.createElement("div");r.style.cssText="display:flex;align-items:center;gap:10px;";const g=document.createElement("div");g.style.cssText="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#5E6AD2,#818cf8);display:flex;align-items:center;justify-content:center;flex-shrink:0;";const p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("width","18"),p.setAttribute("height","18"),p.setAttribute("fill","white");const m=a.icon&&/^<(?:path|circle|rect|line|polyline|polygon|ellipse|g)\s/.test(a.icon.trim())?a.icon:'<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>';p.innerHTML=m,g.appendChild(p);const u=document.createElement("div"),v=document.createElement("div");if(v.style.cssText="font-size:13px;color:rgba(255,255,255,0.9);line-height:1.4;",v.textContent=a.text,u.appendChild(v),a.time){const e=document.createElement("div");e.style.cssText="font-size:11px;color:rgba(94,106,210,0.7);margin-top:4px;",e.textContent=a.time,u.appendChild(e)}r.appendChild(g),r.appendChild(u);const b=document.createElement("button");b.style.cssText="position:absolute;top:6px;"+(t?"left":"right")+":6px;background:none;border:none;cursor:pointer;color:rgba(255,255,255,0.4);padding:2px;",b.setAttribute("aria-label",n.langData?.ui?.ariaClose||"Close"),b.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>',b.addEventListener("click",()=>o.remove()),o.appendChild(b),o.appendChild(r),(l||document.body).appendChild(o),setTimeout(()=>{const e=d(i);e&&e.remove()},e.SOCIAL_PROOF_DURATION),n.socialProof.notificationsShown++,n.socialProof.lastShownTime=Date.now(),c("social_proof_shown",{index:n.socialProof.notificationsShown})}function T(){const e=new Date,t="ar"===n.currentLang||"ary"===n.currentLang,a=n.langData?.meta?.speechSynthesis||"fr-FR",o=[];for(let n=1;n<=7;n++){const i=new Date(e);i.setDate(e.getDate()+n);const s=i.getDay();if((t?[0,1,2,3,4]:[1,2,3,4,5]).includes(s)&&(i.setHours(10,0,0,0),o.push({date:i.toLocaleDateString(a,{weekday:"long",month:"long",day:"numeric"}),time:"10:00",iso:i.toISOString()}),o.length>=3))break}return o}async function A(){const e=Date.now();if(n.availableSlotsCache.slots.length>0&&e-n.availableSlotsCache.timestamp<3e5)return n.availableSlotsCache.slots;if(n.bookingConfig.url)try{const t=await(await fetch(n.bookingConfig.url+(n.bookingConfig.url.includes("?")?"&":"?")+"action=availability",{method:"GET",mode:"cors",signal:AbortSignal.timeout(5e3)})).json();if(t.success&&t.data?.slots){const a=n.langData?.meta?.speechSynthesis||"fr-FR",o=t.data.slots.slice(0,6).map(e=>{const t=new Date(e.start);return{date:t.toLocaleDateString(a,{weekday:"long",month:"long",day:"numeric"}),time:t.toLocaleTimeString(a,{hour:"numeric",minute:"2-digit"}),iso:e.start}});return n.availableSlotsCache={slots:o,timestamp:e},o}}catch(e){console.warn("[VocalIA B2B] Slots fetch error, using static:",e.message)}const t=T();return n.availableSlotsCache={slots:t,timestamp:e},t}function L(){if(!n.bookingConfig.enabled)return;const e=d("va-messages");if(!e)return;const t=document.createElement("div");t.className="va-message assistant";const a=document.createElement("div");a.className="va-message-content",a.style.cssText="padding:12px 16px;";const o={fr:{inline:"R√©server maintenant",online:"R√©server en ligne",call:"Appeler pour r√©server"},en:{inline:"Book now",online:"Book online",call:"Call to book"},es:{inline:"Reservar ahora",online:"Reservar en l√≠nea",call:"Llamar para reservar"},ar:{inline:"ÿßÿ≠ÿ¨ÿ≤ ÿßŸÑÿ¢ŸÜ",online:"ÿßÿ≠ÿ¨ÿ≤ ÿπÿ®ÿ± ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™",call:"ÿßÿ™ÿµŸÑ ŸÑŸÑÿ≠ÿ¨ÿ≤"},ary:{inline:"ÿßÿ≠ÿ¨ÿ≤ ÿØÿßÿ®ÿß",online:"ÿßÿ≠ÿ¨ÿ≤ ÿ£ŸàŸÜŸÑÿßŸäŸÜ",call:"ÿπŸäÿ∑ ÿ®ÿßÿ¥ ÿ™ÿ≠ÿ¨ÿ≤"}},i=o[n.currentLang]||o.fr,s="display:inline-block;padding:8px 16px;border-radius:8px;text-decoration:none;font-size:13px;font-weight:600;margin:4px 4px 4px 0;transition:opacity 0.2s;cursor:pointer;",r=document.createElement("button");if(r.type="button",r.style.cssText=s+"background:#5E6AD2;color:white;border:none;",r.textContent=i.inline,r.addEventListener("click",()=>{I()}),a.appendChild(r),n.bookingConfig.url){const e=document.createElement("a");e.href=n.bookingConfig.url,e.target="_blank",e.rel="noopener noreferrer",e.style.cssText=s+"background:rgba(94,106,210,0.15);color:#818cf8;border:1px solid rgba(94,106,210,0.3);",e.textContent=i.online,a.appendChild(e)}if(n.bookingConfig.phone){const e=document.createElement("a");e.href=`tel:${n.bookingConfig.phone}`,e.style.cssText=s+"background:rgba(94,106,210,0.08);color:#a5b4fc;border:1px solid rgba(94,106,210,0.2);",e.textContent=i.call,a.appendChild(e)}t.appendChild(a),e.appendChild(t),e.scrollTop=e.scrollHeight,c("booking_cta_shown")}function I(){const e=n.langData,t=n.conversationContext.bookingFlow;t.active=!0,t.data.service=e?.booking?.service||"Consultation",t.data.name&&t.data.email?(t.step="datetime",p((e.booking?.messages?.askEmail||"").replace("{name}",t.data.name)||`${t.data.name}, ${t.data.email} ‚Äî fetching slots...`,"assistant"),A().then(t=>{if(0===t.length)return void p(e.booking?.messages?.noSlots||"No slots available.","assistant");let a=e.booking?.messages?.slotsIntro||"Available slots:\n";t.slice(0,3).forEach((t,n)=>{a+=(e.booking?.messages?.slotFormat||"{index}. {date} at {time}").replace("{index}",n+1).replace("{date}",t.date).replace("{time}",t.time)+"\n"}),a+=e.booking?.messages?.slotsOutro||"\nChoose 1, 2 or 3.",p(a,"assistant")})):t.data.name?(t.step="email",p((e.booking?.messages?.askEmail||"What is your email?").replace("{name}",t.data.name),"assistant")):(t.step="name",p(e?.booking?.messages?.start||"Let's book an appointment. What is your name?","assistant")),c("booking_flow_started",{skippedSteps:t.data.name&&t.data.email?"name+email":"none"})}async function C(){try{window.VOCALIA_CONFIG_INJECTED&&Object.assign(e,window.VOCALIA_CONFIG_INJECTED),window.VOCALIA_CONFIG&&Object.assign(e,window.VOCALIA_CONFIG);const t=function(){const t=new URLSearchParams(window.location.search).get("lang");if(t&&e.SUPPORTED_LANGS.includes(t))return t;const a=document.documentElement.lang?.toLowerCase()?.split("-")[0];if(a&&e.SUPPORTED_LANGS.includes(a))return a;const n=navigator.language||navigator.userLanguage,o=e.AUTO_DETECT_LANGUAGES[n]||e.AUTO_DETECT_LANGUAGES[n?.split("-")[0]];return o&&e.SUPPORTED_LANGS.includes(o)?o:e.DEFAULT_LANG}();await s(t);const a=document.querySelector("script[data-vocalia-tenant]");if(a?n.tenantId=a.dataset.vocaliaTenant:e.tenantId&&(n.tenantId=e.tenantId),function(){const e=new URLSearchParams(window.location.search),t=n.conversationContext.attribution;t.utm_source=e.get("utm_source")||t.utm_source,t.utm_medium=e.get("utm_medium")||t.utm_medium,t.utm_campaign=e.get("utm_campaign")||t.utm_campaign}(),function(){if(document.getElementById("vocalia-widget"))return;const t=n.langData,a=t.meta.rtl,i=a?"left":"right",s=document.createElement("div");s.id="vocalia-widget",s.style.cssText=`position:fixed;bottom:30px;${i}:25px;z-index:99999;${a?"direction:rtl;":""}`,document.body.appendChild(s),l=s.attachShadow({mode:"open"}),l.innerHTML=function(t,a,n){return`\n      <style>\n        #vocalia-widget {\n          --va-primary: ${e.primaryColor};\n          --va-primary-dark: ${e.primaryDark};\n          --va-accent: ${e.accentColor};\n          --va-dark: ${e.darkBg};\n        }\n        .va-trigger {\n          width: 60px; height: 60px; border-radius: 50%;\n          background: linear-gradient(135deg, var(--va-primary) 0%, var(--va-primary-dark) 100%);\n          border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;\n          box-shadow: 0 4px 20px rgba(94, 106, 210, 0.4);\n          transition: all 0.3s ease; position: relative;\n          animation: vaTriggerPulse 2.5s ease-in-out infinite;\n        }\n        .va-trigger:hover { transform: scale(1.1); box-shadow: 0 6px 30px rgba(94, 106, 210, 0.6); animation: none; }\n        @keyframes vaTriggerPulse {\n          0%, 100% { box-shadow: 0 4px 20px rgba(94, 106, 210, 0.4); transform: scale(1); }\n          50% { box-shadow: 0 4px 30px rgba(94, 106, 210, 0.7); transform: scale(1.02); }\n        }\n        .va-trigger img { width: 36px; height: 36px; object-fit: contain; border-radius: 50%; }\n\n        .va-panel {\n          display: none; position: absolute; bottom: 70px; ${n}: 0;\n          width: 380px; max-height: 520px; background: var(--va-dark);\n          border: 1px solid rgba(94, 106, 210, 0.3); border-radius: 16px;\n          overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5);\n          flex-direction: column;\n        }\n        .va-panel.open { display: flex; animation: vaSlideUp 0.3s ease; }\n        @keyframes vaSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }\n\n        .va-header {\n          padding: 16px 20px; background: linear-gradient(135deg, var(--va-primary), var(--va-primary-dark));\n          display: flex; align-items: center; gap: 12px;\n        }\n        .va-header-logo { width: 40px; height: 40px; border-radius: 50%; background: white; padding: 4px; }\n        .va-header-logo img { width: 100%; height: 100%; object-fit: contain; }\n        .va-header-text h3 { margin: 0; font-size: 16px; color: white; font-weight: 600; }\n        .va-header-text p { margin: 2px 0 0; font-size: 12px; color: rgba(255,255,255,0.8); }\n        .va-close { margin-${a?"right":"left"}: auto; background: rgba(255,255,255,0.1); border: none; color: white; cursor: pointer; width: 28px; height: 28px; border-radius: 50%; font-size: 16px; transition: background 0.2s; }\n        .va-close:hover { background: rgba(255,255,255,0.2); }\n\n        .va-messages { flex: 1; overflow-y: auto; padding: 16px; min-height: 220px; max-height: 350px; }\n        .va-message { margin-bottom: 12px; display: flex; gap: 8px; }\n        .va-message-content { max-width: 85%; padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; }\n        .va-message.assistant .va-message-content { background: rgba(94, 106, 210, 0.15); color: #e5e5e5; border-bottom-left-radius: 4px; }\n        .va-message.user { justify-content: flex-end; }\n        .va-message.user .va-message-content { background: var(--va-primary); color: white; border-bottom-right-radius: 4px; }\n\n        .va-input-area { padding: 12px 16px; border-top: 1px solid rgba(94, 106, 210, 0.2); display: flex; gap: 8px; background: rgba(0,0,0,0.2); }\n        .va-input { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(94, 106, 210, 0.3); border-radius: 24px; padding: 12px 18px; color: white; outline: none; font-size: 14px; }\n        .va-input:focus { border-color: var(--va-primary); box-shadow: 0 0 0 2px rgba(94, 106, 210, 0.2); }\n        .va-input::placeholder { color: rgba(255,255,255,0.5); }\n\n        .va-btn { width: 44px; height: 44px; border-radius: 50%; background: var(--va-primary); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }\n        .va-btn:hover { background: var(--va-primary-dark); transform: scale(1.05); }\n        .va-btn.listening { background: #DC2626; animation: vaPulse 1.5s infinite; }\n        .va-btn-send { background: transparent; border: 1px solid rgba(94, 106, 210, 0.5); }\n        .va-btn-send:hover { background: rgba(94, 106, 210, 0.2); border-color: var(--va-primary); }\n\n        @keyframes vaPulse { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } }\n\n        .va-visualizer { height: 40px; display: none; padding: 0 16px; align-items: center; justify-content: center; background: rgba(94, 106, 210, 0.1); }\n        .va-visualizer.active { display: flex; }\n        .va-visualizer-bar { width: 4px; background: var(--va-accent); margin: 0 3px; border-radius: 2px; animation: vaSound 0.5s infinite alternate; }\n        .va-visualizer-bar:nth-child(1) { animation-delay: 0s; }\n        .va-visualizer-bar:nth-child(2) { animation-delay: 0.1s; }\n        .va-visualizer-bar:nth-child(3) { animation-delay: 0.2s; }\n        .va-visualizer-bar:nth-child(4) { animation-delay: 0.3s; }\n        .va-visualizer-bar:nth-child(5) { animation-delay: 0.15s; }\n        .va-visualizer-bar:nth-child(6) { animation-delay: 0.25s; }\n        .va-visualizer-bar:nth-child(7) { animation-delay: 0.05s; }\n        .va-visualizer-bar:nth-child(8) { animation-delay: 0.35s; }\n        @keyframes vaSound { 0% { height: 4px; opacity: 0.5; } 100% { height: 24px; opacity: 1; } }\n\n        .va-notif-bubble { position: absolute; bottom: 70px; ${n}: 0; white-space: nowrap; z-index: 9999; animation: vaFadeIn 0.5s ease; }\n        .va-notif-bubble-content { padding: 12px 16px; background: white; color: #0F172A; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); font-size: 14px; font-weight: 500; border-left: 4px solid var(--va-primary); }\n        @keyframes vaFadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }\n\n        /* Service/Product Cards for Catalog Mode */\n        .va-service-cards { display: flex; overflow-x: auto; gap: 10px; padding: 8px 0; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }\n        .va-service-cards::-webkit-scrollbar { height: 3px; }\n        .va-service-cards::-webkit-scrollbar-thumb { background: var(--va-primary); border-radius: 3px; }\n        .va-service-card { min-width: 200px; max-width: 220px; background: rgba(94, 106, 210, 0.08); border: 1px solid rgba(94, 106, 210, 0.2); border-radius: 12px; overflow: hidden; cursor: pointer; transition: all 0.2s; scroll-snap-align: start; flex-shrink: 0; }\n        .va-service-card:hover { border-color: var(--va-primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(94, 106, 210, 0.2); }\n        .va-service-card-img { width: 100%; height: 110px; object-fit: cover; background: rgba(94, 106, 210, 0.05); }\n        .va-service-card-img-placeholder { width: 100%; height: 110px; display: flex; align-items: center; justify-content: center; font-size: 28px; background: rgba(94, 106, 210, 0.05); }\n        .va-service-card-body { padding: 10px 12px; }\n        .va-service-card-title { font-size: 13px; font-weight: 600; color: #e5e5e5; margin: 0 0 4px; line-height: 1.3; }\n        .va-service-card-desc { font-size: 11px; color: rgba(255,255,255,0.6); margin: 0 0 8px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }\n        .va-service-card-price { font-size: 13px; font-weight: 700; color: var(--va-accent); }\n        .va-service-card-cta { display: block; width: 100%; margin-top: 8px; padding: 6px; background: var(--va-primary); color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; text-align: center; transition: background 0.2s; }\n        .va-service-card-cta:hover { background: var(--va-primary-dark); }\n        .va-catalog-header { display: flex; align-items: center; gap: 6px; margin-bottom: 6px; color: #e5e5e5; font-size: 13px; font-weight: 600; }\n        .va-catalog-header svg { width: 14px; height: 14px; fill: var(--va-primary); }\n\n        .va-feedback-bar { display:flex; gap:4px; margin-top:4px; }\n        .va-feedback-btn { background:none; border:1px solid rgba(94,106,210,0.2); border-radius:6px; padding:2px 8px; cursor:pointer; font-size:12px; transition:all 0.2s; color:rgba(255,255,255,0.5); }\n        .va-feedback-btn:hover { border-color:rgba(94,106,210,0.5); background:rgba(94,106,210,0.1); }\n\n        @media (max-width: 480px) {\n          .va-panel { width: calc(100vw - 40px); ${n}: -5px; }\n        }\n      </style>\n\n      <button class="va-trigger" id="va-trigger" aria-label="${t.ui.ariaOpenAssistant}">\n        <img src="${e.LOGO_PATH}" alt="VocalIA" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22white%22><path d=%22M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z%22/><path d=%22M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z%22/></svg>'"/>\n      </button>\n\n      <div class="va-panel" id="va-panel" role="dialog" aria-label="${t.ui.headerTitle||"VocalIA Assistant"}" aria-modal="true">\n        <div class="va-header">\n          <div class="va-header-logo">\n            <img src="${e.LOGO_PATH}" alt="VocalIA" onerror="this.style.display='none'"/>\n          </div>\n          <div class="va-header-text">\n            <h3>${t.ui.headerTitle||"VocalIA Assistant"}</h3>\n            <p>${t.ui.headerSubtitleVoice||"Expert IA"}</p>\n          </div>\n          <button class="va-close" id="va-close" aria-label="${t.ui.ariaClose||"Fermer"}">‚úï</button>\n        </div>\n\n        <div class="va-visualizer" id="va-visualizer" aria-hidden="true">\n          ${Array.from({length:8},()=>'<div class="va-visualizer-bar"></div>').join("")}\n        </div>\n\n        <div class="va-messages" id="va-messages" aria-live="polite" aria-relevant="additions"></div>\n\n        <div class="va-input-area">\n          <input type="text" class="va-input" id="va-input" placeholder="${t.ui.placeholder||"Posez votre question..."}" autocomplete="off">\n          ${o||typeof MediaRecorder<"u"?`\n          <button class="va-btn" id="va-mic" aria-label="${t.ui.ariaMic||"Microphone"}">\n            <svg viewBox="0 0 24 24" width="20" height="20" fill="white"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>\n          </button>`:""}\n          <button class="va-btn va-btn-send" id="va-send" aria-label="${t.ui.ariaSend||"Envoyer"}">\n            <svg viewBox="0 0 24 24" width="18" height="18" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>\n          </button>\n        </div>\n      </div>\n    `}(t,a,i),function(){const e=d("va-trigger"),t=d("va-close"),a=d("va-send"),o=d("va-input"),i=d("va-mic");e&&e.addEventListener("click",g),t&&t.addEventListener("click",g),a&&a.addEventListener("click",()=>{const e=o?.value?.trim();e&&x(e,"text")}),o&&o.addEventListener("keypress",e=>{if("Enter"===e.key){const t=e.target.value?.trim();t&&x(t,"text")}}),i&&(function(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(n.recognition=new e,n.recognition.lang=n.langData?.meta?.speechRecognition||"fr-FR",n.recognition.continuous=!1,n.recognition.interimResults=!1,n.recognition.onresult=e=>{const t=e.results[0][0].transcript,a=d("va-input");a&&(a.value=t),x(t,"voice")},n.recognition.onend=()=>{n.isListening=!1;const e=d("va-mic"),t=d("va-visualizer");e&&e.classList.remove("listening"),t&&t.classList.remove("active")},n.recognition.onerror=e=>{console.warn("[VocalIA] Speech recognition error:",e.error),n.isListening=!1;const t=d("va-mic");t&&t.classList.remove("listening")},n.sttMode="native"):navigator.mediaDevices&&typeof MediaRecorder<"u"?(n.sttMode="fallback",console.log("[VocalIA B2B] Using MediaRecorder STT fallback")):n.sttMode="none"}(),"none"!==n.sttMode?i.addEventListener("click",f):i.style.display="none"),document.addEventListener("keydown",e=>{if(n.isOpen){if("Escape"===e.key){g();const e=d("va-trigger");return void(e&&e.focus())}if("Tab"===e.key){const t=d("va-panel");if(!t)return;const a=t.querySelectorAll('button, input, [tabindex]:not([tabindex="-1"])');if(0===a.length)return;const n=a[0],o=a[a.length-1],i=(l||document).activeElement;e.shiftKey&&i===n?(e.preventDefault(),o.focus()):!e.shiftKey&&i===o&&(e.preventDefault(),n.focus())}}}),c("widget_initialized",{language:n.currentLang})}(),setTimeout(()=>{n.isOpen||function(){const e=n.langData,t=d("va-trigger");if(!t)return;const a=document.createElement("div");a.className="va-notif-bubble";const o=document.createElement("div");o.className="va-notif-bubble-content",o.textContent="üëã "+(e.ui.notifTitle||"Besoin d'aide ?"),a.appendChild(o),t.parentNode.appendChild(a),setTimeout(()=>a.remove(),6e3)}()},3e3)}(),function(){if(!e.EXIT_INTENT_ENABLED)return;let t=null;try{t=localStorage.getItem("vocalia_exit_intent")}catch{}if(t&&Date.now()-parseInt(t)<e.EXIT_INTENT_COOLDOWN)return;document.addEventListener("mouseout",t=>{t.clientY<=10&&!n.exitIntent.triggered&&!n.isOpen&&Date.now()-n.exitIntent.pageLoadTime>e.EXIT_INTENT_DELAY&&k()});let a=window.scrollY;window.addEventListener("scroll",()=>{const t=window.scrollY,o=(a-t)/window.innerHeight;t<a&&o>.3&&!n.exitIntent.triggered&&!n.isOpen&&Date.now()-n.exitIntent.pageLoadTime>e.EXIT_INTENT_DELAY&&k(),a=t},{passive:!0})}(),n.tenantId)try{const t=await(await fetch(`${e.CONFIG_API_URL}?tenantId=${encodeURIComponent(n.tenantId)}`,{signal:AbortSignal.timeout(5e3)})).json();t.success&&(t.plan_features&&(n.planFeatures=t.plan_features),t.features&&(e.SOCIAL_PROOF_ENABLED=!1!==t.features.social_proof_enabled,e.EXIT_INTENT_ENABLED=!1!==t.features.exit_intent_enabled),t.booking)&&(n.bookingConfig.url=t.booking.url||null,n.bookingConfig.phone=t.booking.phone||null,n.bookingConfig.enabled=(!n.planFeatures||!1!==n.planFeatures.booking)&&t.features?.booking_enabled&&!(!t.booking.url&&!t.booking.phone))}catch(e){console.warn("[VocalIA B2B] Config fetch failed, using defaults:",e.message)}(async function(){if(e.SOCIAL_PROOF_ENABLED){try{const t=`${e.SOCIAL_PROOF_API_URL}?lang=${n.currentLang}`,a=await(await fetch(t,{signal:AbortSignal.timeout(5e3)})).json();if(a.success&&Array.isArray(a.messages)&&a.messages.length>0)n.socialProof.messages=a.messages;else{const e=n.langData?.socialProof;if(!(e?.messages?.length>0))return;n.socialProof.messages=e.messages.map((t,a)=>({text:t.text||t,icon:null,time:e.times?.[a]||""}))}}catch(e){const t=n.langData?.socialProof;if(!(t?.messages?.length>0))return void console.warn("[VocalIA B2B] Social proof fetch failed, skipping:",e.message);n.socialProof.messages=t.messages.map((e,a)=>({text:e.text||e,icon:null,time:t.times?.[a]||""}))}setTimeout(()=>{_(),n.socialProof.intervalId=setInterval(()=>{n.socialProof.notificationsShown<e.SOCIAL_PROOF_MAX_SHOWN?_():clearInterval(n.socialProof.intervalId)},e.SOCIAL_PROOF_INTERVAL)},e.SOCIAL_PROOF_DELAY),console.log("[VocalIA B2B] Social proof initialized with",n.socialProof.messages.length,"messages")}})(),console.log(`[VocalIA B2B] Widget v2.7.0 initialized | Lang: ${n.currentLang} | Booking: ${n.bookingConfig.enabled} | PlanGating: ${!!n.planFeatures}`)}catch(e){console.error("[VocalIA B2B] Init error:",e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",C):C()}();