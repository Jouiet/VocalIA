/* VocalIA Widget v2.7.0 - 2026-02-13 */
!function(e){"use strict";function n(e){return"string"!=typeof e?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function t(){if(window.VOCALIA_CONFIG&&!1===window.VOCALIA_CONFIG.analytics_consent)return!1;try{if("denied"===localStorage.getItem("va_consent"))return!1}catch{}return!0}class o{constructor(e={}){this.options={containerId:"va-reco-carousel",maxItems:5,autoClose:3e4,onItemClick:null,onClose:null,lang:"fr",tenantId:e.tenantId||this._detectTenantId(),...e},this.container=null,this.isVisible=!1,this.autoCloseTimer=null,this.items=[]}_detectTenantId(){if(e.VOCALIA_CONFIG&&e.VOCALIA_CONFIG.tenant_id)return e.VOCALIA_CONFIG.tenant_id;const n=typeof document<"u"&&document.querySelector("[data-vocalia-tenant]");return n?n.dataset.vocaliaTenant:"default"}_injectStyles(e){if(e.querySelector("#va-reco-styles"))return;const n=document.createElement("style");n.id="va-reco-styles",n.textContent="\n    .va-reco-overlay {\n      position: fixed;\n      bottom: 100px;\n      right: 20px;\n      width: 380px;\n      max-height: 320px;\n      background: linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(30, 41, 59, 0.95));\n      border-radius: 16px;\n      border: 1px solid rgba(139, 92, 246, 0.3);\n      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 20px rgba(139, 92, 246, 0.1);\n      backdrop-filter: blur(20px);\n      z-index: 10002;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      opacity: 0;\n      transform: translateY(20px) scale(0.95);\n      transition: all 0.3s ease;\n      overflow: hidden;\n    }\n\n    .va-reco-overlay.va-reco-visible {\n      opacity: 1;\n      transform: translateY(0) scale(1);\n    }\n\n    .va-reco-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 12px 16px;\n      background: linear-gradient(90deg, rgba(139, 92, 246, 0.15), rgba(59, 130, 246, 0.15));\n      border-bottom: 1px solid rgba(139, 92, 246, 0.2);\n    }\n\n    .va-reco-title {\n      color: #e2e8f0;\n      font-size: 14px;\n      font-weight: 600;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .va-reco-title svg {\n      width: 18px;\n      height: 18px;\n      color: #8b5cf6;\n    }\n\n    .va-reco-close {\n      background: rgba(255, 255, 255, 0.1);\n      border: none;\n      color: #94a3b8;\n      cursor: pointer;\n      padding: 4px;\n      border-radius: 6px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.2s;\n    }\n\n    .va-reco-close:hover {\n      background: rgba(255, 255, 255, 0.15);\n      color: #e2e8f0;\n    }\n\n    .va-reco-content {\n      padding: 12px;\n      display: flex;\n      gap: 10px;\n      overflow-x: auto;\n      scroll-snap-type: x mandatory;\n      -webkit-overflow-scrolling: touch;\n      scrollbar-width: none;\n    }\n\n    .va-reco-content::-webkit-scrollbar {\n      display: none;\n    }\n\n    .va-reco-card {\n      flex: 0 0 140px;\n      scroll-snap-align: start;\n      background: rgba(255, 255, 255, 0.05);\n      border-radius: 12px;\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      overflow: hidden;\n      transition: all 0.2s;\n      cursor: pointer;\n    }\n\n    .va-reco-card:hover {\n      border-color: rgba(139, 92, 246, 0.4);\n      transform: translateY(-2px);\n      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);\n    }\n\n    .va-reco-image {\n      width: 100%;\n      height: 100px;\n      object-fit: cover;\n      background: linear-gradient(145deg, #1e293b, #334155);\n    }\n\n    .va-reco-image-placeholder {\n      width: 100%;\n      height: 100px;\n      background: linear-gradient(145deg, #1e293b, #334155);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: #64748b;\n    }\n\n    .va-reco-image-placeholder svg {\n      width: 32px;\n      height: 32px;\n    }\n\n    .va-reco-info {\n      padding: 10px;\n    }\n\n    .va-reco-name {\n      color: #e2e8f0;\n      font-size: 13px;\n      font-weight: 500;\n      line-height: 1.3;\n      margin-bottom: 6px;\n      display: -webkit-box;\n      -webkit-line-clamp: 2;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n\n    .va-reco-price {\n      color: #8b5cf6;\n      font-size: 14px;\n      font-weight: 600;\n    }\n\n    .va-reco-reason {\n      font-size: 10px;\n      color: #64748b;\n      margin-top: 4px;\n      display: flex;\n      align-items: center;\n      gap: 4px;\n    }\n\n    .va-reco-badge {\n      display: inline-block;\n      padding: 2px 6px;\n      background: rgba(139, 92, 246, 0.2);\n      color: #a78bfa;\n      font-size: 10px;\n      border-radius: 4px;\n      margin-top: 6px;\n    }\n\n    .va-reco-cta {\n      display: flex;\n      gap: 8px;\n      padding: 12px 16px;\n      border-top: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .va-reco-btn {\n      flex: 1;\n      padding: 10px 16px;\n      border-radius: 8px;\n      font-size: 13px;\n      font-weight: 500;\n      cursor: pointer;\n      transition: all 0.2s;\n      border: none;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 6px;\n    }\n\n    .va-reco-btn-primary {\n      background: linear-gradient(135deg, #8b5cf6, #6366f1);\n      color: white;\n    }\n\n    .va-reco-btn-primary:hover {\n      transform: translateY(-1px);\n      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n    }\n\n    .va-reco-btn-secondary {\n      background: rgba(255, 255, 255, 0.1);\n      color: #94a3b8;\n    }\n\n    .va-reco-btn-secondary:hover {\n      background: rgba(255, 255, 255, 0.15);\n      color: #e2e8f0;\n    }\n\n    /* RTL Support */\n    [dir=\"rtl\"] .va-reco-overlay {\n      right: auto;\n      left: 20px;\n    }\n\n    /* Mobile responsive */\n    @media (max-width: 480px) {\n      .va-reco-overlay {\n        width: calc(100vw - 40px);\n        right: 20px;\n        bottom: 90px;\n      }\n\n      .va-reco-card {\n        flex: 0 0 120px;\n      }\n\n      .va-reco-image,\n      .va-reco-image-placeholder {\n        height: 80px;\n      }\n    }\n  ",e.appendChild(n)}_createCarouselDOM(e,t){const o=this._getLabels(),i=document.createElement("div");return i.id=this.options.containerId,i.className="va-reco-overlay",i.setAttribute("role","dialog"),i.setAttribute("aria-label",t),("ar"===this.options.lang||"ary"===this.options.lang)&&i.setAttribute("dir","rtl"),i.innerHTML=`\n        <div class="va-reco-header">\n          <div class="va-reco-title">\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />\n            </svg>\n            <span>${n(t)}</span>\n          </div>\n          <button class="va-reco-close" aria-label="${o.close}">\n            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <line x1="18" y1="6" x2="6" y2="18"></line>\n              <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n          </button>\n        </div>\n        <div class="va-reco-content">\n          ${e.map((e,n)=>this._renderCard(e,n)).join("")}\n        </div>\n        <div class="va-reco-cta">\n          <button class="va-reco-btn va-reco-btn-secondary" data-action="voice">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>\n              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>\n              <line x1="12" y1="19" x2="12" y2="23"></line>\n              <line x1="8" y1="23" x2="16" y2="23"></line>\n            </svg>\n            ${o.askVoice}\n          </button>\n          <button class="va-reco-btn va-reco-btn-primary" data-action="viewAll">\n            ${o.viewAll}\n          </button>\n        </div>\n      `,i.querySelector(".va-reco-close").addEventListener("click",()=>this.hide()),i.querySelectorAll(".va-reco-card").forEach((n,t)=>{n.addEventListener("click",()=>{this.options.onItemClick&&this.options.onItemClick(e[t],t),this._trackClick(e[t],t)})}),i.querySelector('[data-action="voice"]').addEventListener("click",()=>{this.hide(),window.VocalIA?.openVoiceWidget&&window.VocalIA.openVoiceWidget()}),i.querySelector('[data-action="viewAll"]').addEventListener("click",()=>{this._trackViewAll(),this.options.onViewAll&&this.options.onViewAll()}),i}_renderCard(e,t){const o=this._getLabels(),i=e.title||e.name||`Product ${t+1}`,a=e.price?this._formatPrice(e.price,e.currency):"",r=e.image||e.images?.[0]?.src,s=this._getReasonLabel(e.reason),c=n(String(e.id||e.productId||"")),l=n(i),d=r?n(r):"",h=s?n(s):"";return`\n        <div class="va-reco-card" data-product-id="${c}" tabindex="0">\n          ${d?`<img class="va-reco-image" src="${d}" alt="${l}" loading="lazy" onerror="this.style.display='none'">`:'<div class="va-reco-image-placeholder">\n                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />\n                </svg>\n              </div>'}\n          <div class="va-reco-info">\n            <div class="va-reco-name">${l}</div>\n            ${a?`<div class="va-reco-price">${a}</div>`:""}\n            ${h?`<div class="va-reco-reason">${h}</div>`:""}\n            ${e.similarity?`<span class="va-reco-badge">${parseInt(e.similarity)||0}% ${n(o.match)}</span>`:""}\n          </div>\n        </div>\n      `}_formatPrice(e,n){const t=parseFloat(e);if(isNaN(t))return e;const o=n||window.VocalIA?.cart?.currency||"EUR",i={MAD:"DH",EUR:"€",USD:"$",GBP:"£"}[o]||o,a=t.toFixed("MAD"===o?0:2);return"EUR"===o||"USD"===o||"GBP"===o?`${i}${a}`:`${a} ${i}`}_getReasonLabel(e){const n=this._getLabels();return{similar_product:n.similarProduct,frequently_bought_together:n.boughtTogether,based_on_viewed:n.basedOnViewed,based_on_purchases:n.basedOnPurchases,personalized:n.personalized}[e]||""}_getLabels(){const e={fr:{close:"Fermer",askVoice:"Demander",viewAll:"Voir tout",match:"match",similarProduct:"Similaire",boughtTogether:"Souvent acheté avec",basedOnViewed:"Vu récemment",basedOnPurchases:"Pour vous",personalized:"Recommandé"},en:{close:"Close",askVoice:"Ask",viewAll:"View All",match:"match",similarProduct:"Similar",boughtTogether:"Often bought together",basedOnViewed:"Recently viewed",basedOnPurchases:"For you",personalized:"Recommended"},es:{close:"Cerrar",askVoice:"Preguntar",viewAll:"Ver todo",match:"coincide",similarProduct:"Similar",boughtTogether:"Comprado junto",basedOnViewed:"Visto reciente",basedOnPurchases:"Para ti",personalized:"Recomendado"},ar:{close:"إغلاق",askVoice:"اسأل",viewAll:"عرض الكل",match:"تطابق",similarProduct:"مشابه",boughtTogether:"يشترى معًا",basedOnViewed:"شوهد مؤخرًا",basedOnPurchases:"لك",personalized:"موصى به"},ary:{close:"سد",askVoice:"سول",viewAll:"شوف كلشي",match:"تطابق",similarProduct:"بحال هادا",boughtTogether:"كيتشرا مع",basedOnViewed:"شفتي مؤخراً",basedOnPurchases:"ليك",personalized:"منصوح بيه"}};return e[this.options.lang]||e.fr}show(e,n={}){const{title:t,type:o="similar"}=n,i=(this._getLabels(),{similar:{fr:"Produits similaires",en:"Similar Products",es:"Productos similares",ar:"منتجات مشابهة",ary:"منتوجات بحال هادو"},bought_together:{fr:"Souvent achetés ensemble",en:"Frequently Bought Together",es:"Comprados juntos",ar:"يُشترى معًا",ary:"كيتشرا مع بعض"},personalized:{fr:"Recommandé pour vous",en:"Recommended for You",es:"Recomendado para ti",ar:"موصى به لك",ary:"منصوح بيه ليك"}}),a=t||i[o]?.[this.options.lang]||i[o]?.fr||"Recommendations";return this.items=e.slice(0,this.options.maxItems),this.hide(),this.host=document.createElement("div"),this.host.id="va-reco-host",this.host.style.cssText="position:fixed;inset:0;z-index:10003;pointer-events:none;",document.body.appendChild(this.host),this.shadowRoot=this.host.attachShadow({mode:"open"}),this._injectStyles(this.shadowRoot),this.container=this._createCarouselDOM(this.items,a),this.container.style.pointerEvents="auto",this.shadowRoot.appendChild(this.container),requestAnimationFrame(()=>{this.container.classList.add("va-reco-visible")}),this.isVisible=!0,this._trackImpression(o,this.items.length),this.options.autoClose&&(this.autoCloseTimer=setTimeout(()=>this.hide(),this.options.autoClose)),this}hide(){return this.autoCloseTimer&&(clearTimeout(this.autoCloseTimer),this.autoCloseTimer=null),this.container&&(this.container.classList.remove("va-reco-visible"),setTimeout(()=>{this.host?.remove(),this.host=null,this.shadowRoot=null,this.container=null},300)),this.isVisible=!1,this.options.onClose&&this.options.onClose(),this}_trackImpression(e,n){t()&&"function"==typeof gtag&&gtag("event","reco_carousel_impression",{event_category:"recommendations",recommendation_type:e,items_shown:n,tenant_id:this.options.tenantId})}_trackClick(e,n){t()&&"function"==typeof gtag&&gtag("event","reco_carousel_click",{event_category:"recommendations",product_id:e.id||e.productId,position:n+1,reason:e.reason,tenant_id:this.options.tenantId})}_trackViewAll(){t()&&"function"==typeof gtag&&gtag("event","reco_carousel_view_all",{event_category:"recommendations",items_shown:this.items.length,tenant_id:this.options.tenantId})}setLanguage(e){return this.options.lang=e,this}}e.VocalIARecommendations=o,e.VocalIA&&(e.VocalIA.RecommendationCarousel=o)}(typeof window<"u"?window:this);