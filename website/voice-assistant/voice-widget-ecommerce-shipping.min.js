/* VocalIA Widget v2.7.0 - 2026-02-08 */
!function(){"use strict";const e={fr:{freeShipping:"Livraison GRATUITE",addMore:"Plus que {{amount}} pour la livraison gratuite !",almostThere:"Presque ! {{amount}} de plus et c'est gratuit !",unlocked:"Livraison gratuite debloquee !",voiceMilestone25:"Vous avez deja un quart du chemin pour la livraison gratuite.",voiceMilestone50:"A mi-chemin ! Continuez pour debloquer la livraison gratuite.",voiceMilestone75:"Presque la livraison gratuite ! Plus que quelques articles.",voiceMilestone100:"Felicitations ! Vous avez debloque la livraison gratuite !",threshold:"Seuil livraison gratuite",currentCart:"Panier actuel",remaining:"Restant",currency:{MAD:"DH",EUR:"€",USD:"$"}},en:{freeShipping:"FREE Shipping",addMore:"Add {{amount}} more for free shipping!",almostThere:"Almost there! {{amount}} more for free shipping!",unlocked:"Free shipping unlocked!",voiceMilestone25:"You're a quarter of the way to free shipping.",voiceMilestone50:"Halfway there! Keep going to unlock free shipping.",voiceMilestone75:"Almost at free shipping! Just a few more items.",voiceMilestone100:"Congratulations! You've unlocked free shipping!",threshold:"Free shipping threshold",currentCart:"Current cart",remaining:"Remaining",currency:{MAD:"MAD",EUR:"€",USD:"$"}},es:{freeShipping:"Envio GRATIS",addMore:"Anade {{amount}} mas para envio gratis!",almostThere:"Casi ahi! {{amount}} mas para envio gratis!",unlocked:"Envio gratis desbloqueado!",voiceMilestone25:"Llevas un cuarto del camino para envio gratis.",voiceMilestone50:"A mitad de camino! Sigue para desbloquear envio gratis.",voiceMilestone75:"Casi envio gratis! Solo unos articulos mas.",voiceMilestone100:"Felicidades! Has desbloqueado el envio gratis!",threshold:"Umbral envio gratis",currentCart:"Carrito actual",remaining:"Restante",currency:{MAD:"MAD",EUR:"€",USD:"$"}},ar:{freeShipping:"شحن مجاني",addMore:"اضف {{amount}} للحصول على شحن مجاني!",almostThere:"قريب جدا! {{amount}} فقط للشحن المجاني!",unlocked:"تم فتح الشحن المجاني!",voiceMilestone25:"انت في ربع الطريق للشحن المجاني.",voiceMilestone50:"في منتصف الطريق! استمر للحصول على الشحن المجاني.",voiceMilestone75:"قريب جدا من الشحن المجاني! فقط بعض المنتجات.",voiceMilestone100:"مبروك! لقد حصلت على الشحن المجاني!",threshold:"حد الشحن المجاني",currentCart:"السلة الحالية",remaining:"المتبقي",currency:{MAD:"درهم",EUR:"€",USD:"$"}},ary:{freeShipping:"التوصيل بلاش",addMore:"زيد {{amount}} باش يوصلك بلاش!",almostThere:"قريب! غير {{amount}} و يوصلك مجانا!",unlocked:"مبروك! التوصيل بلاش!",voiceMilestone25:"وصلتي الربع باش يجيك التوصيل بلاش.",voiceMilestone50:"فالنص! كمل باش تحصل على التوصيل المجاني.",voiceMilestone75:"قريب بزاف من التوصيل بلاش! غير شوية.",voiceMilestone100:"مبروك! دابا التوصيل بلاش!",threshold:"الحد ديال التوصيل بلاش",currentCart:"الباني دابا",remaining:"اللي باقي",currency:{MAD:"درهم",EUR:"€",USD:"$"}}};class n{constructor(n={}){this.config={tenantId:n.tenantId||this.detectTenantId(),lang:n.lang||this.detectLanguage(),threshold:n.threshold||50,currency:n.currency||"EUR",position:n.position||"top",voiceEnabled:!1!==n.voiceEnabled,showMilestones:!1!==n.showMilestones,autoHide:!1!==n.autoHide,autoHideDelay:n.autoHideDelay||5e3,dismissible:!1!==n.dismissible,onUnlock:n.onUnlock||null,onMilestone:n.onMilestone||null},this.state={isVisible:!1,currentValue:0,percentage:0,isUnlocked:!1,lastMilestone:0,dismissed:!1,announcedMilestones:new Set},this.elements={},this.translations=e[this.config.lang]||e.fr,this.isRTL=["ar","ary"].includes(this.config.lang),this.init()}detectTenantId(){const e=document.querySelector("[data-vocalia-tenant]");return e?e.dataset.vocaliaTenant:"default"}detectLanguage(){const e=document.querySelector("[data-vocalia-lang]");if(e)return e.dataset.vocaliaLang;const n=new URLSearchParams(window.location.search);if(n.get("lang"))return n.get("lang");const t=navigator.language?.split("-")[0];return["fr","en","es","ar","ary"].includes(t)?t:"fr"}init(){if(!document.querySelector("#va-shipping-bar-styles")){const e=document.createElement("style");e.id="va-shipping-bar-styles",e.textContent="\n    .va-shipping-bar-container {\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      z-index: 9999;\n      background: linear-gradient(135deg, #0f172a 0%, #0F1225 100%);\n      border-bottom: 1px solid rgba(94, 106, 210, 0.3);\n      padding: 12px 20px;\n      transform: translateY(-100%);\n      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);\n      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n    }\n\n    .va-shipping-bar-container.visible {\n      transform: translateY(0);\n    }\n\n    .va-shipping-bar-container.unlocked {\n      background: linear-gradient(135deg, #10B981 0%, #059669 100%);\n    }\n\n    .va-shipping-bar-container[dir=\"rtl\"] {\n      text-align: right;\n    }\n\n    .va-shipping-bar-inner {\n      max-width: 1200px;\n      margin: 0 auto;\n      display: flex;\n      align-items: center;\n      gap: 16px;\n      flex-wrap: wrap;\n    }\n\n    .va-shipping-icon {\n      width: 36px;\n      height: 36px;\n      flex-shrink: 0;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: rgba(255, 255, 255, 0.1);\n      border-radius: 50%;\n      animation: vaShippingPulse 2s infinite;\n    }\n\n    @keyframes vaShippingPulse {\n      0%, 100% { transform: scale(1); }\n      50% { transform: scale(1.1); }\n    }\n\n    .va-shipping-icon svg {\n      width: 20px;\n      height: 20px;\n      fill: white;\n    }\n\n    .va-shipping-content {\n      flex: 1;\n      min-width: 200px;\n    }\n\n    .va-shipping-text {\n      color: #FFFFFF;\n      font-size: 14px;\n      font-weight: 600;\n      margin-bottom: 8px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      flex-wrap: wrap;\n      gap: 8px;\n    }\n\n    .va-shipping-message {\n      flex: 1;\n    }\n\n    .va-shipping-amount {\n      color: #5E6AD2;\n      font-size: 16px;\n      font-weight: 700;\n    }\n\n    .va-shipping-bar-container.unlocked .va-shipping-amount {\n      color: #FFFFFF;\n    }\n\n    .va-shipping-progress-wrapper {\n      position: relative;\n      height: 8px;\n      background: rgba(255, 255, 255, 0.15);\n      border-radius: 4px;\n      overflow: hidden;\n    }\n\n    .va-shipping-progress {\n      height: 100%;\n      background: linear-gradient(90deg, #5E6AD2 0%, #10B981 100%);\n      border-radius: 4px;\n      transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);\n      position: relative;\n    }\n\n    .va-shipping-progress::after {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: linear-gradient(\n        90deg,\n        transparent 0%,\n        rgba(255, 255, 255, 0.3) 50%,\n        transparent 100%\n      );\n      animation: vaShimmer 2s infinite;\n    }\n\n    @keyframes vaShimmer {\n      0% { transform: translateX(-100%); }\n      100% { transform: translateX(100%); }\n    }\n\n    .va-shipping-bar-container.unlocked .va-shipping-progress {\n      background: rgba(255, 255, 255, 0.3);\n    }\n\n    .va-shipping-milestones {\n      display: flex;\n      justify-content: space-between;\n      margin-top: 4px;\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.5);\n    }\n\n    .va-shipping-milestone {\n      position: relative;\n    }\n\n    .va-shipping-milestone.reached {\n      color: #10B981;\n    }\n\n    .va-shipping-close {\n      width: 28px;\n      height: 28px;\n      border-radius: 50%;\n      background: rgba(255, 255, 255, 0.1);\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background 0.2s ease;\n      flex-shrink: 0;\n    }\n\n    .va-shipping-close:hover {\n      background: rgba(255, 255, 255, 0.2);\n    }\n\n    .va-shipping-close svg {\n      width: 14px;\n      height: 14px;\n      fill: white;\n    }\n\n    /* Confetti animation when unlocked */\n    .va-shipping-confetti {\n      position: absolute;\n      width: 10px;\n      height: 10px;\n      opacity: 0;\n    }\n\n    .va-shipping-bar-container.unlocked .va-shipping-confetti {\n      animation: vaConfetti 1s ease-out forwards;\n    }\n\n    @keyframes vaConfetti {\n      0% { opacity: 1; transform: translateY(0) rotate(0deg); }\n      100% { opacity: 0; transform: translateY(-50px) rotate(720deg); }\n    }\n\n    /* Mobile responsive */\n    @media (max-width: 640px) {\n      .va-shipping-bar-container {\n        padding: 10px 16px;\n      }\n\n      .va-shipping-icon {\n        width: 30px;\n        height: 30px;\n      }\n\n      .va-shipping-icon svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      .va-shipping-text {\n        font-size: 12px;\n      }\n\n      .va-shipping-amount {\n        font-size: 14px;\n      }\n\n      .va-shipping-milestones {\n        display: none;\n      }\n    }\n  ",document.head.appendChild(e)}this.createBar(),this.loadCartValue(),this.setupCartListeners(),console.log("[FreeShippingBar] Initialized",{tenant:this.config.tenantId,threshold:this.config.threshold,currency:this.config.currency})}createBar(){const e=document.createElement("div");e.className="va-shipping-bar-container",e.id="va-shipping-bar",e.setAttribute("dir",this.isRTL?"rtl":"ltr"),e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),"bottom"===this.config.position&&(e.style.top="auto",e.style.bottom="0",e.style.borderBottom="none",e.style.borderTop="1px solid rgba(94, 106, 210, 0.3)"),e.innerHTML=this.getBarHTML(),document.body.appendChild(e),this.elements.container=e,this.elements.progress=e.querySelector(".va-shipping-progress"),this.elements.message=e.querySelector(".va-shipping-message"),this.elements.amount=e.querySelector(".va-shipping-amount"),this.elements.closeBtn=e.querySelector(".va-shipping-close"),this.elements.closeBtn&&this.elements.closeBtn.addEventListener("click",()=>this.dismiss())}getBarHTML(){const e=this.translations,n=e.currency[this.config.currency]||this.config.currency;return`\n        <div class="va-shipping-bar-inner">\n          <div class="va-shipping-icon">\n            <svg viewBox="0 0 24 24">\n              <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>\n            </svg>\n          </div>\n\n          <div class="va-shipping-content">\n            <div class="va-shipping-text">\n              <span class="va-shipping-message">${e.addMore.replace("{{amount}}",`<strong>${this.config.threshold} ${n}</strong>`)}</span>\n              <span class="va-shipping-amount">0 / ${this.config.threshold} ${n}</span>\n            </div>\n\n            <div class="va-shipping-progress-wrapper">\n              <div class="va-shipping-progress" style="width: 0%"></div>\n            </div>\n\n            ${this.config.showMilestones?`\n              <div class="va-shipping-milestones">\n                <span class="va-shipping-milestone" data-milestone="0">0</span>\n                <span class="va-shipping-milestone" data-milestone="25">25%</span>\n                <span class="va-shipping-milestone" data-milestone="50">50%</span>\n                <span class="va-shipping-milestone" data-milestone="75">75%</span>\n                <span class="va-shipping-milestone" data-milestone="100">${e.freeShipping}</span>\n              </div>\n            `:""}\n          </div>\n\n          ${this.config.dismissible?'\n            <button class="va-shipping-close" aria-label="Close">\n              <svg viewBox="0 0 24 24">\n                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n              </svg>\n            </button>\n          ':""}\n        </div>\n      `}setupCartListeners(){if(window.VocalIA){const e=window.VocalIA.setCartData;window.VocalIA.setCartData=n=>{e&&e.call(window.VocalIA,n),this.updateCartValue(n?.total||0)}}window.addEventListener("va:cart:updated",e=>{this.updateCartValue(e.detail?.total||0)}),window.Shopify&&document.addEventListener("cart:updated",e=>{const n=e.detail?.total||window.Shopify?.checkout?.total_price/100;n&&this.updateCartValue(n)}),window.jQuery&&window.jQuery(document.body).on("added_to_cart removed_from_cart",()=>{const e=document.querySelector(".cart-contents-count, .woocommerce-Price-amount");if(e){const n=parseFloat(e.textContent.replace(/[^\d.]/g,""));isNaN(n)||this.updateCartValue(n)}})}loadCartValue(){const e=localStorage.getItem("va_cart_total");e?this.updateCartValue(parseFloat(e)):window.VocalIA?.cart?.total?this.updateCartValue(window.VocalIA.cart.total):window.Shopify?.checkout?.total_price&&this.updateCartValue(window.Shopify.checkout.total_price/100)}updateCartValue(e){this.state.currentValue=e,this.state.percentage=Math.min(e/this.config.threshold*100,100),this.state.isUnlocked=e>=this.config.threshold,localStorage.setItem("va_cart_total",e.toString()),this.updateUI(),this.checkMilestones(),!this.state.dismissed&&e>0&&this.show(),this.trackEvent("shipping_bar_updated",{cart_value:e,threshold:this.config.threshold,percentage:this.state.percentage,unlocked:this.state.isUnlocked})}updateUI(){const e=this.translations,n=e.currency[this.config.currency]||this.config.currency,t=Math.max(this.config.threshold-this.state.currentValue,0);this.elements.progress.style.width=`${this.state.percentage}%`,this.elements.amount.textContent=`${this.state.currentValue.toFixed(0)} / ${this.config.threshold} ${n}`,this.state.isUnlocked?(this.elements.message.innerHTML=`<strong>${e.unlocked}</strong>`,this.elements.container.classList.add("unlocked"),this.elements.container.classList.add("va-celebrate"),this.config.autoHide&&setTimeout(()=>this.hide(),this.config.autoHideDelay),this.config.onUnlock&&this.config.onUnlock({value:this.state.currentValue,threshold:this.config.threshold})):this.state.percentage>=75?(this.elements.message.innerHTML=e.almostThere.replace("{{amount}}",`<strong>${t.toFixed(0)} ${n}</strong>`),this.elements.container.classList.remove("unlocked")):(this.elements.message.innerHTML=e.addMore.replace("{{amount}}",`<strong>${t.toFixed(0)} ${n}</strong>`),this.elements.container.classList.remove("unlocked")),this.config.showMilestones&&this.elements.container.querySelectorAll(".va-shipping-milestone").forEach(e=>{const n=parseInt(e.dataset.milestone);this.state.percentage>=n?e.classList.add("reached"):e.classList.remove("reached")})}checkMilestones(){const e=[25,50,75,100];for(const n of e)this.state.percentage>=n&&!this.state.announcedMilestones.has(n)&&(this.state.announcedMilestones.add(n),this.announceMilestone(n),this.config.onMilestone&&this.config.onMilestone({milestone:n,percentage:this.state.percentage,value:this.state.currentValue}))}announceMilestone(e){if(!this.config.voiceEnabled)return;const n=this.translations,t={25:n.voiceMilestone25,50:n.voiceMilestone50,75:n.voiceMilestone75,100:n.voiceMilestone100}[e];t&&this.speak(t),this.trackEvent("shipping_milestone_reached",{milestone:e,cart_value:this.state.currentValue,threshold:this.config.threshold})}speak(e){if(!window.speechSynthesis)return;const n=new SpeechSynthesisUtterance(e);n.lang={fr:"fr-FR",en:"en-US",es:"es-ES",ar:"ar-SA",ary:"ar-MA"}[this.config.lang]||"fr-FR",n.rate=.9,n.pitch=1,window.speechSynthesis.speak(n)}show(){this.state.isVisible||this.state.dismissed||(this.state.isVisible=!0,this.elements.container.classList.add("visible"),"top"===this.config.position&&(document.body.style.paddingTop="60px"),this.trackEvent("shipping_bar_shown",{cart_value:this.state.currentValue,threshold:this.config.threshold}))}hide(){this.state.isVisible=!1,this.elements.container.classList.remove("visible"),"top"===this.config.position&&(document.body.style.paddingTop="")}dismiss(){this.state.dismissed=!0,this.hide(),localStorage.setItem("va_shipping_bar_dismissed","true"),this.trackEvent("shipping_bar_dismissed",{cart_value:this.state.currentValue,percentage:this.state.percentage})}trackEvent(e,n={}){window.gtag&&window.gtag("event",e,{event_category:"free_shipping",tenant_id:this.config.tenantId,...n}),window.plausible&&window.plausible(e,{props:n}),window.VocalIA?.trackEvent&&window.VocalIA.trackEvent(e,n)}setThreshold(e){this.config.threshold=e,this.updateCartValue(this.state.currentValue)}setCurrency(e){this.config.currency=e,this.elements.container.innerHTML=this.getBarHTML(),this.elements.progress=this.elements.container.querySelector(".va-shipping-progress"),this.elements.message=this.elements.container.querySelector(".va-shipping-message"),this.elements.amount=this.elements.container.querySelector(".va-shipping-amount"),this.updateUI()}reset(){this.state.dismissed=!1,this.state.announcedMilestones.clear(),localStorage.removeItem("va_shipping_bar_dismissed"),this.updateCartValue(0)}destroy(){this.hide(),this.elements.container?.remove(),document.body.style.paddingTop=""}}let t=null;function i(e={}){return"true"===localStorage.getItem("va_shipping_bar_dismissed")&&!1!==e.respectDismissal?(console.log("[FreeShippingBar] Previously dismissed, not showing"),null):(t&&t.destroy(),t=new n(e),t)}window.VocaliaShippingBar={init:i,getInstance:()=>t,FreeShippingBar:n},typeof window.VocalIA<"u"&&(window.VocalIA.ShippingBar=window.VocaliaShippingBar,window.VocalIA.initShippingBar=function(e={}){return i(e)},window.VocalIA.updateShippingProgress=function(e){t||(t=i()),t&&t.updateCartValue(e)}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("[data-vocalia-shipping-bar]");e&&i({tenantId:e.dataset.vocaliaTenant,lang:e.dataset.vocaliaLang,threshold:parseInt(e.dataset.threshold)||50,currency:e.dataset.currency||"EUR",voiceEnabled:"false"!==e.dataset.voice})})}();